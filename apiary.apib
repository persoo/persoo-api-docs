FORMAT: 1A
HOST: http://adminapi.persoo.cz

# Persoo administration API
API for configuring Persoo accounts. 

Persoo has two APIs - one for administration (this one) and another for reporting web visitors' behavior, querying for
recommendations and other web personalizations ([RTP API](http://docs.persoortp.apiary.io/))

**Tip:** Persoo administration running at admin.persoo.cz is a JavaScript application 
running in your browser using this REST API. If you want to play with this API, just 
open Persoo administration, open Chrome console, and watch requests in network communication.
You will see exact data for your Persoo account.

**Note:** This API is intended to be used internally by the Persoo team and our business partners and is therefore
quite low level. Many things will not make much sense from the outsider's point of
view. However, you are always welcome to contact us, and we will do our best to fit your needs.

## Allowed HTTP requests

- `POST` - Creates a resource
- `PUT` - Updates a resource
- `GET` - Retrieves a resource or a list of resources
- `DELETE` - Deletes a resource

## Typical server responses

- 200 `OK` - The request was successful and returned some content.
- 201 `Created` - The request was successful, and a resource was created.
- 204 `No Content` - The request was successful but returned no content.
- 400 `Bad Request` - The request wasn't understood or was missing the required parameters.
- 401 `Unauthorized` - Authentication token is invalid or has expired. (Try logging in again.)
- 403 `Forbidden` - Access denied.
- 404 `Not Found` - The requested resource wasn't found.
- 409 `Conflict` - Resource requested to be created already exists.

## Error reporting

Error responses (status 4xx/5xx) contain a JSON body with description of the error(s) in the following manner:
```
{
    "errors": [
        {
            "message": "Unauthorized."
        }
    ]
}
```
```
{
    "errors": [
        {
            "message": "Config structure validation: Field 'adminConfig.settings.productImport' missing.",
            "path": ["adminConfig", "settings", "productImport"]
        },
        {
            "message": "Config structure validation: Field 'adminConfig.settings.credentials[2]' isn't of type 'object'."
            "path": ["adminConfig", "settings", "credentials", 2]
        }
    ]
}
```
```
{
    "errors": [
        {
            "message": "Internal server error (ID f6429320a53711e4b0780002a5d5c51b)."
        }
    ]
}
```

## Basic API structure
A common pattern in our API is a following set of methods: list, get, put, delete. List returns all existing
objects, get returns one particular object (usually specified by ID), put updates the object and delete removes
the object.

It's beyond scope of this documentation to describe all requisites an object of particular type needs
to satisfy in order to be accepted since there's usually a very complicated logic behind it. Typically, you will
only need to slightly modify a few things (e.g. name), so all you need to do is get an object from the server,
change one value and send it back as it is.  If you need to build a more complex logic around this API, do not
hesitate to contact us and we'll discuss further possibilities.

**Note:** Some fields (commonly `id`) are accepted but ignored by the server for update operations. This
is so that you actually can send back the exact JSON you received. However, such fields will not be
updated and response may contain a different value of this field.

For example, you can send us something like this:

    {
        "name": "My Object",
        "id": "myModifiedID"
    }
        
And receive the following response:

    {
        "name": "My Object",
        "id": "e8fb4ab5e6f44912a911fead7f286363"
    }
        
It means that `id` have not been changed (because such behavior is not supported nor desired).

# Group Users
Users are owners of accounts. Each user has unique credentials (ID, password) to access the system, associated email (unique in the system), role (common user or superuser), and other data (name, ...).

## Login [/login]
### login [POST]
Authenticates the user. If a given combination of ID or email and MD5 password hash is valid, a token cookie will be set
so that all further requests are automatically authorized. The token expires 30 minutes after the last request.

MD5 password hash must be represented using 32 hexadecimal digits (0-9, A-F) and without any sort of prefix or postfix.

+ Request (application/json)

    + Body
    
            {
                "id": "e8fb4ab5e6f44912a911fead7f286363",
                "passwordHash": "5f4dcc3b5aa765d61d8327deb882cf99"
            }
            
            or
            
            {
                "email": "user@email.com",
                "passwordHash": "5f4dcc3b5aa765d61d8327deb882cf99"
            }

+ Response 204

    + Headers
    
            Set-Cookie: Expires=Mon, 30-Jul-2014 09:12:42 GMT; persooAuthToken={token}

+ Response 401

## Logout [/logout]
### logout [POST]
Deletes a cookie with token. Further requests cannot be handled until user authenticates again.

Please note that token cookie also expires 30 minutes after the last request so this might be the reason
why your request got rejected even without logging out.

+ Request

    + Headers
    
            Cookie: persooAuthToken={token};
            
+ Response 204

    + Headers
    
            Set-Cookie: Expires=Thu, 01 Jan 1970 00:00:00 GMT; persooAuthToken={token}

## Users [/users]
A user's details.

### listUsers [GET]
Lists all existing users. Please note that this method is only available for superusers.

+ Response 200 (application/json)

        [
                {
                    "creationDate": "2015-10-05 16:14:03",
                    "creationTimestamp": 1444061643000,
                    "email": "test1@example.com",
                    "id": "e8fb4ab5e6f44912a911fead7f286363",
                    "lastLoginDate": "2016-01-24 17:29:06",
                    "lastLoginTimestamp": 1453656546378,
                    "name": "Test 1",
                    "role": "common"
                },
                {
                    "creationDate": "2015-10-16 16:16:13",
                    "creationTimestamp": 1445012173478,
                    "email": "test2@example.com",
                    "id": "db7237e211dd4a578e178886d75e9cd7",
                    "lastLoginDate": "2015-10-26 12:21:50",
                    "lastLoginTimestamp": 1445862110696,
                    "name": "Test 2",
                    "role": "superuser"
                }
        ]

### newUser [POST]
Create a new user with specified permissions (either `common` or `superuser`). Please note that this method is
only available for superusers.

+ Request (application/json)

        {
            "email": "example@example.com",
            "passwordHash": "001122334455667788aabbccddeeff00",
            "role": "superuser",
            "name": "Administrator"
        }

+ Response 201 (application/json)

        {
            "creationDate": "2016-01-24 18:14:33",
            "creationTimestamp": 1453659273504,
            "email": "example@example.com",
            "id": "f215609b4959464796ca88f8935b0b5c",
            "lastLoginDate": null,
            "lastLoginTimestamp": null,
            "name": "Administrator",
            "role": "superuser"
        }

+ Response 400 (application/json)

        {
            "errors": [
                {
                    "message": "Bad Request"
                }
            ]
        }

+ Response 403 (application/json)

        {
            "errors": [
                {
                    "message": "Not authorized for the operation requested."
                }
            ]
        }

+ Response 409 (application/json)

        {
            "errors": [
                {
                    "message": "User already exists."
                }
            ]
        }

## User [/users/{userID}]
A user's details.

+ Parameters

    + userID (required, string, `e8fb4ab5e6f44912a911fead7f286363`) ... ID of the user to perform the action on. Value `"current"` can be used for the user logged in.

### getUser [GET]
Retrieve the user details by ID. Use `current` instead of ID for currently logged user. Please note that only
superusers can access informations about other users.

+ Response 200 (application/json)

        {
            "creationDate": "2015-10-05 16:14:03",
            "creationTimestamp": 1444061643000,
            "email": "example@example.com",
            "id": "ae0bcdd6c7184fd282729c8213f4928d",
            "lastLoginDate": "2016-01-24 17:29:06",
            "lastLoginTimestamp": 1453656546378,
            "name": "super",
            "role": "superuser"
        }

+ Response 403
+ Response 404

        {
            "errors": [
                {
                    "message": "Target user not found."
                }
            ]
        }

### updateUser [PUT]
Updates the user details for user with specified ID. Value `'current'` might be used for currently logged user instead of ID.

Please note that both given email and username must be unique and that updating other users' details is only available to superusers.

+ Request (application/json)

        {
            "email": "example@example.com",
            "passwordHash": "f215609b4959463795cb88f8935b0b5c",
            "role": "superuser",
            "name": "Example",
            "otherField": "otherValue"
        }
        
+ Response 200 (application/json)

        {
            "creationDate": "2016-01-24 18:14:33",
            "creationTimestamp": 1453659273504,
            "email": "example@example.com",
            "id": "f215609b4959463795cb88f8935b0b5c",
            "lastLoginDate": "2016-01-24 18:34:14",
            "lastLoginTimestamp": "1453660454157",
            "name": "Example",
            "role": "superuser",
            "otherField": "otherValue"
        }

+ Response 400 (application/json)

        {
            "errors": [
                {
                    "message": "Bad Request"
                }
            ]
        }

+ Response 403 (application/json)

        {
            "errors": [
                {
                    "message": "Not authorized for the operation requested."
                }
            ]
        }

+ Response 404 (application/json)

        {
            "errors": [
                {
                    "message": "Target user not found."
                }
            ]
        }

+ Response 409 (application/json)

        {
            "errors": [
                {
                    "message": "Internal server error; request ID: decf94ab30d24afba25b1d62196cbc6f"
                }
            ]
        }

### deleteUser [DELETE]
Deletes the user by ID. Value `current` might be used for the currently logged user. Please note that deleting
other users is only allowed to superusers.

+ Response 204

+ Response 403 (application/json)

        {
            "errors": [
                {
                    "message": "Not authorized for the operation requested."
                }
            ]
        }

+ Response 404 (application/json)

        {
            "errors": [
                {
                    "message": "Target user not found."
                }
            ]
        }

## Change password [/users/{userID}/changePassword]

+ Parameters

    + userID (required, string, `e8fb4ab5e6f44912a911fead7f286363`) ... ID of the user to perform the action on. Value `"current"` can be used for the user logged in

### changePassword [POST]
Changes a password of the user. Note that you can also use method `updateUser` instead.

+ Request (application/json)

        {
            "passwordHash": "5f4dcc3b5aa765d61d8327deb882cf99",
            "newPasswordHash": "14a88b9d2f52c55b5fbcf9c5d9c11875"
        }
        
+ Response 204
+ Response 400 (application/json)

        {
            "errors": [
                {
                    "message": "Bad Request"
                }
            ]
        }

+ Response 403 (application/json)

        {
            "errors": [
                {
                    "message": "Old password doesn't match."
                }
            ]
        }

+ Response 404

## Reset password [/users/resetPassword]

### resetPassword [POST]
**Not implemented so far.**

Resets user's password. The user will receive an email with a new password.

+ Request (application/json)

    + Body
        
            {
                "email": "user@email.com"
            }

+ Response 204
+ Response 404


# Group Account
Account is an elementary object in Persoo which contains its own scenarios, algorithms etc. Every account have unique ID which
is sometimes referred to as *API key*. Each user can have multiple accounts.

## Accounts [/accounts]
### listAccounts [GET]
Lists all accounts assigned to the currently authorized user. Please note that value `id` found in the returned
objects is also sometimes referred to as *API key*.

+ Response 200 (application/json)

        [
            {
                "creationDate": "2016-01-12 12:54:27",
                "creationTimestamp": 1452603267829,
                "id": "nivvvbdepi6i7410t44lcpff",
                "modificationDate": "2016-01-19 11:34:38",
                "modificationTimestamp": 1453203278061,
                "name": "demo.example.com"
            }
        ]

### newAccount [POST]
Create a new account.
+ Request (application/json)

        {
            "name": "My account"
        }

+ Response 201 (application/json)

        {
            "creationDate": "2016-01-24 23:23:19",
            "creationTimestamp": 1453677799378,
            "id": "oq7i8gbuc5bi4v2uhgtp25u2",
            "modificationDate": null,
            "modificationTimestamp": null,
            "name": "My Account"
        }

## Account [/accounts/{accountID}]
A single account object with basic data

+ Parameters

    + accountID (required, string, `4959bc0ab5f24ac2a9688908adaf9e24`) ... ID of the account to perform the action on

### getAccount [GET]
Retrieves informations about the account.

+ Response 200 (application/json)

        {
            "creationDate": "2016-01-24 23:23:19",
            "creationTimestamp": 1453677799379,
            "id": "4959bc0ab5f24ac2a9688908adaf9e24",
            "modificationDate": "2016-01-24 23:23:20",
            "modificationTimestamp": 1453677800094,
            "name": "My Account"
        }

+ Response 404 (application/json)

        {
            "errors": [
                {
                    "message": "Account not found."
                }
            ]
        }

### deleteAccount [DELETE]
Deletes the account. Common users can only delete accounts belonging to them. Superuser permissions are needed
otherwise.

+ Response 204

+ Response 403 (application/json)

        {
            "errors": [
                {
                    "message": "Not authorized for the operation requested."
                }
            ]
        }

## Rendering account [/accounts/{accountID}/render?environment={environment}]

+ Parameters
    + accountID (required, string, `4959bc0ab5f24ac2a9688908adaf9e24`) ... ID of the account to perform the action on
    + environment (required, string, `production`) ... `production` or `test`
    
### renderAccount [POST]
Renders the account.

+ Response 204

+ Response 404 (application/json)

        {
            "errors": [
                {
                    "message": "Account not found."
                }
            ]
        }

## Changes [/accounts/{accountID}/changes]

Manipulation of the differences between the current state (test environment) and the last stable state (production environment).

+ Parameters
    + accountID (required, string, `4959bc0ab5f24ac2a9688908adaf9e24`) ... ID of the account to perform the action on
    

### getChanges [GET]
Get description of the differences between the current and the last stable state.

The list of changes is only available for certain categories, namely the following ones: A/B tests (`abTests`),
Algorithms (`algorithms`), Campaigns (`campaigns`), Exports (`exports`), Imports (`imports`), Offers (`offers`),
Scenarios (`scenarios`) and Settings (`settings`). If `modified` is `true`, field `changes` is guaranteed to be
present, but it may be empty (which will occur if all changes have been made to other categories than those which
 are listed above).

+ Response 200 (application/json)
    + Body

            {
                "modified": true,
                "changes": {
                    "abTests": [
                        {
                            "id": "newABTest",
                            "name": "New A/B test",
                            "status": "created"
                        }
                    ],
                    "campaigns": [
                        {
                            "id": "exampleCampaign",
                            "name": "Example: Basket reminder",
                            "status": "modified"
                        }
                    ],
                    "exports": [
                        {
                            "id": "apsis",
                            "status": "deleted"
                        }
                    ]
                }
            }

### saveChanges [POST]
Make the current state the new last stable state. After this operation, the test and production environments are equal.

Note that common users can only save changes in the accounts belonging to them.

+ Response 204

+ Response 403

        {
            "errors": [
                {
                    "message": "Not authorized for the operation requested."
                }
            ]
        }

+ Response 404

        {
            "errors": [
                {
                    "message": "Account not found."
                }
            ]
        }

### deleteChanges [DELETE]
Reset the current state to the last stable state. After this operation, the test and production environments are equal.

Note that common users can only delete changes in the accounts belonging to them.

+ Response 204

+ Response 403

        {
            "errors": [
                {
                    "message": "Not authorized for the operation requested."
                }
            ]
        }

+ Response 404

        {
            "errors": [
                {
                    "message": "Account not found."
                }
            ]
        }

## Statistics [/accounts/{accountID}/statistics?timestampFrom={timestampFrom}&timestampTo={timestampTo}]

+ Parameters
    + timestampFrom (required, long, `43932000`) ... start the statistics with the day containing this timestamp (in UTC)
    + timestampTo (required, long, `300000000`) ... end the statistics with the day containing this timestamp (in UTC)

### getStatistics [GET]
Get daily statistics for an account.

If a metric isn't available for a particular day, `null` is used instead of a number value.

+ Response 200 (application/json)

        {
            "id": "niubci3ll8ig3dimo1lbjoqo",
            "timestamps": [
                0,
                86400000,
                172800000,
                259200000
            ],
            "dates": [
                "1970-01-01",
                "1970-01-02",
                "1970-01-03",
                "1970-01-04"
            ],
            "metrics": {
                "clicks": [
                    null,
                    null,
                    816,
                    3266
                ],
                "impressions": [
                    null,
                    null,
                    1679,
                    4590
                ],
                "someOtherMetric1": [
                    null,
                    null,
                    0.648905714812609,
                    0.07806533989738285
                ],
                "someOtherMetric2": [
                    null,
                    null,
                    783,
                    412
                ]
            }
        }

+ Response 404 (application/json)

        {
            "errors": [
                {
                    "message": "Account not found."
                }
            ]
        }

# Group Settings

A single account settings
 * event processing - you can map fields comming from dataLayer in page to required format, adjust parameters for algorithms in event processing, ....
 * credentials - if you want to access Persoo RTP API for user identification, you need to know authentication key.
 * integrations - set Google Analytics version, etc.
 * customDataflow - (advanced feature), i.e. to import transactions from department stores,...

## Settings [/accounts/{accountID}/settings]

+ Parameters

    + accountID (required, string, `4959bc0ab5f24ac2a9688908adaf9e24`) ... ID of the account to perform the action on


### getSettings [GET]
Retrieves the account settings.
+ Response 200 (application/json)

        {
            "account": {
                "collectDataOnly": false,
                "name": "My Account"
            },
            "credentials": {
                "exportsAuthenticationKey": "ca33d2f1c1914db4826ec1acb6f50251",
                "rtpAuthenticationKey": "e2ea276dd92031bdaba12eee48918478"
            },
            "eventProcessing": {
                "affinityShortTermThresholds": {
                    "absoluteThreshold": 0.23,
                    "halfTime": 604800000,
                    "halfValueCount": 2,
                    "maxLastAccessAge": 2592000000,
                    "relativeThreshold": 0.005
                },
                "affinityThresholds": {
                    "absoluteThreshold": 0.5,
                    "halfTime": 15552000000,
                    "halfValueCount": 0,
                    "maxLastAccessAge": 31536000000,
                    "relativeThreshold": 0.005
                },
                "customDataflows": {
                    "dataflows": {
                    }
                },
                "customScheduledTasks": {
                    "scheduledTasks": {
                    }
                },
                "customWorkflows": {
                    "nodes": {
                    },
                    "workflows": {
                    }
                },
                "javascriptPreprocessor": "function process(io) {\n   /* var event = io.session.lastEvent;\n    event.newField = event.oldField; */\n}",
                "preferencesToFields": [
                ]
            },
            "identifications": {
                "idTypes": [
                    "email",
                    "userId"
                ]
            },
            "integrations": {
                "apsis": {
                    "apikey": "apsis apikey",
                    "isActive": false,
                    "mailingListName": "mailing list name",
                    "transactionEmailTemplate": "Newsletter Name"
                },
                "emailMessageQueue": {
                    "idType": "userId",
                    "isActive": false
                },
                "googleAnalytics": {
                    "debugMode": "off",
                    "dimension": "4",
                    "isActive": false,
                    "statsHandler": "default",
                    "tagDelimeter": "|",
                    "trackABTests": true,
                    "trackEvents": true,
                    "trackerName": "",
                    "useGTMTracker": false,
                    "valueDelimeter": ":",
                    "version": "_gaq"
                },
                "mailchimp": {
                    "apikey": "MailChimp API key",
                    "isActive": false,
                    "mailingListName": "mailing list name"
                },
                "mandrill": {
                    "apikey": "mandrill apikey",
                    "from": {
                        "email": "your-name@your-eshop.com",
                        "name": "Your sender name"
                    },
                    "googleAnalyticsDomains": [
                        "your-domain.cz"
                    ],
                    "isActive": false
                },
                "modgen": {
                    "database": "Modgen DB ID",
                    "hmacKey": "Modgen HMAC Key",
                    "isActive": false
                },
                "web": {
                    "customJavascriptOnPageLoad": "",
                    "trackEvents": true
                }
            },
            "pageTypes": [
                {
                    "id": "homepage",
                    "name": "Homepage",
                    "type": "productList"
                },
                {
                    "id": "detail",
                    "name": "Detail",
                    "type": "productDetail"
                },
                {
                    "id": "category",
                    "name": "Category",
                    "type": "productList"
                },
                {
                    "id": "basket",
                    "name": "Basket",
                    "type": "basket"
                },
                {
                    "id": "search",
                    "name": "Search results",
                    "type": "productList"
                },
                {
                    "id": "error",
                    "name": "Error, i.e. 404",
                    "type": "content"
                },
                {
                    "id": "other",
                    "name": "Other",
                    "type": "content"
                }
            ]
        }

### updateSettings [PUT]
Updates the account settings.
+ Request (application/json)

        {
            "account": {
                "collectDataOnly": false,
                "name": "My Renamed Account"
            },
            "credentials": {
                "exportsAuthenticationKey": "ca33d2f1c1914db4826ec1acb6f50251",
                "rtpAuthenticationKey": "e2ea276dd92031bdaba12eee48918478"
            },
            "eventProcessing": {
                "affinityShortTermThresholds": {
                    "absoluteThreshold": 0.23,
                    "halfTime": 604800000,
                    "halfValueCount": 2,
                    "maxLastAccessAge": 2592000000,
                    "relativeThreshold": 0.005
                },
                "affinityThresholds": {
                    "absoluteThreshold": 0.5,
                    "halfTime": 15552000000,
                    "halfValueCount": 0,
                    "maxLastAccessAge": 31536000000,
                    "relativeThreshold": 0.005
                },
                "customDataflows": {
                    "dataflows": {
                    }
                },
                "customScheduledTasks": {
                    "scheduledTasks": {
                    }
                },
                "customWorkflows": {
                    "nodes": {
                    },
                    "workflows": {
                    }
                },
                "javascriptPreprocessor": "function process(io) {\n   /* var event = io.session.lastEvent;\n    event.newField = event.oldField; */\n}",
                "preferencesToFields": [
                ]
            },
            "identifications": {
                "idTypes": [
                    "email",
                    "userId"
                ]
            },
            "integrations": {
                "apsis": {
                    "apikey": "apsis apikey",
                    "isActive": false,
                    "mailingListName": "mailing list name",
                    "transactionEmailTemplate": "Newsletter Name"
                },
                "emailMessageQueue": {
                    "idType": "userId",
                    "isActive": false
                },
                "googleAnalytics": {
                    "debugMode": "off",
                    "dimension": "4",
                    "isActive": false,
                    "statsHandler": "default",
                    "tagDelimeter": "|",
                    "trackABTests": true,
                    "trackEvents": true,
                    "trackerName": "",
                    "useGTMTracker": false,
                    "valueDelimeter": ":",
                    "version": "_gaq"
                },
                "mailchimp": {
                    "apikey": "MailChimp API key",
                    "isActive": false,
                    "mailingListName": "mailing list name"
                },
                "mandrill": {
                    "apikey": "mandrill apikey",
                    "from": {
                        "email": "your-name@your-eshop.com",
                        "name": "Your sender name"
                    },
                    "googleAnalyticsDomains": [
                        "your-domain.cz"
                    ],
                    "isActive": false
                },
                "modgen": {
                    "database": "Modgen DB ID",
                    "hmacKey": "Modgen HMAC Key",
                    "isActive": false
                },
                "web": {
                    "customJavascriptOnPageLoad": "",
                    "trackEvents": true
                }
            },
            "pageTypes": [
                {
                    "id": "homepage",
                    "name": "Homepage",
                    "type": "productList"
                },
                {
                    "id": "detail",
                    "name": "Detail",
                    "type": "productDetail"
                },
                {
                    "id": "category",
                    "name": "Category",
                    "type": "productList"
                },
                {
                    "id": "basket",
                    "name": "Basket",
                    "type": "basket"
                },
                {
                    "id": "search",
                    "name": "Search results",
                    "type": "productList"
                },
                {
                    "id": "error",
                    "name": "Error, i.e. 404",
                    "type": "content"
                },
                {
                    "id": "other",
                    "name": "Other",
                    "type": "content"
                }
            ]
        }
        
+ Response 200 (application/json)

        {
            "account": {
                "collectDataOnly": false,
                "name": "My Renamed Account"
            },
            "credentials": {
                "exportsAuthenticationKey": "ca33d2f1c1914db4826ec1acb6f50251",
                "rtpAuthenticationKey": "e2ea276dd92031bdaba12eee48918478"
            },
            "eventProcessing": {
                "affinityShortTermThresholds": {
                    "absoluteThreshold": 0.23,
                    "halfTime": 604800000,
                    "halfValueCount": 2,
                    "maxLastAccessAge": 2592000000,
                    "relativeThreshold": 0.005
                },
                "affinityThresholds": {
                    "absoluteThreshold": 0.5,
                    "halfTime": 15552000000,
                    "halfValueCount": 0,
                    "maxLastAccessAge": 31536000000,
                    "relativeThreshold": 0.005
                },
                "customDataflows": {
                    "dataflows": {
                    }
                },
                "customScheduledTasks": {
                    "scheduledTasks": {
                    }
                },
                "customWorkflows": {
                    "nodes": {
                    },
                    "workflows": {
                    }
                },
                "javascriptPreprocessor": "function process(io) {\n   /* var event = io.session.lastEvent;\n    event.newField = event.oldField; */\n}",
                "preferencesToFields": [
                ]
            },
            "identifications": {
                "idTypes": [
                    "email",
                    "userId"
                ]
            },
            "integrations": {
                "apsis": {
                    "apikey": "apsis apikey",
                    "isActive": false,
                    "mailingListName": "mailing list name",
                    "transactionEmailTemplate": "Newsletter Name"
                },
                "emailMessageQueue": {
                    "idType": "userId",
                    "isActive": false
                },
                "googleAnalytics": {
                    "debugMode": "off",
                    "dimension": "4",
                    "isActive": false,
                    "statsHandler": "default",
                    "tagDelimeter": "|",
                    "trackABTests": true,
                    "trackEvents": true,
                    "trackerName": "",
                    "useGTMTracker": false,
                    "valueDelimeter": ":",
                    "version": "_gaq"
                },
                "mailchimp": {
                    "apikey": "MailChimp API key",
                    "isActive": false,
                    "mailingListName": "mailing list name"
                },
                "mandrill": {
                    "apikey": "mandrill apikey",
                    "from": {
                        "email": "your-name@your-eshop.com",
                        "name": "Your sender name"
                    },
                    "googleAnalyticsDomains": [
                        "your-domain.cz"
                    ],
                    "isActive": false
                },
                "modgen": {
                    "database": "Modgen DB ID",
                    "hmacKey": "Modgen HMAC Key",
                    "isActive": false
                },
                "web": {
                    "customJavascriptOnPageLoad": "",
                    "trackEvents": true
                }
            },
            "pageTypes": [
                {
                    "id": "homepage",
                    "name": "Homepage",
                    "type": "productList"
                },
                {
                    "id": "detail",
                    "name": "Detail",
                    "type": "productDetail"
                },
                {
                    "id": "category",
                    "name": "Category",
                    "type": "productList"
                },
                {
                    "id": "basket",
                    "name": "Basket",
                    "type": "basket"
                },
                {
                    "id": "search",
                    "name": "Search results",
                    "type": "productList"
                },
                {
                    "id": "error",
                    "name": "Error, i.e. 404",
                    "type": "content"
                },
                {
                    "id": "other",
                    "name": "Other",
                    "type": "content"
                }
            ]
        }

# Group Imports
Importing data (products, categories, ...) from external URLs. You can also run imports manually
or see import status.

## Imports [/accounts/{accountID}/imports]

+ Parameters

    + accountID (required, string, `4959bc0ab5f24ac2a9688908adaf9e24`) ... ID of the account to perform the action on

### listImports [GET]
Retrieve import settings for all available imports.

+ Response 200 (application/json)

        [
            {
                "isActive": true,
                "sourceURL": "http://eshop.com/export/xml/persoo.xml",
                "type": "xmlHeurekaProductFeed",
                "fieldsMapping" : {
                    "id" : {
                            "sourceField" : "id",
                            "type" : "string"
                    },
                    "title" : {
                            "sourceField" : "title",
                            "type" : "string"
                    },
                    "price" : {
                            "sourceField" : "price",
                            "type" : "double"
                    }
                },
                "customFieldsMapping" : {
                    "COLOR" : {
                            "sourceField" : "COLOR",
                            "type" : "string"
                    },
                    "AVAILABLE" : {
                            "sourceField" : "AVAILABLE",
                            "type" : "int"
                    },
                    "NOVINKA" : {
                            "sourceField" : "NOVINKA",
                            "type" : "string"
                    }
                },
                "javascriptPreprocessor": "function process(item) { return item; }"
            }
        ]

+ Response 404 (application/json)

        {
            "errors": [
                {
                    "message": "Account not found."
                }
            ]
        }

### newImport [POST]
Creates a new import.

+ Request (application/json)

        {
            "customFieldsMapping": [
            ],
            "fieldsMapping": {
                "categoryID": {
                    "sourceField": "categoryID",
                    "type": "string"
                },
                "hierarchy": {
                    "sourceField": "hierarchy",
                    "type": "string"
                },
                "title": {
                    "sourceField": "title",
                    "type": "string"
                }
            },
            "name": "categories",
            "isActive": false,
            "itemElementName": "SHOPCATEGORY",
            "javascriptPreprocessor": "function process(item) {return {categoryID: item.CATEGORY, hierarchy: item.HIERARCHY, title: item.CATEGORYNAME};   }",
            "sourceURL": "example.com/input_categories.json",
            "type": "json"
        }

+ Response 200 (application/json)

        {
            "customFieldsMapping": [
            ],
            "fieldsMapping": {
                "categoryID": {
                    "sourceField": "categoryID",
                    "type": "string"
                },
                "hierarchy": {
                    "sourceField": "hierarchy",
                    "type": "string"
                },
                "title": {
                    "sourceField": "title",
                    "type": "string"
                }
            },
            "id": "e29af025d28545b1b06d7c279f48b468",
            "isActive": false,
            "itemElementName": "SHOPCATEGORY",
            "javascriptPreprocessor": "function process(item) {return {categoryID: item.CATEGORY, hierarchy: item.HIERARCHY, title: item.CATEGORYNAME};   }",
            "sourceURL": "example.com/input_categories.json",
            "type": "json"
        }

## Import [/accounts/{accountID}/imports/{importID}]

+ Parameters

    + accountID (required, string, `4959bc0ab5f24ac2a9688908adaf9e24`) ... ID of the account to perform the action on
    + importID (required, string, `products`) ... either "products" or "categories"

### getImport [GET]
Retrieves settings for particular import.

+ Response 200 (application/json)

        {   
            "id": "products",
            "isActive": true,
            "sourceURL": "http://eshop.com/export/xml/persoo.xml",
            "type": "xmlHeurekaProductFeed",
            "fieldsMapping" : {
                "id" : {
                        "sourceField" : "id",
                        "type" : "string"
                },
                "title" : {
                        "sourceField" : "title",
                        "type" : "string"
                },
                "price" : {
                        "sourceField" : "price",
                        "type" : "double"
                }
            },
            "customFieldsMapping" : {
                "COLOR" : {
                        "sourceField" : "COLOR",
                        "type" : "string"
                },
                "AVAILABLE" : {
                        "sourceField" : "AVAILABLE",
                        "type" : "int"
                },
                "NOVINKA" : {
                        "sourceField" : "NOVINKA",
                        "type" : "string"
                }
            },
            "javascriptPreprocessor": "function process(item) { return item; }"
        }

### updateImport [PUT]
Updates import settings.
+ Request (application/json)

        {
            "id": "products",
            "isActive": true,
            "sourceURL": "http://eshop2.com/export/xml/persoo.xml",
            "type": "xmlHeurekaProductFeed",
            "fieldsMapping" : {
                "id" : {
                        "sourceField" : "id",
                        "type" : "string"
                },
                "title" : {
                        "sourceField" : "title",
                        "type" : "string"
                },
                "price" : {
                        "sourceField" : "price",
                        "type" : "double"
                }
            },
            "customFieldsMapping" : {
                "COLOR" : {
                        "sourceField" : "COLOR",
                        "type" : "string"
                },
                "AVAILABLE" : {
                        "sourceField" : "AVAILABLE",
                        "type" : "int"
                },
                "NOVINKA" : {
                        "sourceField" : "NOVINKA",
                        "type" : "string"
                }
            },
            "javascriptPreprocessor": "function process(item) { return item; }"
        }

+ Response 200 (application/json)

        {
            "id": "products",
            "isActive": true,
            "sourceURL": "http://eshop2.com/export/xml/persoo.xml",
            "type": "xmlHeurekaProductFeed",
            "fieldsMapping" : {
                "id" : {
                        "sourceField" : "id",
                        "type" : "string"
                },
                "title" : {
                        "sourceField" : "title",
                        "type" : "string"
                },
                "price" : {
                        "sourceField" : "price",
                        "type" : "double"
                }
            },
            "customFieldsMapping" : {
                "COLOR" : {
                        "sourceField" : "COLOR",
                        "type" : "string"
                },
                "AVAILABLE" : {
                        "sourceField" : "AVAILABLE",
                        "type" : "int"
                },
                "NOVINKA" : {
                        "sourceField" : "NOVINKA",
                        "type" : "string"
                }
            },
            "javascriptPreprocessor": "function process(item) { return item; }"
        }

### deleteImport [DELETE]
Deletes the import.

+ Response 204

+ Response 403 (application/json)

        {
            "errors": [
                {
                    "message": "Not authorized for the operation requested."
                }
            ]
        }

+ Response 404 (application/json)

        {
            "errors": [
                {
                    "message": "Import not found."
                }
            ]
        }

## Run import [/accounts/{accountID}/imports/{importID}/run?environment={environment}]

+ Parameters
    + accountID (required, string, `4959bc0ab5f24ac2a9688908adaf9e24`) ... ID of the account to perform the action on
    + importID (required, string, `dc643a1514044cfc8040dd9b5186c60e`) ... ID of the import
    + environment (required, string, `production`) ... either `production` or `test`

### runImport [POST]
Runs import with specified ID.

+ Response 200 (application/json)

        {
            "id": "209e6be2-8488-4e99-ab9f-3620848cf1d2"
        }
        
+ Response 404 (application/json)

        {
            "errors": [
                {
                    "message": "Import not found."
                }
            ]
        }

## Get import status [/accounts/{accountID}/imports/{importID}/status]

+ Parameters
    + accountID (required, string, `4959bc0ab5f24ac2a9688908adaf9e24`) ... ID of the account to perform the action on
    + importID (required, string, `products`) ... ID of the import

### getImportStatus [GET]
Get import status:
* status is 
 * "green" - last import was OK, 
 * "yellow" - last import had problem, but previous/yesterdays import was OK, maybe source URL was down because of server updates, etc.
 * "red" - 2 or more last imports had problems
* lastSuccessTimestamp - timestamp of last successful import
* lastSuccessDate - human readable date of last successful import
* history of at most 10 imports with a detailed log

+ Response 200 (application/json)

        [
            {
                "environment": "production",
                "status": "green",
                "lastSuccessTimestamp": 1420034938343,
                "lastSuccessDate": "2014-01-23",
                "history": [
                    {
                        "timestamp": 1422034938343,
                        "status": "pending",
                        "id": "209e6be2-8488-4e99-ab9f-3620848cf1d2",
                        "log": "<TODO - JSON with data, error messages, ....>"
                    },
                    {
                        "timestamp": 1421034938343,
                        "status": "running",
                        "id": "199e6be2-8488-4e99-ab9f-3620848cf1c2",
                        "log": "<TODO - JSON with data, error messages, ....>"
                    },
                    {
                        "timestamp": 1420034938343,
                        "status": "OK",
                        "id": "309e6be2-8488-4e99-ab9f-3620848cdf1c",
                        "log": "<TODO - JSON with data, error messages, ....>"
                    },
                    {
                        "timestamp": 1419034938343,
                        "status": "error",
                        "id": "449e6be2-8488-4e99-ab9f-36201c2848cf",
                        "log": "<TODO - JSON with data, error messages, ....>"
                    },
                    {
                        "timestamp": 1418034938343,
                        "status": "OK",
                        "id": "929e6be2-8488-4e99-ab9f-3620848c2cf1",
                        "log": "<TODO - JSON with data, error messages, ....>"
                    }
                ]
            },
            {
                "environment": "test",
                ...
            }
        ]

# Group Exports
## Exports [/accounts/{accountID}/exports]

+ Parameters

    + accountID (required, string, `4959bc0ab5f24ac2a9688908adaf9e24`) ... ID of the account to perform the action on

### listExports [GET]
Lists all exports.

+ Response 200 (application/json)

        [
            {
                "class": "json",
                "destinationURL": "https://example.com/someExport.json",
                "fields": [
                    {
                        "id": "field1",
                        "template": "<%= path.to.persoo.variable %>"
                    },
                    {
                        "id": "field2",
                        "template": "<%= path.to.persoo.variable %>"
                    }
                ],
                "id": "fileVIDs",
                "idType": "_vid",
                "isActive": false,
                "name": "All profiles to JSON",
                "scenarios": [
                    {
                        "id": "products1",
                        "scenarioID": "psGeneral"
                    }
                ]
            }
        ]

### newExport [POST]
Creates a new export.

+ Request (application/json)

        {
            "class": "json",
            "destinationURL": "https://example.com/someExport.json",
            "fields": [
                {
                    "id": "field1",
                    "template": "<%= path.to.persoo.variable %>"
                },
                {
                    "id": "field2",
                    "template": "<%= path.to.persoo.variable %>"
                }
            ],
            "id": "fileVIDs",
            "idType": "_vid",
            "isActive": false,
            "name": "All profiles to JSON",
            "scenarios": [
                {
                    "id": "products1",
                    "scenarioID": "psGeneral"
                }
            ]
        }

+ Response 201

## Export [/accounts/{accountID}/exports/{exportID}]

+ Parameters

    + accountID (required, string, `4959bc0ab5f24ac2a9688908adaf9e24`) ... ID of the account to perform the action on
    + exportID (required, string, `exportID`) ... ID of the export
    
### deleteExport [DELETE]
Deletes the export.

+ Response 204

### getExport [GET]
Retrieves informations about the export.

+ Response 200 (application/json)

        {
            "class": "json",
            "destinationURL": "https://example.com/output.json",
            "fields": [
                {
                    "id": "field1",
                    "template": "<%= path.to.persoo.variable %>"
                },
                {
                    "id": "field2",
                    "template": "<%= path.to.persoo.variable %>"
                }
            ],
            "id": "f380c893c788497fbcc5990d19eff98b",
            "idType": "_vid",
            "isActive": false,
            "name": "All profiles to JSON",
            "scenarios": [
                {
                    "id": "products1",
                    "scenarioID": "psGeneral"
                }
            ]
        }

+ Response 404

### updateExport [PUT]
Updates the export.

+ Request (application/json)

        {
            "class": "json",
            "destinationURL": "https://example.com/output.json",
            "fields": [
                {
                    "id": "field1",
                    "template": "<%= path.to.persoo.variable %>"
                },
                {
                    "id": "field2",
                    "template": "<%= path.to.persoo.variable %>"
                }
            ],
            "id": "f380c893c788497fbcc5990d19eff98b",
            "idType": "_vid",
            "isActive": false,
            "name": "All profiles to JSON",
            "scenarios": [
                {
                    "id": "products1",
                    "scenarioID": "psGeneral"
                }
            ]
        }
        
+ Response 200 (application/json)

        {
            "class": "json",
            "destinationURL": "https://example.com/output.json",
            "fields": [
                {
                    "id": "field1",
                    "template": "<%= path.to.persoo.variable %>"
                },
                {
                    "id": "field2",
                    "template": "<%= path.to.persoo.variable %>"
                }
            ],
            "id": "f380c893c788497fbcc5990d19eff98b",
            "idType": "_vid",
            "isActive": false,
            "name": "All profiles to JSON",
            "scenarios": [
                {
                    "id": "products1",
                    "scenarioID": "psGeneral"
                }
            ]
        }

## Run export [/accounts/{accountID}/exports/{exportID}/run?environment={environment}]

+ Parameters

    + accountID (required, string, `4959bc0ab5f24ac2a9688908adaf9e24`) ... ID of the account to perform the action on
    + exportID (required, string, `exportID`) ... ID of the export
    + environment (required, string, `production`) ... either `production` or `test`

### runExport [POST]

+ Response 200 (application/json)

        {
            "id": "f25b6c8477114025b6be8ca3e4538f12"
        }

## Export status [/accounts/{accountID}/exports/{exportID}/status]

+ Parameters

    + accountID (required, string, `4959bc0ab5f24ac2a9688908adaf9e24`) ... ID of the account to perform the action on
    + exportID (required, string, `exportID`) ... ID of the export
    
### getExportStatus [GET]

+ Response 200 (application/json)

        [
            {
                "environment": "test",
                "history": [
                    {
                        "date": "2016-01-25 02:20:59",
                        "id": "f25b6c8476114025b6be8ca3e4538f13",
                        "report": {
                            "message": "Export finished successfully.",
                            "nodes": {
                                "destinations": {
                                    "f380c893c788497fbcc5990d19eff99cExport_saveItemsToJSON": {
                                        "destinationURL": "https://example.com/output.json",
                                        "input": {
                                            "itemsRead": 0
                                        },
                                        "itemsWritten": 0,
                                        "runningTime": "94 milliseconds",
                                        "runningTimeRaw": 94
                                    }
                                },
                                "operators": {
                                    "f380c893c788497fbcc5990d19eff99cExport_filterProfiles": {
                                        "input": {
                                            "itemsRead": 0
                                        },
                                        "output": {
                                            "itemsWritten": 0
                                        },
                                        "runningTime": "1 milliseconds",
                                        "runningTimeRaw": 1
                                    }
                                },
                                "sources": {
                                    "f380c893c788497fbcc5990d19eff99cExport_readItemsFromCRM": {
                                        "itemsRead": 0,
                                        "output": {
                                            "itemsWritten": 0
                                        },
                                        "runningTime": "1 milliseconds",
                                        "runningTimeRaw": 1
                                    }
                                }
                            },
                            "runningTime": "105 milliseconds",
                            "runningTimeRaw": 105,
                            "status": "success"
                        },
                        "requester": "user",
                        "status": "success",
                        "timestamp": 1453688459356
                    }
                ],
                "lastSuccessDate": "2016-01-25 02:20:59",
                "lastSuccessTimestamp": 1453688459356,
                "status": "green"
            }
        ]

# Group Dataflows
## Dataflows [/accounts/{accountID}/dataflows]

+ Parameters

    + accountID (required, string, `4959bc0ab5f24ac2a9688908adaf9e24`) ... ID of the account to perform the action on
    
### listDataflows [GET]

+ Response 200 (application/json)

        [
            {
                "environments": [
                    "test"
                ],
                "id": "f380c893c788497fbcc5990d29cff98cExport"
            },
            {
                "environments": [
                    "p",
                    "test"
                ],
                "id": "fileVIDsExport"
            }
        ]

## Run dataflow [/accounts/{accountID}/dataflows/{dataflowID}/run?environment={environment}]

+ Parameters

    + accountID (required, string, `4959bc0ab5f24ac2a9688908adaf9e24`) ... ID of the account to perform the action on
    + dataflowID (required, string `myDataflow`) ... ID of the dataflow
    + environment (required, string, `production`) ... either `production` or `test`

### runDataflow [POST]
Runs the dataflow.

+ Response 200 (application/json)

        {
            "id": "0c22200b373b414eade7d73ccfc9bc5e"
        }

## Dataflow [/account/{accountID}/dataflows/{dataflowID}/status]

+ Parameters
    + accountID (required, string, `4959bc0ab5f24ac2a9688908adaf9e24`) ... ID of the account to perform the action on
    + dataflowID (required, string `myDataflow`) ... ID of the dataflow

### getDataflowStatus [GET]
Retrieves current status of the dataflow. 

+ Response 200 (application/json)

        [
            {
                "environment": "test",
                "history": [
                    {
                        "date": "2016-01-25 02:35:46",
                        "id": "0c22210b373b414eade7d73ccfc9bc5e",
                        "report": {
                            "message": "Dataflow finished successfully.",
                            "nodes": {
                                "destinations": {
                                    "f7981a833f8342719d13b37f56a62f0eExport_saveItemsToJSON": {
                                        "destinationURL": "https://example.com/output.json",
                                        "input": {
                                            "itemsRead": 0
                                        },
                                        "itemsWritten": 0,
                                        "runningTime": "92 milliseconds",
                                        "runningTimeRaw": 92
                                    }
                                },
                                "operators": {
                                    "f7981a833f8342719d13b37f56a62f0eExport_filterProfiles": {
                                        "input": {
                                            "itemsRead": 0
                                        },
                                        "output": {
                                            "itemsWritten": 0
                                        },
                                        "runningTime": "0 milliseconds",
                                        "runningTimeRaw": 0
                                    }
                                },
                                "sources": {
                                    "f7981a833f8342719d13b37f56a62f0eExport_readItemsFromCRM": {
                                        "itemsRead": 0,
                                        "output": {
                                            "itemsWritten": 0
                                        },
                                        "runningTime": "1 milliseconds",
                                        "runningTimeRaw": 1
                                    }
                                }
                            },
                            "runningTime": "105 milliseconds",
                            "runningTimeRaw": 105,
                            "status": "success"
                        },
                        "requester": "user",
                        "status": "success",
                        "timestamp": 1453689346585
                    }
                ],
                "lastSuccessDate": "2016-01-25 02:35:46",
                "lastSuccessTimestamp": 1453689346585,
                "status": "green"
            }
        ]

# Group Scenarios
Scenario is a set of products ids composed of several algorithms.

## Scenarios [/accounts/{accountID}/scenarios]

+ Parameters

    + accountID (required, string, `4959bc0ab5f24ac2a9688908adaf9e24`) ... ID of the account to perform the action on

### listScenarios [GET]
List all scenarios.

+ Response 200 (application/json)

        [
            {
                "id": "f9acbc0c49874d51bf6c70d46ef0cf4c",
                "isActive": true,
                "name": "Homepage - recommended news",
                "abTest": "2ac25fb1ed2248b0a379e4c7d5049ab4",
                "location": {
                    "mode": "replace",
                    "onPageType": "Homepage",
                    "onURL": "",
                    "selector": "#box1",
                    "selectorClass": "query"
                },
                "variants": [
                    {
                        "condition": "true",
                        "id": "0",
                        "logic": {
                            "count": 10,
                            "minCount": 3,
                            "fallbacks": [
                                {
                                    "ref": "6d29428f00c54fd1a02a22cafa989546"
                                }
                            ]
                        },
                        "name": "<variant name>",
                        "template": "<% /* var products = products_alternatives; */ %>\n<div class=\"persooRecommendation\">\n    <h2>Recommendation name</h2>\n    <div>\n    <% for(i=0; i < products.length && i < 8;i++){ %>\n            <div class=\"product\" style=\"width:180px; height:250px; float: left;\">\n                <a href=\"<%= products[i].link %>\">\n                        <img src=\"<%= products[i].imageLink %>\" alt=\"<%= products[i].title %>\" style=\"max-height:150px;max-width:150px;\">\n                        <span class=\"title\"><%= products[i].title %> KÄ</span><br>\n                        <span class=\"price\"><%= products[i].price %> KÄ</span>\n                </a>\n            </div>\n    <% } %>\n    </div>\n</div>"
                    }
                ]
            },
            {
                "id": "e23fc94bbcc947f5aa4872c5fc04966b",
                "isActive": true,
                "name": "Homepage - recommendation",
                "abTest": null,
                "location": {
                    "mode": "replace",
                    "onPageType": "Homepage",
                    "onURL": "",
                    "selector": "#box4",
                    "selectorClass": "query"
                },
                "variants": [
                    {
                        "condition": "true",
                        "id": "0",
                        "logic": {
                            "count": 10,
                            "minCount": 3,
                            "fallbacks": []
                        },
                        "name": "<variant name>",
                        "template": "<html template>"
                    }
                ]
            },
            {
                "id": "2d5d11011d1444a29cc71d05e06f161d",
                "isActive": true,
                "name": "Detail - alternatives",
                "abTest": null,
                "location": {
                    "mode": "replace",
                    "onPageType": "Product",
                    "onURL": "",
                    "selector": "#box2",
                    "selectorClass": "query"
                },
                "variants": [
                    {
                        "condition": "true",
                        "id": "0",
                        "logic": {
                            "count": 10,
                            "minCount": 3,
                            "fallbacks": [
                                {
                                    "ref": "6d29428f00c54fd1a02a22cafa989546"
                                }
                            ]
                        },
                        "name": "<variant name>",
                        "template": "<html template>"
                    }
                ]
            },
            {
                "id": "cf8920281e0341058474fb2dd47b4fff",
                "isActive": true,
                "name": "Detail - crosssell",
                "abTest": null,
                "location": {
                    "mode": "replace",
                    "onPageType": "Product",
                    "onURL": "",
                    "selector": "#containerId",
                    "selectorClass": "query"
                },
                "variants": [
                    {
                        "condition": "true",
                        "id": "0",
                        "logic": {
                            "count": 10,
                            "minCount": 3,
                            "fallbacks": []
                        },
                        "name": "<variant name>",
                        "template": "<html template>"
                    }
                ]
            },
            {
                "id": "40aed0f057294e10bb6ba0fcb8f77050",
                "isActive": true,
                "name": "Basket - crosssell",
                "abTest": null,
                "location": {
                    "mode": "replace",
                    "onPageType": "Category",
                    "onURL": "",
                    "selector": "#box3",
                    "selectorClass": "query"
                },
                "variants": [
                    {
                        "condition": "true",
                        "id": "0",
                        "logic": {
                            "count": 10,
                            "minCount": 3,
                            "fallbacks": []
                        },
                        "name": "<variant name>",
                        "template": "<html template>"
                    }
                ]
            },
            {
                "id": "239b49caad3946ecb295b96d4c972d9f",
                "isActive": true,
                "name": "Page footer - last viewed products",
                "abTest": null,
                "location": {
                    "mode": "replace",
                    "onPageType": "category",
                    "onURL": ".*",
                    "selector": "#tab .products",
                    "selectorClass": "query"
                },
                "variants": [
                    {
                        "condition": "true",
                        "id": "default",
                        "logic": {
                            "count": 4,
                            "minCount": 3,
                            "fallbacks": [
                                {
                                    "ref": "6d29428f00c54fd1a02a22cafa989546"
                                }
                            ]
                        },
                        "name": "default",
                        "template": "<% /* var products = products_alternatives; */ %>\n<div class=\"persooRecommendation\">\n    <h2>Recommendation name</h2>\n    <div>\n    <% for(i=0; i < products.length && i < 8;i++){ %>\n            <div class=\"product\" style=\"width:180px; height:250px; float: left;\">\n                <a href=\"<%= products[i].link %>\">\n                        <img src=\"<%= products[i].imageLink %>\" alt=\"<%= products[i].title %>\" style=\"max-height:150px;max-width:150px;\">\n                        <span class=\"title\"><%= products[i].title %> KÃÂÃÂ</span><br>\n                        <span class=\"price\"><%= products[i].price %> KÃÂÃÂ</span>\n                </a>\n            </div>\n    <% } %>\n    </div>\n</div>"
                    }
                ]
            }
        ]

### newScenario [POST]
Create a new scenario.
+ Request (application/json)

        {
            "name": "Best Sellers",
            "isActive": true,
            "abTest": null,
            "location": {
                "selectorClass": "query",
                "selector": "#tab .products",
                "mode": "replace",
                "onPageType": "Category",
                "onURL": "<regExp>"
            },
            "variants": [
                {
                    "id": "0",
                    "name": "<variant name>",
                    "condition": "true",
                    "template": "<html template>",
                    "logic": {
                        "count": 10,
                        "minCount": 3,
                        "fallbacks": [
                            {
                               "ref": "6d29428f00c54fd1a02a22cafa989546"
                            },
                            {
                               "ref": "b1bb18a943454f3f89357b56b284ef77"
                            }
                        ]
                    }
                }
            ]
        }

+ Response 201 (application/json)

        {
            "id": "f9acbc0c49874d51bf6c70d46ef0cf4c",
            "name": "Best Sellers",
            "isActive": true,
            "abTest": null,
            "location": {
                "selectorClass": "query",
                "selector": "#tab .products",
                "mode": "replace",
                "onPageType": "Category",
                "onURL": "<regExp>"
            },
            "variants": [
                {
                    "id": "0",
                    "name": "<variant name>",
                    "condition": "true",
                    "template": "<html template>",
                    "logic": {
                        "count": 10,
                        "minCount": 3,
                        "fallbacks": [
                            {
                               "ref": "6d29428f00c54fd1a02a22cafa989546"
                            },
                            {
                               "ref": "b1bb18a943454f3f89357b56b284ef77"
                            }
                        ]
                    }
                }
            ]
        }

## Scenario [/accounts/{accountID}/scenarios/{scenarioID}]
A single scenario object with all its details.

+ Parameters

    + accountID (required, string, `4959bc0ab5f24ac2a9688908adaf9e24`) ... ID of the account to perform the action on
    + scenarioID (required, string, `f9acbc0c49874d51bf6c70d46ef0cf4c`) ... ID of the scenario to perform the action on

### getScenario [GET]
Retrieve a scenario.

+ Response 200 (application/json)

        {
            "id": "f9acbc0c49874d51bf6c70d46ef0cf4c",
            "name": "Best Sellers",
            "isActive": true,
            "abTest": null,
            "location": {
                "selectorClass": "query",
                "selector": "#tab .products",
                "mode": "replace",
                "onPageType": "Category",
                "onURL": "<regExp>"
            },
            "variants": [
                {
                    "id": "0",
                    "name": "<variant name>",
                    "condition": "true",
                    "template": "<html template>",
                    "logic": {
                        "count": 10,
                        "minCount": 3,
                        "fallbacks": [
                            {
                               "ref": "6d29428f00c54fd1a02a22cafa989546"
                            },
                            {
                               "ref": "b1bb18a943454f3f89357b56b284ef77"
                            }
                        ]
                    }
                }
            ]
        }
        
+ Response 404

        {
            "errors": [
                "message": "Recommendation scenario not found."
            ]
        }


### updateScenario [PUT]
Update a scenario.

The request may contain the field `id`, which is ignored; `scenarioID` is used instead.

+ Request (application/json)

        {
            "id": "anyString",
            "name": "Best Selling Products",
            "isActive": false,
            "abTest": null,
            "location": {
                "selectorClass": "query",
                "selector": "#tab .products",
                "mode": "replace",
                "onPageType": "Category",
                "onURL": "<regExp>"
            },
            "variants": [
                {
                    "id": "0",
                    "name": "<variant name>",
                    "condition": "true",
                    "template": "<html template>",
                    "logic": {
                        "count": 10,
                        "minCount": 3,
                        "fallbacks": [
                            {
                               "ref": "7854436109d24de1a332a14a59c5a5c7"
                            }
                        ]
                    }
                }
            ]
        }
        
+ Response 200 (application/json)

        {
            "id": "f9acbc0c49874d51bf6c70d46ef0cf4c",
            "name": "Best Selling Products",
            "isActive": false,
            "abTest": null,
            "location": {
                "selectorClass": "query",
                "selector": "#tab .products",
                "mode": "replace",
                "onPageType": "Category",
                "onURL": "<regExp>"
            },
            "variants": [
                {
                    "id": "0",
                    "name": "<variant name>",
                    "condition": "true",
                    "template": "<html template>",
                    "logic": {
                        "count": 10,
                        "minCount": 3,
                        "fallbacks": [
                            {
                               "ref": "7854436109d24de1a332a14a59c5a5c"
                            }
                        ]
                    }
                }
            ]
        }
        
+ Response 404

        {
            "errors": [
                "message": "Recommendation scenario not found."
            ]
        }


### deleteScenario [DELETE]
Delete a scenario.

+ Response 204

+ Response 404

        {
            "errors": [
                "message": "Recommendation scenario not found."
            ]
        }
        
## Scenarios statistics [/accounts/{accountID}/scenarios/statistics?timestampFrom={timestampFrom}&timestampTo={timestampTo}]

+ Parameters
    + accountID (required, string, `4959bc0ab5f24ac2a9688908adaf9e24`) ... ID of the account to perform the action on
    + timestampFrom (required, long, `43932000`) ... start the statistics with the day containing this timestamp (in UTC)
    + timestampTo (required, long, `300000000`) ... end the statistics with the day containing this timestamp (in UTC)

### getScenariosStatistics [GET]
Get daily statistics for all scenarios.

If a metric isn't available for a particular day, `null` is used instead of a number value.

Metrics in the root level are the metrics for all variants aggregated. (The values in the example below are random and don't respect this.)

+ Response 200 (application/json)

        [
            {
                "id": "e23fc94bbcc947f5aa4872c5fc04966b",
                "timestamps": [
                    0,
                    86400000,
                    172800000,
                    259200000
                ],
                "dates": [
                    "1970-01-01",
                    "1970-01-02",
                    "1970-01-03",
                    "1970-01-04"
                ],
                "metrics": {
                    "clicks": [
                        null,
                        null,
                        799,
                        950
                    ],
                    "impressions": [
                        null,
                        null,
                        3251,
                        5428
                    ],
                    "someOtherMetric1": [
                        null,
                        null,
                        0.9095407241692913,
                        0.40087619631713756
                    ],
                    "someOtherMetric2": [
                        null,
                        null,
                        -216,
                        -51
                    ]
                },
                "variants": {
                    "0": {
                        "metrics": {
                            "clicks": [
                                null,
                                null,
                                1500,
                                1444
                            ],
                            "impressions": [
                                null,
                                null,
                                1088,
                                1273
                            ],
                            "someOtherMetric1": [
                                null,
                                null,
                                0.49225843350585785,
                                0.562467127770878
                            ],
                            "someOtherMetric2": [
                                null,
                                null,
                                422,
                                806
                            ]
                        }
                    },
                    "1": {
                        "metrics": {
                            "clicks": [
                                null,
                                null,
                                1700,
                                1676
                            ],
                            "impressions": [
                                null,
                                null,
                                3088,
                                1773
                            ],
                            "someOtherMetric1": [
                                null,
                                null,
                                0.49225843350585785,
                                0.562467127770878
                            ],
                            "someOtherMetric2": [
                                null,
                                null,
                                422,
                                806
                            ]
                        }
                    }
                }
            },
            {
                "id": "a35c73fbb9c84152bddb15a4b6c5bd98",
                "timestamps": [
                    0,
                    86400000,
                    172800000,
                    259200000
                ],
                "dates": [
                    "1970-01-01",
                    "1970-01-02",
                    "1970-01-03",
                    "1970-01-04"
                ],
                "metrics": {
                    "clicks": [
                        643,
                        null,
                        null,
                        950
                    ],
                    "impressions": [
                        4112,
                        null,
                        null,
                        4354
                    ],
                    "someOtherMetric1": [
                        0.1593870380526593,
                        null,
                        null,
                        0.2735065237536176
                    ],
                    "someOtherMetric2": [
                        -123,
                        null,
                        null,                        
                        -43
                    ]
                },
                "variants": {
                    "0": {
                        "metrics": {
                            "clicks": [
                                3221,
                                null,
                                null,
                                421
                            ],
                            "impressions": [
                                432,
                                null,
                                null,
                                511
                            ],
                            "someOtherMetric1": [
                                0.43912250908729766,
                                null,
                                null,
                                0.2646019266493288
                            ],
                            "someOtherMetric2": [
                                421,
                                null,
                                null,
                                763
                            ]
                        }
                    },
                    "1": {
                        "metrics": {
                            "clicks": [
                                4211,
                                null,
                                null,
                                1981
                            ],
                            "impressions": [
                                914,
                                null,
                                null,
                                7531
                            ],
                            "someOtherMetric1": [
                                0.7504501949201073,
                                null,
                                null,
                                0.545216574297256
                            ],
                            "someOtherMetric2": [
                                321,
                                null,
                                null,
                                637
                            ]
                        }
                    }
                }
            }
        ]

## Scenario statistics [/accounts/{accountID}/scenarios/{scenarioID}/statistics?timestampFrom={timestampFrom}&timestampTo={timestampTo}]

+ Parameters
    + accountID (required, string, `4959bc0ab5f24ac2a9688908adaf9e24`) ... ID of the account to perform the action on
    + scenarioID (required, string, `f9acbc0c49874d51bf6c70d46ef0cf4c`) ... ID of the scenario to get the statistics of
    + timestampFrom (required, long, `43932000`) ... start the statistics with the day containing this timestamp (in UTC)
    + timestampTo (required, long, `300000000`) ... end the statistics with the day containing this timestamp (in UTC)

### getScenarioStatistics [GET]
Get daily statistics for a scenario.

If a metric isn't available for a particular day, `null` is used instead of a number value.

Metrics in the root level are the metrics for all variants aggregated. (The values in the example below are random and don't respect this.)

+ Response 200 (application/json)

        {
            "id": "e23fc94bbcc947f5aa4872c5fc04966b",
            "timestamps": [
                0,
                86400000,
                172800000,
                259200000
            ],
            "dates": [
                "1970-01-01",
                "1970-01-02",
                "1970-01-03",
                "1970-01-04"
            ],
            "metrics": {
                "clicks": [
                    null,
                    null,
                    799,
                    950
                ],
                "impressions": [
                    null,
                    null,
                    3251,
                    5428
                ],
                "someOtherMetric1": [
                    null,
                    null,
                    0.9095407241692913,
                    0.40087619631713756
                ],
                "someOtherMetric2": [
                    null,
                    null,
                    -216,
                    -51
                ]
            },
            "variants": {
                "0": {
                    "metrics": {
                        "clicks": [
                            null,
                            null,
                            1500,
                            1444
                        ],
                        "impressions": [
                            null,
                            null,
                            1088,
                            1273
                        ],
                        "someOtherMetric1": [
                            null,
                            null,
                            0.49225843350585785,
                            0.562467127770878
                        ],
                        "someOtherMetric2": [
                            null,
                            null,
                            422,
                            806
                        ]
                    }
                },
                "1": {
                    "metrics": {
                        "clicks": [
                            null,
                            null,
                            1700,
                            1676
                        ],
                        "impressions": [
                            null,
                            null,
                            3088,
                            1773
                        ],
                        "someOtherMetric1": [
                            null,
                            null,
                            0.49225843350585785,
                            0.562467127770878
                        ],
                        "someOtherMetric2": [
                            null,
                            null,
                            422,
                            806
                        ]
                    }
                }
            }
        }

+ Response 404

        {
            "errors": [
                "message": "Recommendation scenario not found."
            ]
        }

# Group Algorithms
Algorithms is base recommendation computation logic.

## Algorithms [/accounts/{accountID}/algorithms]

+ Parameters

    + accountID (required, string, `4959bc0ab5f24ac2a9688908adaf9e24`) ... ID of the account to perform the action on

### listAlgorithms [GET]
List all algorithms.
+ Response 200 (application/json)

        [
            {
                "id": "6d29428f00c54fd1a02a22cafa989546", 
                "name": "Algorithm 1", 
                "class": "ProductSearch",
                "config": {
                    "must": [
                        {
                            "id": "categoryIsCurrentCategory"
                        },
                        {
                            "id": "productIsCurrentProduct"
                        },
                        {
                            "id": "myCustomSignal",
                            "name": "My custom title",
                            "config": {
                                "myField": {"$lt": "db.products.inBasket"}
                            }
                        }
                    ],
                    "mustNot": [
                        {
                            "id": "productIsInBasket"
                        }
                    ],
                    "should": [
                        { 
                            "id": "productAlsoViewedWithCurrentProduct", 
                            "value": 0
                        }
                    ]
                }
            },
            {
                "id": "b1bb18a943454f3f89357b56b284ef77", 
                "name": "Algorithm 2",
                "class": "lastViewed",
                "config": {}
            },
            {
                "id": "7854436109d24de1a332a14a59c5a5c7", 
                "name": "Algorithm 3",
                "class": "custom",
                "config": {
                    "customKey1": "customValue1",
                    "customKey2": "customValue2"
                }
            },
            {
                "id": "7981b9398bb44950a7dd0c063bd58785", 
                "name": "Algorithm 4",
                "class": "custom",
                "config": {}
            },
            {
                "id": "341d4a16646948bb9ed7444523196b1f", 
                "name": "Algorithm Modgen",
                "class": "Modgen",
                "config": {
                    "type": "userBased",
                    "count": 20,
                    "filterTemplate": "\"<%= lastEvent.categoryID %>\" in 'CATEGORIES'",
                    "boostTemplate": "",
                    "diversity": 0.0
                }
            }
        ]

### newAlgorithm [POST]
Create a new algorithm.
+ Request (application/json)

        { 
            "name": "Algorithm Product Search",
            "class": "ProductSearch",
            "config": {
                "must": [
                    {
                        "id": "categoryIsCurrentCategory"
                    },
                    {
                        "id": "productIsCurrentProduct"
                    },
                    {
                        "id": "myCustomSignal",
                        "name": "My custom title",
                        "config": {
                            "myField": {"$lt": "db.products.inBasket"}
                        }
                    }
                ],
                "mustNot": [
                    {
                        "id": "productIsInBasket"
                    }
                ],
                "should": [
                    { 
                        "id": "productAlsoViewedWithCurrentProduct", 
                        "value": 0
                    }
                ]
            } 
        }

+ Response 201 (application/json)

        {
            "id": "0c6b2cd1cb714cf5860f3d8e83c31a8e",
            "name": "Algorithm Product Search",
            "class": "ProductSearch",
            "config": {
                "must": [
                    {
                        "id": "categoryIsCurrentCategory"
                    },
                    {
                        "id": "productIsCurrentProduct"
                    },
                    {
                        "id": "myCustomSignal",
                        "name": "My custom title",
                        "config": {
                            "myField": {"$lt": "db.products.inBasket"}
                        }
                    }
                ],
                "mustNot": [
                    {
                        "id": "productIsInBasket"
                    }
                ],
                "should": [
                    { 
                        "id": "productAlsoViewedWithCurrentProduct", 
                        "value": 0
                    }
                ]
            } 
        }

## Algorithm [/accounts/{accountID}/algorithms/{algorithmID}]
A single algorithm object with all its details

+ Parameters

    + accountID (required, string, `4959bc0ab5f24ac2a9688908adaf9e24`) ... ID of the account to perform the action on
    + algorithmID (required, string, `0c6b2cd1cb714cf5860f3d8e83c31a8e`) ... ID of the algorithm to perform the action on

### getAlgorithm [GET]
Retrieve an algorithm.
+ Response 200 (application/json)

        { 
            "id": "0c6b2cd1cb714cf5860f3d8e83c31a8e", 
            "name": "Algorithm Product Search",
            "class": "ProductSearch",
            "config": {
                "must": [
                    {
                        "id": "categoryIsCurrentCategory"
                    },
                    {
                        "id": "productIsCurrentProduct"
                    },
                    {
                        "id": "myCustomSignal",
                        "name": "My custom title",
                        "config": {
                            "myField": {"$lt": "db.products.inBasket"}
                        }
                    }
                ],
                "mustNot": [
                    {
                        "id": "productIsInBasket"
                    }
                ],
                "should": [
                    { 
                        "id": "productAlsoViewedWithCurrentProduct", 
                        "value": 0
                    }
                ]
            } 
        }

### updateAlgorithm [PUT]
Update an algorithm.

The request may contain the field `id`, which is ignored; `algorithmID` is used instead.

+ Request (application/json)

        { 
            "id": "anyString", 
            "name": "Algorithm for searching products",
            "class": "ProductSearch",
            "config": {
                "must": [
                    {
                        "id": "categoryIsCurrentCategory"
                    },
                    {
                        "id": "productIsCurrentProduct"
                    },
                    {
                        "id": "myCustomSignal",
                        "name": "My custom title",
                        "config": {
                            "myField": {"$lt": "db.products.inBasket"}
                        }
                    }
                ],
                "mustNot": [
                    {
                        "id": "productIsInBasket"
                    }
                ],
                "should": [
                    { 
                        "id": "productAlsoViewedWithCurrentProduct", 
                        "value": 0
                    }
                ]
            } 
        }
        
+ Response 200 (application/json)

        { 
            "id": "0c6b2cd1cb714cf5860f3d8e83c31a8e", 
            "name": "Algorithm for searching products",
            "class": "ProductSearch",
            "config": {
                "must": [
                    {
                        "id": "categoryIsCurrentCategory"
                    },
                    {
                        "id": "productIsCurrentProduct"
                    },
                    {
                        "id": "myCustomSignal",
                        "name": "My custom title",
                        "config": {
                            "myField": {"$lt": "db.products.inBasket"}
                        }
                    }
                ],
                "mustNot": [
                    {
                        "id": "productIsInBasket"
                    }
                ],
                "should": [
                    { 
                        "id": "productAlsoViewedWithCurrentProduct", 
                        "value": 0
                    }
                ]
            } 
        }
        
+ Response 404

        {
            "errors": [
                "message": "Recommendation algorithm not found."
            ]
        }

### deleteAlgorithm [DELETE]
Delete an algorithm.
+ Response 204

+ Response 404

        {
            "errors": [
                "message": "Recommendation algorithm not found."
            ]
        }
        
# Group AB tests

## AB tests [/accounts/{accountID}/abTests]

+ Parameters

    + accountID (required, string, `4959bc0ab5f24ac2a9688908adaf9e24`) ... ID of the account to perform the action on

### listABTests [GET]
List all AB tests.

+ Response 200 (application/json)

        [
            {
                "id": "2ac25fb1ed2248b0a379e4c7d5049ab4",
                "name": "New shopping tray features evaluation",
                "isActive": true,
                "variants": [
                    {
                        "id": "A",
                        "name": "Old-style shopping tray",
                        "weight": 50,
                        "winner": true,
                        "baseline": true
                    },
                    {
                        "id": "B",
                        "name": "New-style shopping tray",
                        "weight": 50,
                        "winner": false,
                        "baseline": false
                    }
                ]
            },
            {
                "id": "b9e0ab6e9d184606982e33b66749d6b1",
                "name": "Persoo evaluation",
                "isActive": false,
                "variants": [
                    {
                        "id": "A",
                        "name": "Persoo off",
                        "weight": 50,
                        "winner": false,
                        "baseline": true
                    },
                    {
                        "id": "B",
                        "name": "Simple product recommendation",
                        "weight": 50,
                        "winner": true,
                        "baseline": false
                    },
                    {
                        "id": "C",
                        "name": "Personalized product recommendation",
                        "weight": 50,
                        "winner": false,
                        "baseline": false
                    }
                ]
            }
        ]

### newABTest [POST]
Create a new AB test.

+ Request (application/json)

        {
            "name": "New layout evaluation",
            "isActive": true,
            "variants": [
                {
                    "id": "A",
                    "name": "Old layout",
                    "weight": 50,
                    "winner": true,
                    "baseline": true
                },
                {
                    "id": "B",
                    "name": "New layout",
                    "weight": 50,
                    "winner": false,
                    "baseline": false
                }
            ]
        }

+ Response 201 (application/json)

        {
            "id": "98e6bed351ed47c1878bd8af9374434d",
            "name": "New layout evaluation",
            "isActive": true,
            "variants": [
                {
                    "id": "A",
                    "name": "Old layout",
                    "weight": 50,
                    "winner": true,
                    "baseline": true
                },
                {
                    "id": "B",
                    "name": "New layout",
                    "weight": 50,
                    "winner": false,
                    "baseline": false
                }
            ]
        }

## AB test [/accounts/{accountID}/abTests/{abTestID}]
A single AB test object with all its details.

+ Parameters

    + accountID (required, string, `4959bc0ab5f24ac2a9688908adaf9e24`) ... ID of the account to perform the action on
    + abTestID (required, string, `98e6bed351ed47c1878bd8af9374434d`) ... ID of the AB test to perform the action on

### getABTest [GET]
Retrieve an AB test.

+ Response 200 (application/json)

        {
            "id": "98e6bed351ed47c1878bd8af9374434d",
            "name": "New layout evaluation",
            "isActive": true,
            "variants": [
                {
                    "id": "A",
                    "name": "Old layout",
                    "weight": 50,
                    "winner": true,
                    "baseline": true
                },
                {
                    "id": "B",
                    "name": "New layout",
                    "weight": 50,
                    "winner": false,
                    "baseline": false
                }
            ]
        }

+ Response 404

        {
            "errors": [
                "message": "AB test not found."
            ]
        }

### updateABTest [PUT]
Update an AB test.

The request may contain the field `id`, which is ignored; `abTestID` is used instead.

+ Request (application/json)

        {
            "id": "anyString",
            "name": "Evaluation of the new layout",
            "isActive": false,
            "variants": [
                {
                    "id": "A",
                    "name": "Old layout",
                    "weight": 50,
                    "winner": true,
                    "baseline": true
                },
                {
                    "id": "B",
                    "name": "New layout without chatbox",
                    "weight": 50,
                    "winner": false,
                    "baseline": false
                },
                {
                    "id": "C",
                    "name": "New layout with chatbox",
                    "weight": 50,
                    "winner": false,
                    "baseline": false
                }
            ]
        }

+ Response 200 (application/json)

        {
            "id": "98e6bed351ed47c1878bd8af9374434d",
            "name": "Evaluation of the new layout",
            "isActive": false,
            "variants": [
                {
                    "id": "A",
                    "name": "Old layout",
                    "weight": 50,
                    "winner": true,
                    "baseline": true
                },
                {
                    "id": "B",
                    "name": "New layout without chatbox",
                    "weight": 50,
                    "winner": false,
                    "baseline": false
                },
                {
                    "id": "C",
                    "name": "New layout with chatbox",
                    "weight": 50,
                    "winner": false,
                    "baseline": false
                }
            ]
        }

+ Response 404

        {
            "errors": [
                "message": "AB test not found."
            ]
        }

### deleteABTest [DELETE]
Delete an AB test.

+ Response 204

+ Response 404

        {
            "errors": [
                "message": "AB test not found."
            ]
        }
        
## AB tests statistics [/accounts/{accountID}/abTests/statistics?timestampFrom={timestampFrom}&timestampTo={timestampTo}]

+ Parameters
    + accountID (required, string, `4959bc0ab5f24ac2a9688908adaf9e24`) ... ID of the account to perform the action on
    + timestampFrom (required, long, `43932000`) ... start the statistics with the day containing this timestamp (in UTC)
    + timestampTo (required, long, `300000000`) ... end the statistics with the day containing this timestamp (in UTC)

### getABTestsStatistics [GET]
Get daily statistics for all AB tests.

If a metric isn't available for a particular day, `null` is used instead of a number value.

Metrics in the root level are the metrics for all variants aggregated. (The values in the example below are random and don't respect this.)

+ Response 200 (application/json)

        [
            {
                "id": "e23fc94bbcc947f5aa4872c5fc04966b",
                "timestamps": [
                    0,
                    86400000,
                    172800000,
                    259200000
                ],
                "dates": [
                    "1970-01-01",
                    "1970-01-02",
                    "1970-01-03",
                    "1970-01-04"
                ],
                "metrics": {
                    "clicks": [
                        1087,
                        5734,
                        2652,
                        2722
                    ],
                    "impressions": [
                        9871,
                        7736,
                        3509,
                        6366
                    ],
                    "someOtherMetric1": [
                        0.003668946172197818,
                        0.2178408492721543,
                        0.028777068662288574,
                        0.9506455736459639
                    ],
                    "someOtherMetric2": [
                        879,
                        -225,
                        -647,
                        -715
                    ]
                },
                "variants": {
                    "A": {
                        "metrics": {
                            "clicks": [
                                200,
                                825,
                                309,
                                421
                            ],
                            "impressions": [
                                214,
                                5741,
                                3476,
                                7961
                            ],
                            "someOtherMetric1": [
                                0.6555852127295537,
                                0.16896041396298656,
                                0.523081442902202,
                                0.4299017917097032
                            ],
                            "someOtherMetric2": [
                                -84,
                                485,
                                639,
                                -562
                            ]
                        }
                    },
                    "B": {
                        "metrics": {
                            "clicks": [
                                312,
                                782,
                                1194,
                                3461
                            ],
                            "impressions": [
                                4848,
                                3822,
                                2828,
                                4781
                            ],
                            "someOtherMetric1": [
                                0.6530000210379121,
                                0.4907884562323944,
                                0.9646868032420256,
                                0.572847940496758
                            ],
                            "someOtherMetric2": [
                                -538,
                                958,
                                -633,
                                -935
                            ]
                        }
                    },
                    "C": {
                        "metrics": {
                            "clicks": [
                                null,
                                null,
                                67,
                                344
                            ],
                            "impressions": [
                                null,
                                null,
                                884,
                                722
                            ],
                            "someOtherMetric1": [
                                null,
                                null,
                                0.2757569125503805,
                                0.1403655010726006
                            ],
                            "someOtherMetric2": [
                                null,
                                null,
                                444,
                                -424
                            ]
                        }
                    }
                }
            },
            {
                "id": "d06461205e5e4abbaa185dec05c802a9",
                "timestamps": [
                    0,
                    86400000,
                    172800000,
                    259200000
                ],
                "dates": [
                    "1970-01-01",
                    "1970-01-02",
                    "1970-01-03",
                    "1970-01-04"
                ],
                "metrics": {
                    "clicks": [
                        8921,
                        3532,
                        983,
                        1257
                    ],
                    "impressions": [
                        2811,
                        10439,
                        8328,
                        1024
                    ],
                    "someOtherMetric1": [
                        0.8524400094267622,
                        0.9835282205407248,
                        0.5331655147155644,
                        0.03159187667912333
                    ],
                    "someOtherMetric2": [
                        322,
                        68439,
                        12,
                        -8992
                    ]
                },
                "variants": {
                    "A": {
                        "metrics": {
                            "clicks": [
                                892,
                                242,
                                891,
                                238
                            ],
                            "impressions": [
                                578,
                                2383,
                                8491,
                                2892
                            ],
                            "someOtherMetric1": [
                                0.2245794265748755,
                                0.767712355737353,
                                0.48843346243323227,
                                0.014840019490347522
                            ],
                            "someOtherMetric2": [
                                -892,
                                211,
                                2393,
                                -178
                            ]
                        }
                    },
                    "B": {
                        "metrics": {
                            "clicks": [
                                231,
                                8943,
                                182,
                                8293
                            ],
                            "impressions": [
                                7823,
                                3211,
                                178,
                                5811
                            ],
                            "someOtherMetric1": [
                                0.4540958393612988,
                                0.12314807796229665,
                                0.8826032985473886,
                                0.4288217771902769
                            ],
                            "someOtherMetric2": [
                                -613,
                                121,
                                -3829,
                                572
                            ]
                        }
                    }
                }
            }
        ]

## AB test statistics [/accounts/{accountID}/abTests/{abTestID}/statistics?timestampFrom={timestampFrom}&timestampTo={timestampTo}]

+ Parameters
    + accountID (required, string, `4959bc0ab5f24ac2a9688908adaf9e24`) ... ID of the account to perform the action on
    + abTestID (required, string, `98e6bed351ed47c1878bd8af9374434d`) ... ID of the AB test to get the statistics of
    + timestampFrom (required, long, `43932000`) ... start the statistics with the day containing this timestamp (in UTC)
    + timestampTo (required, long, `300000000`) ... end the statistics with the day containing this timestamp (in UTC)

### getABTestStatistics [GET]
Get daily statistics for an AB test.

If a metric isn't available for a particular day, `null` is used instead of a number value.

Metrics in the root level are the metrics for all variants aggregated. (The values in the example below are random and don't respect this.)

+ Response 200 (application/json)

        {
            "id": "e23fc94bbcc947f5aa4872c5fc04966b",
            "timestamps": [
                0,
                86400000,
                172800000,
                259200000
            ],
            "dates": [
                "1970-01-01",
                "1970-01-02",
                "1970-01-03",
                "1970-01-04"
            ],
            "metrics": {
                "clicks": [
                    1087,
                    5734,
                    2652,
                    2722
                ],
                "impressions": [
                    9871,
                    7736,
                    3509,
                    6366
                ],
                "someOtherMetric1": [
                    0.003668946172197818,
                    0.2178408492721543,
                    0.028777068662288574,
                    0.9506455736459639
                ],
                "someOtherMetric2": [
                    879,
                    -225,
                    -647,
                    -715
                ]
            },
            "variants": {
                "A": {
                    "metrics": {
                        "clicks": [
                            200,
                            825,
                            309,
                            421
                        ],
                        "impressions": [
                            214,
                            5741,
                            3476,
                            7961
                        ],
                        "someOtherMetric1": [
                            0.6555852127295537,
                            0.16896041396298656,
                            0.523081442902202,
                            0.4299017917097032
                        ],
                        "someOtherMetric2": [
                            -84,
                            485,
                            639,
                            -562
                        ]
                    }
                },
                "B": {
                    "metrics": {
                        "clicks": [
                            312,
                            782,
                            1194,
                            3461
                        ],
                        "impressions": [
                            4848,
                            3822,
                            2828,
                            4781
                        ],
                        "someOtherMetric1": [
                            0.6530000210379121,
                            0.4907884562323944,
                            0.9646868032420256,
                            0.572847940496758
                        ],
                        "someOtherMetric2": [
                            -538,
                            958,
                            -633,
                            -935
                        ]
                    }
                },
                "C": {
                    "metrics": {
                        "clicks": [
                            null,
                            null,
                            67,
                            344
                        ],
                        "impressions": [
                            null,
                            null,
                            884,
                            722
                        ],
                        "someOtherMetric1": [
                            null,
                            null,
                            0.2757569125503805,
                            0.1403655010726006
                        ],
                        "someOtherMetric2": [
                            null,
                            null,
                            444,
                            -424
                        ]
                    }
                }
            }
        }

+ Response 404

        {
            "errors": [
                "message": "AB test not found."
            ]
        }
        
# Group Campaigns

## Campaigns [/accounts/{accountID}/campaigns]

+ Parameters

    + accountID (required, string, `4959bc0ab5f24ac2a9688908adaf9e24`)

### listCampaigns [GET]
List all campaigns.

+ Response 200 (application/json)

        [
            {
                "id": "e739f150fa504c7a87634e124a6e6414",
                "name": "basketReminder1st",
                "class": "email",
                "isActive": true,
                "variants": [
                    {
                        "id": "default",
                        "name": "default",
                        "condition": "db.products.inBasket && db.products.inBasket.length > 0",
                        "content": {
                            "googleAnalyticsCampaign": "basketReminder1st",
                            "htmlBody": "<%\nfunction printPrice(p){\n\treturn String(Math.round(p)).replace(/(.*)([0-9]{3})/,'$1 $2');\n}\nfunction appendUrlParams(url, params){\n   var parts =  url.split('#');\n   parts[0] += ( parts[0].indexOf('?')<0  ? '?' : '&') + params;\n   return parts.join('#');\n}\n\nvar basketReminderStep = 'first';\n\n// mapping products to be displayed here\nvar products_basket = products1 || [];\nvar products_basket_recommended = products2 || [];\nvar percent = String.fromCharCode(37);\nvar urlParams = 'persooCampaign=basketReminder1';\n\nvar email_osloveni = db.mailchimp.OSLOVENI;\nvar email_5pad = db.mailchimp['5PAD'];\nvar email_email = db.bestIdentifications.email;\nvar basketTotal = 10;\n\n%>\n<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\">\n<html lang=\"en\" xml:lang=\"en\" xmlns=\"http://www.w3.org/1999/xhtml\">\t   \n    <head>\t\t     \n        <title>    \n        </title>\t\t     \n        <meta content=\"text/html; charset=UTF-8\" http-equiv=\"content-type\" />\t\t     \n        <meta content=\"application/xhtml+xml; charset=UTF-8\" http-equiv=\"content-type\" />\t\t     \n        <meta content=\"width=device-width, initial scale=1\" name=\"viewport\" />\t   \n    </head>\t   \n    <body style=\"margin:0; padding: 0; background-color: #ece8dc; background-image: url('bg.jpg');\">\n        <center>\n            <span style=\"font-size: 1px; color: #ece8dc;\">\n                <% if (basketReminderStep == 'first') { %>\n                Co třeba <%= products_basket[0].name %>?\n                <% } %>\n                <% if (basketReminderStep == 'second') { %>\n                <%= products_basket[0].name %> už na Vás čeká. \n                <% } %>\n            </span>\n            <table style=\"width:100%;\" cellspacing=\"0\" cellpadding=\"0\">\n                <tr>\n                    <td style=\"background-color: #ece8dc; background-image: url('http://s3-eu-west-1.amazonaws.com/cz.persoo.images/vqb36nehmep6dh1kbjpfpb4f/bg.jpg');\"></td>\n                    <td width=\"600\" align=\"left\" bgcolor=\"white\" style=\"background-color: white;\">\n                        <table width=\"600\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" bgcolor=\"white\">\n                            <tr>\n                                <td>\n                                    <img src=\"http://s3-eu-west-1.amazonaws.com/cz.persoo.images/vqb36nehmep6dh1kbjpfpb4f/header.jpg\" alt=\"\" usemap=\"#map\" />\n                                    <map name=\"map\">\n                                        <area shape=\"rect\" coords=\"0, 63, 599, 159\" href=\"http://www.hanibal.cz/<%= '?' + urlParams %>\" target=\"_blank\" />\n                                        <area shape=\"rect\" coords=\"529, 10, 599, 61\" href=\"http://www.hanibal.cz/blog/<%= '?' + urlParams %>\" target=\"_blank\" />\n                                        <area shape=\"rect\" coords=\"412, 10, 527, 61\" href=\"http://www.hanibal.cz/pujcovna/<%= '?' + urlParams %>\" target=\"_blank\" />\n                                        <area shape=\"rect\" coords=\"297, 10, 411, 61\" href=\"http://www.hanibal.cz/academy/<%= '?' + urlParams %>\" target=\"_blank\" />\n                                        <area shape=\"rect\" coords=\"206, 10, 296, 61\" href=\"http://www.hanibal.cz/<%= '?' + urlParams %>\" target=\"_blank\" />\n                                        <area shape=\"rect\" coords=\"1, 10, 206, 61\" href=\"http://www.hanibal.cz/<%= '?' + urlParams %>\" target=\"_blank\" />\n                                    </map>\n                                </td>\n                            </tr>\n                        </table>\n                        &nbsp;<br />\n                        <table width=\"600\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" bgcolor=\"white\">\n                            <tr>\n                                <td width=\"15\" rowspan=\"2\"></td>\n                                <td width=\"180\" valign=\"top\">\n                                    <!-- BEGIN OPUSTENY KOSIK, VELKY IMG -->\n                                    <table width=\"180\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\">\n                                        <tr>\n                                            <td style=\"font-size: 16px; color: #ff9525; font-family: Arial;\">\n                                                <a href=\"<%= appendUrlParams(products_basket[0].URL, urlParams) %>\" target=\"_blank\" style=\"color: #ff9525; text-decoration: none;\">\n                                                    <span style=\"color: #ff9525;\">\n                                                        <%= products_basket[0].name %>\n                                                    </span>\n                                                </a><br /><span style=\"font-size: 10px; line-height: 10px;\">&nbsp;</span>\n                                            </td>\n                                        </tr>\n                                        <tr>\n                                            <td style=\"font-size: 16px; color: #504d48; font-family: Arial;\">\n                                                <% if(products_basket[0].priceOrig){ %>\n                                                <strike><%= printPrice(products_basket[0].priceOrig) %>,-&nbsp;Kč</strike>  &nbsp;\n                                                <% } %>\n                                                <span style=\"color: #00483a; font-size: 20px;\"><%= printPrice(products_basket[0].price) %>&nbsp;Kč</span>\n                                                <br /><span style=\"font-size: 10px; line-height: 10px;\">&nbsp;</span>\n                                            </td>\n                                        </tr>\n                                        <tr>\n                                            <td align=\"center\">\n                                                <a href=\"<%= appendUrlParams(products_basket[0].URL, urlParams) %>\" target=\"_blank\">\n                                                    <img src=\"<%= products_basket[0].imageLink %>\" border=\"0\" /><!-- max. sirka obrazku 180px -->\n                                                </a>\n                                                <br /><span style=\"font-size: 10px; line-height: 10px;\">&nbsp;</span>\n                                            </td>\n                                        </tr>\n                                    </table>\n                                    <!-- END OPUSTENY KOSIK, VELKY IMG -->\n                                </td>\n                                <td width=\"30\" rowspan=\"2\"></td>\n                                <td width=\"360\" valign=\"top\" style=\"font-size: 14px; color: #43413c; font-family: Arial;\">\n                                    <%= email_osloveni ? email_osloveni : 'Ahoj' %>, <%= email_5pad ? email_5pad + ',' : '' %><br />\n                                    &nbsp;<br />\n\n                                    <% if (basketReminderStep == 'first') { %>\n                                    Všimla jsem si, že v košíku máte něco, co by se Vám mohlo hodit.<br />\n                                    &nbsp;<br />\n                                    Co se stalo? Potřebujete s něčím poradit? Nebo se něco pokazilo v nákupním procesu? Zavolejte mi nebo \n\nnapište email, ráda Vám pomůžu s čímkoliv bude potřeba!<br />\n\t\t\t\t\t\t\t\t\t<% } %>\n                                    \n                                    <% if (basketReminderStep == 'second') { %>\n                                    v košíku na Vás stále něco čeká. Stačí už jen málo a můžete mít skvělé vybavení doma! \n                                    Zavolejte mi nebo napište email, ráda Vám pomůžu s čímkoliv bude potřeba!<br />&nbsp;\n                                    <br />\n\t\t\t\t\t\t\t\t\tA navíc, <b>když dokončíte nákup,</b> přibalíme Vám do objednávky něco na zub – sušené maso Indiana Jerky! Stačí, abyste v košíku zadali kód: <b>\"Jerky\"</b> <br />&nbsp;\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t<br />\n\t\t\t\t\t\t\t\t\t<% if (basketTotal >= 2000) { %>\n\t\t\t\t\t\t\t\t\t   Mimoto <b>máte dopravu zdarma.</b><br />\n\t\t\t\t\t\t\t\t\t<% } else if (basketTotal > 1500) { %>\n\t\t\t\t\t\t\t\t\t   Mimoto Vám <b>zbývá už jen <%= 2000 - basketTotal %> Kč, abychom Vám nezaúčtovali poštovné.</b>  Nechcete si ještě něco vybrat?<br />\n                                    <% } %>\n                                    \n                                    \n                                    <% } %>\n                                    &nbsp;<br />\n                                    Parádní outdoorový den<br />\n                                    &nbsp;<br />\n                                    Terka<br />\n                                    &nbsp;<br />\n                                    <table width=\"360\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\">\n                                        <tr>\n                                            <td width=\"41\"></td>\n                                            <td width=\"50\" style=\"background-color: #2b6458;\">\n                                                <a href=\"<%= appendUrlParams('http://www.hanibal.cz/kosik/',urlParams) %>\" target=\"_blank\">\n                                                    <img src=\"http://s3-eu-west-1.amazonaws.com/cz.persoo.images/vqb36nehmep6dh1kbjpfpb4f/b_1.jpg\" border=\"0\" />\n                                                </a>\n                                            </td>\n                                            <td width=\"10\" style=\"background-color: #125345;\"></td>\n                                            <td width=\"180\" align=\"left\" valign=\"middle\" style=\"background-color: #125345; color: white; font-family: Arial; font-size: 14px;\">\n                                                <a href=\"<%= appendUrlParams('http://www.hanibal.cz/kosik/',urlParams) %>\" target=\"_blank\" style=\"color: #fffffe; text-decoration: none;\">\n                                                    <span style=\"color: #fffffe; font-weight: bold;\">\n                                                        Dokončit nákup\n                                                    </span>\n                                                </a>\n                                            </td>\n                                            <td width=\"10\" style=\"background-color: #125345;\"></td>\n                                            <td width=\"28\" style=\"background-color: #2b6458;\">\n                                                <a href=\"<%= appendUrlParams('http://www.hanibal.cz/kosik/',urlParams) %>\" target=\"_blank\">\n                                                    <img src=\"http://s3-eu-west-1.amazonaws.com/cz.persoo.images/vqb36nehmep6dh1kbjpfpb4f/b_2.jpg\" border=\"0\" />\n                                                </a>\n                                            </td>\n                                            <td width=\"41\"></td>\n                                        </tr>\n\n                                    </table>\n                                    <br />&nbsp;<br />&nbsp;<br />\n                                </td>\n                            </tr>\n                            <tr>\n                                <td width=\"180\" valign=\"top\">\n                                    <% for(var i=1;i<3&&i<products_basket.length;i++) { %>\n                                    <!-- BEGIN OPUSTENY KOSIK, MALY IMG -->\n                                    <table width=\"180\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" style=\"border-top: 1px solid #ff9525;\">                                        \n                                        <tr>\n                                            <td style=\"font-size: 16px; color: #ff9525; font-family: Arial;\" colspan=\"3\">\n                                                <span style=\"font-size: 10px; line-height: 10px;\">&nbsp;<br /></span>\n                                                <a href=\"<%= appendUrlParams(products_basket[i].URL, urlParams) %>\" target=\"_blank\" style=\"color: #ff9525; text-decoration: none;\">\n                                                    <span style=\"color: #ff9525;\">\n                                                        <%= products_basket[i].name %>\n                                                    </span>\n                                                </a><br />\n                                                <span style=\"font-size: 10px; line-height: 10px;\">&nbsp;</span>\n                                            </td>\n                                        </tr>\n                                        <tr>\n                                            <td align=\"center\" width=\"80\" valign=\"middle\">\n                                                <a href=\"<%= appendUrlParams(products_basket[i].URL, urlParams) %>\" target=\"_blank\">\n                                                    <img src=\"<%= products_basket[i].imageLink %>\" border=\"0\" style=\"max-width:50px; max-height:50px;\"/> <!-- max. sirka obrazku 80px -->\n                                                </a>\n                                            </td>\n                                            <td width=\"10\"></td>\n                                            <td align=\"right\" valign=\"middle\" style=\"font-size: 14px; color: #504d48; font-family: Arial;\">\n                                                <% if(products_basket[i].priceOrig){ %>\n                                                <strike><%= printPrice(products_basket[i].priceOrig) %>,-&nbsp;Kč</strike><br />\n                                                <% } %>\n                                                <span style=\"color: #00483a; font-size: 18px;\"><%= printPrice(products_basket[i].price) %>&nbsp;Kč</span>\n                                            </td>\n                                        </tr>\n                                        <tr>\n                                            <td>\n                                                <span style=\"font-size: 10px; line-height: 10px;\">&nbsp;<br /></span>\n                                            </td>\n                                        </tr>\n                                    </table>\n                                    <!-- END OPUSTENY KOSIK, MALY IMG -->\n                                    <% } %>\n                                    <% for(var i=3;i<4 && i<products_basket.length;i++) { %>\n                                    <!-- BEGIN OPUSTENY KOSIK, BEZ IMG -->\n                                    <table width=\"180\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" style=\"border-top: 1px solid #ff9525;\">\n                                        <tr>\n                                            <td style=\"font-size: 16px; color: #ff9525; font-family: Arial;\">\n                                                <span style=\"font-size: 10px; line-height: 10px;\">&nbsp;<br /></span>\n                                                <a href=\"<%= appendUrlParams(products_basket[i].URL, urlParams) %>\" target=\"_blank\" style=\"color: #ff9525; text-decoration: none;\">\n                                                    <span style=\"color: #ff9525;\">\n                                                        <%= products_basket[i].name %>\n                                                    </span>\n                                                </a><br /><span style=\"font-size: 10px; line-height: 10px;\">&nbsp;<br /></span>\n                                            </td>\n                                        </tr>\n                                        <tr>\n                                            <td style=\"font-size: 14px; color: #504d48; font-family: Arial;\">\n                                                <% if(products_basket[i].priceOrig){ %>\n                                                <strike><%= printPrice(products_basket[i].priceOrig) %>,-&nbsp;Kč</strike>  &nbsp;\n                                                <% } %>\n                                                <span style=\"color: #00483a; font-size: 18px;\"><%= printPrice(products_basket[i].price) %>&nbsp;Kč</span>\n                                                <br /><span style=\"font-size: 10px; line-height: 10px;\">&nbsp;<br /></span>\n                                            </td>\n                                        </tr>\n                                    </table>\n                                    <!-- BEGIN OPUSTENY KOSIK, BEZ IMG -->\n                                    <% } %>\n                                </td>\n                                <td width=\"360\" valign=\"top\" style=\"font-size: 14px; color: #43413c; font-family: Arial;\">\n                                    <table width=\"360\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\">\n                                        <tr>\n                                            <td colspan=\"3\" width=\"195\" height=\"37\" valign=\"middle\" style=\"font-family: Arial; color: #fffffe; background-color: #ff9525;\">\n                                                &nbsp;&nbsp;&nbsp;Poradím Vám\n                                            </td>\n                                            <td width=\"20\" rowspan=\"3\"></td>\n                                            <td width=\"145\" valign=\"top\" rowspan=\"3\">\n                                                <img src=\"http://s3-eu-west-1.amazonaws.com/cz.persoo.images/vqb36nehmep6dh1kbjpfpb4f/terka.jpg\" border=\"0\" />\n                                            </td>\n                                        </tr>\n                                        <tr>\n                                            <td align=\"left\" valign=\"middle\" height=\"40\" colspan=\"3\" style=\"font-size: 24px; font-family: Arial; color: #00483a;\">\n                                                Terka Valentová\n                                                <table width=\"195\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\">\n                                                    <tr>\n                                                        <td width=\"20\" height=\"35\"></td>\n                                                        <td width=\"30\" align=\"left\" valign=\"middle\" style=\"font-size: 0px;\"s>\n                                                            <img src=\"http://s3-eu-west-1.amazonaws.com/cz.persoo.images/vqb36nehmep6dh1kbjpfpb4f/call.jpg\" border=\"0\" />\n                                                        </td>\n                                                        <td align=\"left\" valign=\"middle\" style=\"font-size: 14px; font-family: Arial; color: #00483a;\">\n                                                            777 062 416\n                                                        </td>\n                                                    </tr>\n                                                    <tr>\n                                                        <td width=\"20\" height=\"35\"></td>\n                                                        <td width=\"30\" align=\"left\" valign=\"middle\" style=\"font-size: 0px;\">\n                                                            <img src=\"http://s3-eu-west-1.amazonaws.com/cz.persoo.images/vqb36nehmep6dh1kbjpfpb4f/time.jpg\" border=\"0\" />\n                                                        </td>\n                                                        <td align=\"left\" valign=\"middle\" style=\"font-size: 14px; font-family: Arial; color: #00483a;\">\n                                                            9:00 - 16:00\n                                                        </td>\n                                                    </tr>\n                                                    <tr>\n                                                        <td width=\"20\" height=\"35\"></td>\n                                                        <td width=\"30\" align=\"left\" valign=\"middle\" style=\"font-size: 0px;\">\n                                                            <img src=\"http://s3-eu-west-1.amazonaws.com/cz.persoo.images/vqb36nehmep6dh1kbjpfpb4f/mail.jpg\" border=\"0\" />\n                                                        </td>\n                                                        <td align=\"left\" valign=\"middle\" style=\"font-size: 14px; font-family: Arial; color: #00483a;\">\n                                                            <a href=\"mailto:terka@hanibal.cz\" style=\"color: #00483a; text-decoration: none;\">\n                                                                <span style=\"color: #00483a; text-decoration: none;\">\n                                                                    terka@hanibal.cz\n                                                                </span>\n                                                            </a>\n                                                        </td>\n                                                    </tr>\n                                                </table>\n                                            </td>\n                                        </tr>\n                                    </table>\n                                </td>\n                                <td width=\"15\"></td>\n                            </tr>\n                        </table>\n                        &nbsp;<br />\n                        <table width=\"600\" height=\"2\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" bgcolor=\"white\">\n                            <tr>\n                                <td height=\"2\" style=\"border-top: 1px solid #cdcdcd; border-bottom: 1px solid #cdcdcd;\"></td>\n                            </tr>\n                        </table>\n                        <table width=\"600\" height=\"2\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" bgcolor=\"white\">\n                            <tr>\n                                <td width=\"15\" rowspan=\"2\"></td>\n                                <td align=\"center\" valign=\"middle\" height=\"80\" colspan=\"5\" style=\"font-size: 24px; font-family: Arial; color: #00483a;\">\n                                    A přidávám ještě něco, co by se Vám mohlo hodit.\n                                </td>\n                                <td width=\"15\" rowspan=\"2\"></td>\n                            </tr>\n                            <tr>\n                                <% for(var i=0;i<3 && i < products_basket_recommended.length;i++) { %>\n                                <td width=\"180\" valign=\"bottom\">\n                                    <!-- PERSOO PRODUKT <%= i %> -->\n                                    <table width=\"180\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\">\n                                        <tr>\n                                            <td width=\"5\" style=\"background-color: #ff9525;\"></td>\n                                            <td height=\"40\" align=\"left\" valign=\"middle\" style=\"background-color: #ff9525; font-family: Arial; font-size: 14px; color: #fffffe; height:40px; line-height: 20px;\">\n                                                <div style=\"height:40px; overflow: hidden;\">\n                                                    <a href=\"<%= appendUrlParams(products_basket_recommended[i].link, urlParams) %>\" target=\"_blank\" name=\"persoo<%= i %>_title\" style=\"color: #fffffe; text-decoration: none;\">\n                                                        <span style=\"color: #fffffe;\">\n                                                            <%= products_basket_recommended[i].name %>\n                                                        </span>\n                                                    </a>\n                                                </div>\n                                            </td>\n                                            <td width=\"5\" style=\"background-color: #ff9525;\"></td>\n                                        </tr>\n                                        <tr>\n                                            <td colspan=\"3\" align=\"center\" valign=\"middle\" height=\"185\">\n                                                <a href=\"<%= appendUrlParams(products_basket_recommended[i].link, urlParams) %>\" target=\"_blank\" name=\"persoo<%= i %>_image\">\n                                                    <img src=\"<%= products_basket_recommended[i].imageLink %>\" border=\"0\" style=\"max-height: 170px; max-width: 175px;\" /> <!-- max. velikost obrazku 180px * 185px -->\n                                                </a>\n                                            </td>\n                                        </tr>\n                                        <tr>\n                                            <td colspan=\"3\">\n                                                <table width=\"180\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\">\n                                                    <tr>\n                                                        <td width=\"5\" style=\"background-color: #00483a;\"></td>\n                                                        <td align=\"center\" valign=\"middle\" width=\"67\" style=\"background-color: #00483a; font-family: Arial; font-size: 12px;\">\n                                                            <a href=\"<%= appendUrlParams(products_basket_recommended[i].link, urlParams) %>\" target=\"_blank\" name=\"persoo<%= i %>_zobrazit\" style=\"color: #fffffe; text-decoration: none;\">\n                                                                <span style=\"color: #fffffe;\">\n                                                                    ZOBRAZIT\n                                                                    PRODUKT\n                                                                </span>\n                                                            </a>\n                                                        </td>\n                                                        <td width=\"5\" style=\"background-color: #00483a;\"></td>\n                                                        <td width=\"25\" style=\"background-color: #2b6458;\">\n                                                            <a href=\"<%= products_basket_recommended[i].link + '?' + urlParams %>\" target=\"_blank\" name=\"persoo<%= i %>_arrow\">\n                                                                <img src=\"http://s3-eu-west-1.amazonaws.com/cz.persoo.images/vqb36nehmep6dh1kbjpfpb4f/b_3.jpg\" border=\"0\" />\n                                                            </a>\n                                                        </td>\n                                                        <td width=\"5\" style=\"background-color: #00483a;\"></td>\n                                                        <td width=\"68\" style=\"background-color: #00483a; font-family: Arial; font-size: 12px; font-weight: bold;\">\n                                                            <a href=\"<%= appendUrlParams(products_basket_recommended[i].link, urlParams) %>\" target=\"_blank\" name=\"persoo<%= i %>_price\" style=\"color: #fffffe; text-decoration: none;\">\n                                                                <span style=\"color: #fffffe;\">\n                                                                    <%= printPrice(products_basket_recommended[i].price) %>&nbsp;Kč\n                                                                </span>\n                                                            </a>\n                                                        </td>\n                                                        <td width=\"5\" style=\"background-color: #00483a;\"></td>\n                                                    </tr>\n                                                </table>\n                                            </td>\n                                        </tr>\n                                    </table>\n                                    <!-- END PERSOO PRODUKT <%= i %> -->\n                                </td>\n                                <% if (i<2) { %><td width=\"15\"></td><% } %>\n                                <% } %>\n                            </tr>\n                        </table>\n                        &nbsp;<br />\n                        <table width=\"600\" height=\"2\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" bgcolor=\"white\">\n                            <tr>\n                                <td colspan=\"3\" style=\"font-size: 0px;\">\n                                    <img src=\"http://s3-eu-west-1.amazonaws.com/cz.persoo.images/vqb36nehmep6dh1kbjpfpb4f/mount.jpg\" border=\"0\" />\n                                </td>\n                            </tr>\n                            <tr>\n                                <td width=\"15\" style=\"background-color: #dcd7cc;\"></td>\n                                <td style=\"background-color: #dcd7cc; font-family: Arial; font-size: 12px; color: #2d2d2d;\">\n                                    &nbsp;<br />\n                                     \n                                    <br />\n                                    &nbsp;<br />\n                                    © 2015 Hanibal.cz  All rights reserved.<br />\n                                    &nbsp;<br />\n                                    Tento email Vám byl zaslán na <%= email_email %> jako obchodní sdělení na základě Vašeho souhlasu. Děkujeme.<br />\n                                    &nbsp;<br />\n                                </td>\n                                <td width=\"15\" style=\"background-color: #dcd7cc;\"></td>\n                            </tr>\n                        </table>\n                    </td>\n                    <td style=\"background-color: #ece8dc; background-image: url('http://s3-eu-west-1.amazonaws.com/cz.persoo.images/vqb36nehmep6dh1kbjpfpb4f/bg.jpg');\"></td>\n                </tr>\n            </table>\n        </center>\n    </body>\n</html>",
                            "subject": "Nechybí Vám něco v batohu<%= db.mailchimp && db.mailchimp['5PAD'] ? ',' + db.mailchimp['5PAD'] : '' %>?",
                            "textBody": "<%\n// mapping products to be displayed here\nvar products_basket = products1 || [];\nvar products_basket_recommended = products2 || [];\n\nvar email_osloveni = db.mailchimp.OSLOVENI;\nvar email_5pad = db.mailchimp['5PAD'];\nvar email_email = db.bestIdentifications.email;\nvar basketTotal = 10;\n%>\n\n<%= email_osloveni ? email_osloveni : 'Ahoj' %>, <%= email_5pad ? email_5pad + ',' : '' %>\n\nVšimla jsem si, že v košíku máte něco, co by se Vám mohlo hodit.\n\nCo se stalo? Potřebujete s něčím poradit? Nebo se něco pokazilo v nákupním procesu? Zavolejte mi nebo napište email, ráda Vám pomůžu s čímkoliv bude potřeba!\n                      \nParádní outdoorový den\n\n       Terka"
                        },
                        "minTimeBeforeNextTrigger": 864000000,
                        "scenarios": {
                            "products1": "bcf7640656ab404aacaef9bcd5c9bc55",
                            "products2": "basketCrosssell"
                        },
                        "triggerFunction": "function trigger(io){\n    var send = false;\n    var lastBasketChange = io.db.lastAccesses.basketChange;\n    var lastPageview = io.db.lastAccesses.pageview;\n    \n    if(\n    \n    /* basket is non-empty */\n    io.db.products.inBasket &&\n    io.db.products.inBasket.length > 0 &&\n        \n    /* at least 2 hours after last visit */\n    atLeastNDaysAfter(lastPageview, 1/12) &&\n        \n    /* at most 3 days after basket status has Changed */\n    atMostNDaysAfter(lastBasketChange, 3) &&\n    \n    /* not already sent after last visit */\n    campaignNotAlreadySentAfter(lastPageview)\n        \n    ) {\n        return true;\n    } else {\n        return false;\n    }\n}"
                    }
                ]
            },
            {
                "id": "de5c074d3f274aab943054dbbfac3803",
                "name": "Basket reminder example",
                "class": "email",
                "isActive": false,
                "variants": [
                    {
                        "id": "default",
                        "name": "default",
                        "condition": "true",
                        "content": {
                            "googleAnalyticsCampaign": "exampleCampaignName",
                            "htmlBody": "<p>Come back and buy X.</p>",
                            "subject": "Your product X is on SALE",
                            "textBody": "Come back and buy X."
                        },
                        "minTimeBeforeNextTrigger": 1,
                        "scenarios": {
                            "products1": "psGeneral"
                        },
                        "triggerFunction": ""
                    }
                ]
            }
        ]

### newCampaign [POST]
Create a new campaign.

+ Request (application/json)

        {
            "name": "basketReminder1st",
            "class": "email",
            "isActive": true,
            "variants": [
                {
                    "id": "default",
                    "name": "default",
                    "condition": "db.products.inBasket && db.products.inBasket.length > 0",
                    "content": {
                        "googleAnalyticsCampaign": "basketReminder1st",
                        "htmlBody": "<%\nfunction printPrice(p){\n\treturn String(Math.round(p)).replace(/(.*)([0-9]{3})/,'$1 $2');\n}\nfunction appendUrlParams(url, params){\n   var parts =  url.split('#');\n   parts[0] += ( parts[0].indexOf('?')<0  ? '?' : '&') + params;\n   return parts.join('#');\n}\n\nvar basketReminderStep = 'first';\n\n// mapping products to be displayed here\nvar products_basket = products1 || [];\nvar products_basket_recommended = products2 || [];\nvar percent = String.fromCharCode(37);\nvar urlParams = 'persooCampaign=basketReminder1';\n\nvar email_osloveni = db.mailchimp.OSLOVENI;\nvar email_5pad = db.mailchimp['5PAD'];\nvar email_email = db.bestIdentifications.email;\nvar basketTotal = 10;\n\n%>\n<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\">\n<html lang=\"en\" xml:lang=\"en\" xmlns=\"http://www.w3.org/1999/xhtml\">\t   \n    <head>\t\t     \n        <title>    \n        </title>\t\t     \n        <meta content=\"text/html; charset=UTF-8\" http-equiv=\"content-type\" />\t\t     \n        <meta content=\"application/xhtml+xml; charset=UTF-8\" http-equiv=\"content-type\" />\t\t     \n        <meta content=\"width=device-width, initial scale=1\" name=\"viewport\" />\t   \n    </head>\t   \n    <body style=\"margin:0; padding: 0; background-color: #ece8dc; background-image: url('bg.jpg');\">\n        <center>\n            <span style=\"font-size: 1px; color: #ece8dc;\">\n                <% if (basketReminderStep == 'first') { %>\n                Co třeba <%= products_basket[0].name %>?\n                <% } %>\n                <% if (basketReminderStep == 'second') { %>\n                <%= products_basket[0].name %> už na Vás čeká. \n                <% } %>\n            </span>\n            <table style=\"width:100%;\" cellspacing=\"0\" cellpadding=\"0\">\n                <tr>\n                    <td style=\"background-color: #ece8dc; background-image: url('http://s3-eu-west-1.amazonaws.com/cz.persoo.images/vqb36nehmep6dh1kbjpfpb4f/bg.jpg');\"></td>\n                    <td width=\"600\" align=\"left\" bgcolor=\"white\" style=\"background-color: white;\">\n                        <table width=\"600\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" bgcolor=\"white\">\n                            <tr>\n                                <td>\n                                    <img src=\"http://s3-eu-west-1.amazonaws.com/cz.persoo.images/vqb36nehmep6dh1kbjpfpb4f/header.jpg\" alt=\"\" usemap=\"#map\" />\n                                    <map name=\"map\">\n                                        <area shape=\"rect\" coords=\"0, 63, 599, 159\" href=\"http://www.hanibal.cz/<%= '?' + urlParams %>\" target=\"_blank\" />\n                                        <area shape=\"rect\" coords=\"529, 10, 599, 61\" href=\"http://www.hanibal.cz/blog/<%= '?' + urlParams %>\" target=\"_blank\" />\n                                        <area shape=\"rect\" coords=\"412, 10, 527, 61\" href=\"http://www.hanibal.cz/pujcovna/<%= '?' + urlParams %>\" target=\"_blank\" />\n                                        <area shape=\"rect\" coords=\"297, 10, 411, 61\" href=\"http://www.hanibal.cz/academy/<%= '?' + urlParams %>\" target=\"_blank\" />\n                                        <area shape=\"rect\" coords=\"206, 10, 296, 61\" href=\"http://www.hanibal.cz/<%= '?' + urlParams %>\" target=\"_blank\" />\n                                        <area shape=\"rect\" coords=\"1, 10, 206, 61\" href=\"http://www.hanibal.cz/<%= '?' + urlParams %>\" target=\"_blank\" />\n                                    </map>\n                                </td>\n                            </tr>\n                        </table>\n                        &nbsp;<br />\n                        <table width=\"600\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" bgcolor=\"white\">\n                            <tr>\n                                <td width=\"15\" rowspan=\"2\"></td>\n                                <td width=\"180\" valign=\"top\">\n                                    <!-- BEGIN OPUSTENY KOSIK, VELKY IMG -->\n                                    <table width=\"180\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\">\n                                        <tr>\n                                            <td style=\"font-size: 16px; color: #ff9525; font-family: Arial;\">\n                                                <a href=\"<%= appendUrlParams(products_basket[0].URL, urlParams) %>\" target=\"_blank\" style=\"color: #ff9525; text-decoration: none;\">\n                                                    <span style=\"color: #ff9525;\">\n                                                        <%= products_basket[0].name %>\n                                                    </span>\n                                                </a><br /><span style=\"font-size: 10px; line-height: 10px;\">&nbsp;</span>\n                                            </td>\n                                        </tr>\n                                        <tr>\n                                            <td style=\"font-size: 16px; color: #504d48; font-family: Arial;\">\n                                                <% if(products_basket[0].priceOrig){ %>\n                                                <strike><%= printPrice(products_basket[0].priceOrig) %>,-&nbsp;Kč</strike>  &nbsp;\n                                                <% } %>\n                                                <span style=\"color: #00483a; font-size: 20px;\"><%= printPrice(products_basket[0].price) %>&nbsp;Kč</span>\n                                                <br /><span style=\"font-size: 10px; line-height: 10px;\">&nbsp;</span>\n                                            </td>\n                                        </tr>\n                                        <tr>\n                                            <td align=\"center\">\n                                                <a href=\"<%= appendUrlParams(products_basket[0].URL, urlParams) %>\" target=\"_blank\">\n                                                    <img src=\"<%= products_basket[0].imageLink %>\" border=\"0\" /><!-- max. sirka obrazku 180px -->\n                                                </a>\n                                                <br /><span style=\"font-size: 10px; line-height: 10px;\">&nbsp;</span>\n                                            </td>\n                                        </tr>\n                                    </table>\n                                    <!-- END OPUSTENY KOSIK, VELKY IMG -->\n                                </td>\n                                <td width=\"30\" rowspan=\"2\"></td>\n                                <td width=\"360\" valign=\"top\" style=\"font-size: 14px; color: #43413c; font-family: Arial;\">\n                                    <%= email_osloveni ? email_osloveni : 'Ahoj' %>, <%= email_5pad ? email_5pad + ',' : '' %><br />\n                                    &nbsp;<br />\n\n                                    <% if (basketReminderStep == 'first') { %>\n                                    Všimla jsem si, že v košíku máte něco, co by se Vám mohlo hodit.<br />\n                                    &nbsp;<br />\n                                    Co se stalo? Potřebujete s něčím poradit? Nebo se něco pokazilo v nákupním procesu? Zavolejte mi nebo \n\nnapište email, ráda Vám pomůžu s čímkoliv bude potřeba!<br />\n\t\t\t\t\t\t\t\t\t<% } %>\n                                    \n                                    <% if (basketReminderStep == 'second') { %>\n                                    v košíku na Vás stále něco čeká. Stačí už jen málo a můžete mít skvělé vybavení doma! \n                                    Zavolejte mi nebo napište email, ráda Vám pomůžu s čímkoliv bude potřeba!<br />&nbsp;\n                                    <br />\n\t\t\t\t\t\t\t\t\tA navíc, <b>když dokončíte nákup,</b> přibalíme Vám do objednávky něco na zub – sušené maso Indiana Jerky! Stačí, abyste v košíku zadali kód: <b>\"Jerky\"</b> <br />&nbsp;\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t<br />\n\t\t\t\t\t\t\t\t\t<% if (basketTotal >= 2000) { %>\n\t\t\t\t\t\t\t\t\t   Mimoto <b>máte dopravu zdarma.</b><br />\n\t\t\t\t\t\t\t\t\t<% } else if (basketTotal > 1500) { %>\n\t\t\t\t\t\t\t\t\t   Mimoto Vám <b>zbývá už jen <%= 2000 - basketTotal %> Kč, abychom Vám nezaúčtovali poštovné.</b>  Nechcete si ještě něco vybrat?<br />\n                                    <% } %>\n                                    \n                                    \n                                    <% } %>\n                                    &nbsp;<br />\n                                    Parádní outdoorový den<br />\n                                    &nbsp;<br />\n                                    Terka<br />\n                                    &nbsp;<br />\n                                    <table width=\"360\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\">\n                                        <tr>\n                                            <td width=\"41\"></td>\n                                            <td width=\"50\" style=\"background-color: #2b6458;\">\n                                                <a href=\"<%= appendUrlParams('http://www.hanibal.cz/kosik/',urlParams) %>\" target=\"_blank\">\n                                                    <img src=\"http://s3-eu-west-1.amazonaws.com/cz.persoo.images/vqb36nehmep6dh1kbjpfpb4f/b_1.jpg\" border=\"0\" />\n                                                </a>\n                                            </td>\n                                            <td width=\"10\" style=\"background-color: #125345;\"></td>\n                                            <td width=\"180\" align=\"left\" valign=\"middle\" style=\"background-color: #125345; color: white; font-family: Arial; font-size: 14px;\">\n                                                <a href=\"<%= appendUrlParams('http://www.hanibal.cz/kosik/',urlParams) %>\" target=\"_blank\" style=\"color: #fffffe; text-decoration: none;\">\n                                                    <span style=\"color: #fffffe; font-weight: bold;\">\n                                                        Dokončit nákup\n                                                    </span>\n                                                </a>\n                                            </td>\n                                            <td width=\"10\" style=\"background-color: #125345;\"></td>\n                                            <td width=\"28\" style=\"background-color: #2b6458;\">\n                                                <a href=\"<%= appendUrlParams('http://www.hanibal.cz/kosik/',urlParams) %>\" target=\"_blank\">\n                                                    <img src=\"http://s3-eu-west-1.amazonaws.com/cz.persoo.images/vqb36nehmep6dh1kbjpfpb4f/b_2.jpg\" border=\"0\" />\n                                                </a>\n                                            </td>\n                                            <td width=\"41\"></td>\n                                        </tr>\n\n                                    </table>\n                                    <br />&nbsp;<br />&nbsp;<br />\n                                </td>\n                            </tr>\n                            <tr>\n                                <td width=\"180\" valign=\"top\">\n                                    <% for(var i=1;i<3&&i<products_basket.length;i++) { %>\n                                    <!-- BEGIN OPUSTENY KOSIK, MALY IMG -->\n                                    <table width=\"180\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" style=\"border-top: 1px solid #ff9525;\">                                        \n                                        <tr>\n                                            <td style=\"font-size: 16px; color: #ff9525; font-family: Arial;\" colspan=\"3\">\n                                                <span style=\"font-size: 10px; line-height: 10px;\">&nbsp;<br /></span>\n                                                <a href=\"<%= appendUrlParams(products_basket[i].URL, urlParams) %>\" target=\"_blank\" style=\"color: #ff9525; text-decoration: none;\">\n                                                    <span style=\"color: #ff9525;\">\n                                                        <%= products_basket[i].name %>\n                                                    </span>\n                                                </a><br />\n                                                <span style=\"font-size: 10px; line-height: 10px;\">&nbsp;</span>\n                                            </td>\n                                        </tr>\n                                        <tr>\n                                            <td align=\"center\" width=\"80\" valign=\"middle\">\n                                                <a href=\"<%= appendUrlParams(products_basket[i].URL, urlParams) %>\" target=\"_blank\">\n                                                    <img src=\"<%= products_basket[i].imageLink %>\" border=\"0\" style=\"max-width:50px; max-height:50px;\"/> <!-- max. sirka obrazku 80px -->\n                                                </a>\n                                            </td>\n                                            <td width=\"10\"></td>\n                                            <td align=\"right\" valign=\"middle\" style=\"font-size: 14px; color: #504d48; font-family: Arial;\">\n                                                <% if(products_basket[i].priceOrig){ %>\n                                                <strike><%= printPrice(products_basket[i].priceOrig) %>,-&nbsp;Kč</strike><br />\n                                                <% } %>\n                                                <span style=\"color: #00483a; font-size: 18px;\"><%= printPrice(products_basket[i].price) %>&nbsp;Kč</span>\n                                            </td>\n                                        </tr>\n                                        <tr>\n                                            <td>\n                                                <span style=\"font-size: 10px; line-height: 10px;\">&nbsp;<br /></span>\n                                            </td>\n                                        </tr>\n                                    </table>\n                                    <!-- END OPUSTENY KOSIK, MALY IMG -->\n                                    <% } %>\n                                    <% for(var i=3;i<4 && i<products_basket.length;i++) { %>\n                                    <!-- BEGIN OPUSTENY KOSIK, BEZ IMG -->\n                                    <table width=\"180\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" style=\"border-top: 1px solid #ff9525;\">\n                                        <tr>\n                                            <td style=\"font-size: 16px; color: #ff9525; font-family: Arial;\">\n                                                <span style=\"font-size: 10px; line-height: 10px;\">&nbsp;<br /></span>\n                                                <a href=\"<%= appendUrlParams(products_basket[i].URL, urlParams) %>\" target=\"_blank\" style=\"color: #ff9525; text-decoration: none;\">\n                                                    <span style=\"color: #ff9525;\">\n                                                        <%= products_basket[i].name %>\n                                                    </span>\n                                                </a><br /><span style=\"font-size: 10px; line-height: 10px;\">&nbsp;<br /></span>\n                                            </td>\n                                        </tr>\n                                        <tr>\n                                            <td style=\"font-size: 14px; color: #504d48; font-family: Arial;\">\n                                                <% if(products_basket[i].priceOrig){ %>\n                                                <strike><%= printPrice(products_basket[i].priceOrig) %>,-&nbsp;Kč</strike>  &nbsp;\n                                                <% } %>\n                                                <span style=\"color: #00483a; font-size: 18px;\"><%= printPrice(products_basket[i].price) %>&nbsp;Kč</span>\n                                                <br /><span style=\"font-size: 10px; line-height: 10px;\">&nbsp;<br /></span>\n                                            </td>\n                                        </tr>\n                                    </table>\n                                    <!-- BEGIN OPUSTENY KOSIK, BEZ IMG -->\n                                    <% } %>\n                                </td>\n                                <td width=\"360\" valign=\"top\" style=\"font-size: 14px; color: #43413c; font-family: Arial;\">\n                                    <table width=\"360\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\">\n                                        <tr>\n                                            <td colspan=\"3\" width=\"195\" height=\"37\" valign=\"middle\" style=\"font-family: Arial; color: #fffffe; background-color: #ff9525;\">\n                                                &nbsp;&nbsp;&nbsp;Poradím Vám\n                                            </td>\n                                            <td width=\"20\" rowspan=\"3\"></td>\n                                            <td width=\"145\" valign=\"top\" rowspan=\"3\">\n                                                <img src=\"http://s3-eu-west-1.amazonaws.com/cz.persoo.images/vqb36nehmep6dh1kbjpfpb4f/terka.jpg\" border=\"0\" />\n                                            </td>\n                                        </tr>\n                                        <tr>\n                                            <td align=\"left\" valign=\"middle\" height=\"40\" colspan=\"3\" style=\"font-size: 24px; font-family: Arial; color: #00483a;\">\n                                                Terka Valentová\n                                                <table width=\"195\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\">\n                                                    <tr>\n                                                        <td width=\"20\" height=\"35\"></td>\n                                                        <td width=\"30\" align=\"left\" valign=\"middle\" style=\"font-size: 0px;\"s>\n                                                            <img src=\"http://s3-eu-west-1.amazonaws.com/cz.persoo.images/vqb36nehmep6dh1kbjpfpb4f/call.jpg\" border=\"0\" />\n                                                        </td>\n                                                        <td align=\"left\" valign=\"middle\" style=\"font-size: 14px; font-family: Arial; color: #00483a;\">\n                                                            777 062 416\n                                                        </td>\n                                                    </tr>\n                                                    <tr>\n                                                        <td width=\"20\" height=\"35\"></td>\n                                                        <td width=\"30\" align=\"left\" valign=\"middle\" style=\"font-size: 0px;\">\n                                                            <img src=\"http://s3-eu-west-1.amazonaws.com/cz.persoo.images/vqb36nehmep6dh1kbjpfpb4f/time.jpg\" border=\"0\" />\n                                                        </td>\n                                                        <td align=\"left\" valign=\"middle\" style=\"font-size: 14px; font-family: Arial; color: #00483a;\">\n                                                            9:00 - 16:00\n                                                        </td>\n                                                    </tr>\n                                                    <tr>\n                                                        <td width=\"20\" height=\"35\"></td>\n                                                        <td width=\"30\" align=\"left\" valign=\"middle\" style=\"font-size: 0px;\">\n                                                            <img src=\"http://s3-eu-west-1.amazonaws.com/cz.persoo.images/vqb36nehmep6dh1kbjpfpb4f/mail.jpg\" border=\"0\" />\n                                                        </td>\n                                                        <td align=\"left\" valign=\"middle\" style=\"font-size: 14px; font-family: Arial; color: #00483a;\">\n                                                            <a href=\"mailto:terka@hanibal.cz\" style=\"color: #00483a; text-decoration: none;\">\n                                                                <span style=\"color: #00483a; text-decoration: none;\">\n                                                                    terka@hanibal.cz\n                                                                </span>\n                                                            </a>\n                                                        </td>\n                                                    </tr>\n                                                </table>\n                                            </td>\n                                        </tr>\n                                    </table>\n                                </td>\n                                <td width=\"15\"></td>\n                            </tr>\n                        </table>\n                        &nbsp;<br />\n                        <table width=\"600\" height=\"2\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" bgcolor=\"white\">\n                            <tr>\n                                <td height=\"2\" style=\"border-top: 1px solid #cdcdcd; border-bottom: 1px solid #cdcdcd;\"></td>\n                            </tr>\n                        </table>\n                        <table width=\"600\" height=\"2\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" bgcolor=\"white\">\n                            <tr>\n                                <td width=\"15\" rowspan=\"2\"></td>\n                                <td align=\"center\" valign=\"middle\" height=\"80\" colspan=\"5\" style=\"font-size: 24px; font-family: Arial; color: #00483a;\">\n                                    A přidávám ještě něco, co by se Vám mohlo hodit.\n                                </td>\n                                <td width=\"15\" rowspan=\"2\"></td>\n                            </tr>\n                            <tr>\n                                <% for(var i=0;i<3 && i < products_basket_recommended.length;i++) { %>\n                                <td width=\"180\" valign=\"bottom\">\n                                    <!-- PERSOO PRODUKT <%= i %> -->\n                                    <table width=\"180\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\">\n                                        <tr>\n                                            <td width=\"5\" style=\"background-color: #ff9525;\"></td>\n                                            <td height=\"40\" align=\"left\" valign=\"middle\" style=\"background-color: #ff9525; font-family: Arial; font-size: 14px; color: #fffffe; height:40px; line-height: 20px;\">\n                                                <div style=\"height:40px; overflow: hidden;\">\n                                                    <a href=\"<%= appendUrlParams(products_basket_recommended[i].link, urlParams) %>\" target=\"_blank\" name=\"persoo<%= i %>_title\" style=\"color: #fffffe; text-decoration: none;\">\n                                                        <span style=\"color: #fffffe;\">\n                                                            <%= products_basket_recommended[i].name %>\n                                                        </span>\n                                                    </a>\n                                                </div>\n                                            </td>\n                                            <td width=\"5\" style=\"background-color: #ff9525;\"></td>\n                                        </tr>\n                                        <tr>\n                                            <td colspan=\"3\" align=\"center\" valign=\"middle\" height=\"185\">\n                                                <a href=\"<%= appendUrlParams(products_basket_recommended[i].link, urlParams) %>\" target=\"_blank\" name=\"persoo<%= i %>_image\">\n                                                    <img src=\"<%= products_basket_recommended[i].imageLink %>\" border=\"0\" style=\"max-height: 170px; max-width: 175px;\" /> <!-- max. velikost obrazku 180px * 185px -->\n                                                </a>\n                                            </td>\n                                        </tr>\n                                        <tr>\n                                            <td colspan=\"3\">\n                                                <table width=\"180\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\">\n                                                    <tr>\n                                                        <td width=\"5\" style=\"background-color: #00483a;\"></td>\n                                                        <td align=\"center\" valign=\"middle\" width=\"67\" style=\"background-color: #00483a; font-family: Arial; font-size: 12px;\">\n                                                            <a href=\"<%= appendUrlParams(products_basket_recommended[i].link, urlParams) %>\" target=\"_blank\" name=\"persoo<%= i %>_zobrazit\" style=\"color: #fffffe; text-decoration: none;\">\n                                                                <span style=\"color: #fffffe;\">\n                                                                    ZOBRAZIT\n                                                                    PRODUKT\n                                                                </span>\n                                                            </a>\n                                                        </td>\n                                                        <td width=\"5\" style=\"background-color: #00483a;\"></td>\n                                                        <td width=\"25\" style=\"background-color: #2b6458;\">\n                                                            <a href=\"<%= products_basket_recommended[i].link + '?' + urlParams %>\" target=\"_blank\" name=\"persoo<%= i %>_arrow\">\n                                                                <img src=\"http://s3-eu-west-1.amazonaws.com/cz.persoo.images/vqb36nehmep6dh1kbjpfpb4f/b_3.jpg\" border=\"0\" />\n                                                            </a>\n                                                        </td>\n                                                        <td width=\"5\" style=\"background-color: #00483a;\"></td>\n                                                        <td width=\"68\" style=\"background-color: #00483a; font-family: Arial; font-size: 12px; font-weight: bold;\">\n                                                            <a href=\"<%= appendUrlParams(products_basket_recommended[i].link, urlParams) %>\" target=\"_blank\" name=\"persoo<%= i %>_price\" style=\"color: #fffffe; text-decoration: none;\">\n                                                                <span style=\"color: #fffffe;\">\n                                                                    <%= printPrice(products_basket_recommended[i].price) %>&nbsp;Kč\n                                                                </span>\n                                                            </a>\n                                                        </td>\n                                                        <td width=\"5\" style=\"background-color: #00483a;\"></td>\n                                                    </tr>\n                                                </table>\n                                            </td>\n                                        </tr>\n                                    </table>\n                                    <!-- END PERSOO PRODUKT <%= i %> -->\n                                </td>\n                                <% if (i<2) { %><td width=\"15\"></td><% } %>\n                                <% } %>\n                            </tr>\n                        </table>\n                        &nbsp;<br />\n                        <table width=\"600\" height=\"2\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" bgcolor=\"white\">\n                            <tr>\n                                <td colspan=\"3\" style=\"font-size: 0px;\">\n                                    <img src=\"http://s3-eu-west-1.amazonaws.com/cz.persoo.images/vqb36nehmep6dh1kbjpfpb4f/mount.jpg\" border=\"0\" />\n                                </td>\n                            </tr>\n                            <tr>\n                                <td width=\"15\" style=\"background-color: #dcd7cc;\"></td>\n                                <td style=\"background-color: #dcd7cc; font-family: Arial; font-size: 12px; color: #2d2d2d;\">\n                                    &nbsp;<br />\n                                     \n                                    <br />\n                                    &nbsp;<br />\n                                    © 2015 Hanibal.cz  All rights reserved.<br />\n                                    &nbsp;<br />\n                                    Tento email Vám byl zaslán na <%= email_email %> jako obchodní sdělení na základě Vašeho souhlasu. Děkujeme.<br />\n                                    &nbsp;<br />\n                                </td>\n                                <td width=\"15\" style=\"background-color: #dcd7cc;\"></td>\n                            </tr>\n                        </table>\n                    </td>\n                    <td style=\"background-color: #ece8dc; background-image: url('http://s3-eu-west-1.amazonaws.com/cz.persoo.images/vqb36nehmep6dh1kbjpfpb4f/bg.jpg');\"></td>\n                </tr>\n            </table>\n        </center>\n    </body>\n</html>",
                        "subject": "Nechybí Vám něco v batohu<%= db.mailchimp && db.mailchimp['5PAD'] ? ',' + db.mailchimp['5PAD'] : '' %>?",
                        "textBody": "<%\n// mapping products to be displayed here\nvar products_basket = products1 || [];\nvar products_basket_recommended = products2 || [];\n\nvar email_osloveni = db.mailchimp.OSLOVENI;\nvar email_5pad = db.mailchimp['5PAD'];\nvar email_email = db.bestIdentifications.email;\nvar basketTotal = 10;\n%>\n\n<%= email_osloveni ? email_osloveni : 'Ahoj' %>, <%= email_5pad ? email_5pad + ',' : '' %>\n\nVšimla jsem si, že v košíku máte něco, co by se Vám mohlo hodit.\n\nCo se stalo? Potřebujete s něčím poradit? Nebo se něco pokazilo v nákupním procesu? Zavolejte mi nebo napište email, ráda Vám pomůžu s čímkoliv bude potřeba!\n                      \nParádní outdoorový den\n\n       Terka"
                    },
                    "minTimeBeforeNextTrigger": 864000000,
                    "scenarios": {
                        "products1": "bcf7640656ab404aacaef9bcd5c9bc55",
                        "products2": "basketCrosssell"
                    },
                    "triggerFunction": "function trigger(io){\n    var send = false;\n    var lastBasketChange = io.db.lastAccesses.basketChange;\n    var lastPageview = io.db.lastAccesses.pageview;\n    \n    if(\n    \n    /* basket is non-empty */\n    io.db.products.inBasket &&\n    io.db.products.inBasket.length > 0 &&\n        \n    /* at least 2 hours after last visit */\n    atLeastNDaysAfter(lastPageview, 1/12) &&\n        \n    /* at most 3 days after basket status has Changed */\n    atMostNDaysAfter(lastBasketChange, 3) &&\n    \n    /* not already sent after last visit */\n    campaignNotAlreadySentAfter(lastPageview)\n        \n    ) {\n        return true;\n    } else {\n        return false;\n    }\n}"
                }
            ]
        }

+ Response 201 (application/json)

        {
            "id": "e739f150fa504c7a87634e124a6e6414",
            "name": "basketReminder1st",
            "class": "email",
            "isActive": true,
            "variants": [
                {
                    "id": "default",
                    "name": "default",
                    "condition": "db.products.inBasket && db.products.inBasket.length > 0",
                    "content": {
                        "googleAnalyticsCampaign": "basketReminder1st",
                        "htmlBody": "<%\nfunction printPrice(p){\n\treturn String(Math.round(p)).replace(/(.*)([0-9]{3})/,'$1 $2');\n}\nfunction appendUrlParams(url, params){\n   var parts =  url.split('#');\n   parts[0] += ( parts[0].indexOf('?')<0  ? '?' : '&') + params;\n   return parts.join('#');\n}\n\nvar basketReminderStep = 'first';\n\n// mapping products to be displayed here\nvar products_basket = products1 || [];\nvar products_basket_recommended = products2 || [];\nvar percent = String.fromCharCode(37);\nvar urlParams = 'persooCampaign=basketReminder1';\n\nvar email_osloveni = db.mailchimp.OSLOVENI;\nvar email_5pad = db.mailchimp['5PAD'];\nvar email_email = db.bestIdentifications.email;\nvar basketTotal = 10;\n\n%>\n<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\">\n<html lang=\"en\" xml:lang=\"en\" xmlns=\"http://www.w3.org/1999/xhtml\">\t   \n    <head>\t\t     \n        <title>    \n        </title>\t\t     \n        <meta content=\"text/html; charset=UTF-8\" http-equiv=\"content-type\" />\t\t     \n        <meta content=\"application/xhtml+xml; charset=UTF-8\" http-equiv=\"content-type\" />\t\t     \n        <meta content=\"width=device-width, initial scale=1\" name=\"viewport\" />\t   \n    </head>\t   \n    <body style=\"margin:0; padding: 0; background-color: #ece8dc; background-image: url('bg.jpg');\">\n        <center>\n            <span style=\"font-size: 1px; color: #ece8dc;\">\n                <% if (basketReminderStep == 'first') { %>\n                Co třeba <%= products_basket[0].name %>?\n                <% } %>\n                <% if (basketReminderStep == 'second') { %>\n                <%= products_basket[0].name %> už na Vás čeká. \n                <% } %>\n            </span>\n            <table style=\"width:100%;\" cellspacing=\"0\" cellpadding=\"0\">\n                <tr>\n                    <td style=\"background-color: #ece8dc; background-image: url('http://s3-eu-west-1.amazonaws.com/cz.persoo.images/vqb36nehmep6dh1kbjpfpb4f/bg.jpg');\"></td>\n                    <td width=\"600\" align=\"left\" bgcolor=\"white\" style=\"background-color: white;\">\n                        <table width=\"600\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" bgcolor=\"white\">\n                            <tr>\n                                <td>\n                                    <img src=\"http://s3-eu-west-1.amazonaws.com/cz.persoo.images/vqb36nehmep6dh1kbjpfpb4f/header.jpg\" alt=\"\" usemap=\"#map\" />\n                                    <map name=\"map\">\n                                        <area shape=\"rect\" coords=\"0, 63, 599, 159\" href=\"http://www.hanibal.cz/<%= '?' + urlParams %>\" target=\"_blank\" />\n                                        <area shape=\"rect\" coords=\"529, 10, 599, 61\" href=\"http://www.hanibal.cz/blog/<%= '?' + urlParams %>\" target=\"_blank\" />\n                                        <area shape=\"rect\" coords=\"412, 10, 527, 61\" href=\"http://www.hanibal.cz/pujcovna/<%= '?' + urlParams %>\" target=\"_blank\" />\n                                        <area shape=\"rect\" coords=\"297, 10, 411, 61\" href=\"http://www.hanibal.cz/academy/<%= '?' + urlParams %>\" target=\"_blank\" />\n                                        <area shape=\"rect\" coords=\"206, 10, 296, 61\" href=\"http://www.hanibal.cz/<%= '?' + urlParams %>\" target=\"_blank\" />\n                                        <area shape=\"rect\" coords=\"1, 10, 206, 61\" href=\"http://www.hanibal.cz/<%= '?' + urlParams %>\" target=\"_blank\" />\n                                    </map>\n                                </td>\n                            </tr>\n                        </table>\n                        &nbsp;<br />\n                        <table width=\"600\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" bgcolor=\"white\">\n                            <tr>\n                                <td width=\"15\" rowspan=\"2\"></td>\n                                <td width=\"180\" valign=\"top\">\n                                    <!-- BEGIN OPUSTENY KOSIK, VELKY IMG -->\n                                    <table width=\"180\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\">\n                                        <tr>\n                                            <td style=\"font-size: 16px; color: #ff9525; font-family: Arial;\">\n                                                <a href=\"<%= appendUrlParams(products_basket[0].URL, urlParams) %>\" target=\"_blank\" style=\"color: #ff9525; text-decoration: none;\">\n                                                    <span style=\"color: #ff9525;\">\n                                                        <%= products_basket[0].name %>\n                                                    </span>\n                                                </a><br /><span style=\"font-size: 10px; line-height: 10px;\">&nbsp;</span>\n                                            </td>\n                                        </tr>\n                                        <tr>\n                                            <td style=\"font-size: 16px; color: #504d48; font-family: Arial;\">\n                                                <% if(products_basket[0].priceOrig){ %>\n                                                <strike><%= printPrice(products_basket[0].priceOrig) %>,-&nbsp;Kč</strike>  &nbsp;\n                                                <% } %>\n                                                <span style=\"color: #00483a; font-size: 20px;\"><%= printPrice(products_basket[0].price) %>&nbsp;Kč</span>\n                                                <br /><span style=\"font-size: 10px; line-height: 10px;\">&nbsp;</span>\n                                            </td>\n                                        </tr>\n                                        <tr>\n                                            <td align=\"center\">\n                                                <a href=\"<%= appendUrlParams(products_basket[0].URL, urlParams) %>\" target=\"_blank\">\n                                                    <img src=\"<%= products_basket[0].imageLink %>\" border=\"0\" /><!-- max. sirka obrazku 180px -->\n                                                </a>\n                                                <br /><span style=\"font-size: 10px; line-height: 10px;\">&nbsp;</span>\n                                            </td>\n                                        </tr>\n                                    </table>\n                                    <!-- END OPUSTENY KOSIK, VELKY IMG -->\n                                </td>\n                                <td width=\"30\" rowspan=\"2\"></td>\n                                <td width=\"360\" valign=\"top\" style=\"font-size: 14px; color: #43413c; font-family: Arial;\">\n                                    <%= email_osloveni ? email_osloveni : 'Ahoj' %>, <%= email_5pad ? email_5pad + ',' : '' %><br />\n                                    &nbsp;<br />\n\n                                    <% if (basketReminderStep == 'first') { %>\n                                    Všimla jsem si, že v košíku máte něco, co by se Vám mohlo hodit.<br />\n                                    &nbsp;<br />\n                                    Co se stalo? Potřebujete s něčím poradit? Nebo se něco pokazilo v nákupním procesu? Zavolejte mi nebo \n\nnapište email, ráda Vám pomůžu s čímkoliv bude potřeba!<br />\n\t\t\t\t\t\t\t\t\t<% } %>\n                                    \n                                    <% if (basketReminderStep == 'second') { %>\n                                    v košíku na Vás stále něco čeká. Stačí už jen málo a můžete mít skvělé vybavení doma! \n                                    Zavolejte mi nebo napište email, ráda Vám pomůžu s čímkoliv bude potřeba!<br />&nbsp;\n                                    <br />\n\t\t\t\t\t\t\t\t\tA navíc, <b>když dokončíte nákup,</b> přibalíme Vám do objednávky něco na zub – sušené maso Indiana Jerky! Stačí, abyste v košíku zadali kód: <b>\"Jerky\"</b> <br />&nbsp;\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t<br />\n\t\t\t\t\t\t\t\t\t<% if (basketTotal >= 2000) { %>\n\t\t\t\t\t\t\t\t\t   Mimoto <b>máte dopravu zdarma.</b><br />\n\t\t\t\t\t\t\t\t\t<% } else if (basketTotal > 1500) { %>\n\t\t\t\t\t\t\t\t\t   Mimoto Vám <b>zbývá už jen <%= 2000 - basketTotal %> Kč, abychom Vám nezaúčtovali poštovné.</b>  Nechcete si ještě něco vybrat?<br />\n                                    <% } %>\n                                    \n                                    \n                                    <% } %>\n                                    &nbsp;<br />\n                                    Parádní outdoorový den<br />\n                                    &nbsp;<br />\n                                    Terka<br />\n                                    &nbsp;<br />\n                                    <table width=\"360\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\">\n                                        <tr>\n                                            <td width=\"41\"></td>\n                                            <td width=\"50\" style=\"background-color: #2b6458;\">\n                                                <a href=\"<%= appendUrlParams('http://www.hanibal.cz/kosik/',urlParams) %>\" target=\"_blank\">\n                                                    <img src=\"http://s3-eu-west-1.amazonaws.com/cz.persoo.images/vqb36nehmep6dh1kbjpfpb4f/b_1.jpg\" border=\"0\" />\n                                                </a>\n                                            </td>\n                                            <td width=\"10\" style=\"background-color: #125345;\"></td>\n                                            <td width=\"180\" align=\"left\" valign=\"middle\" style=\"background-color: #125345; color: white; font-family: Arial; font-size: 14px;\">\n                                                <a href=\"<%= appendUrlParams('http://www.hanibal.cz/kosik/',urlParams) %>\" target=\"_blank\" style=\"color: #fffffe; text-decoration: none;\">\n                                                    <span style=\"color: #fffffe; font-weight: bold;\">\n                                                        Dokončit nákup\n                                                    </span>\n                                                </a>\n                                            </td>\n                                            <td width=\"10\" style=\"background-color: #125345;\"></td>\n                                            <td width=\"28\" style=\"background-color: #2b6458;\">\n                                                <a href=\"<%= appendUrlParams('http://www.hanibal.cz/kosik/',urlParams) %>\" target=\"_blank\">\n                                                    <img src=\"http://s3-eu-west-1.amazonaws.com/cz.persoo.images/vqb36nehmep6dh1kbjpfpb4f/b_2.jpg\" border=\"0\" />\n                                                </a>\n                                            </td>\n                                            <td width=\"41\"></td>\n                                        </tr>\n\n                                    </table>\n                                    <br />&nbsp;<br />&nbsp;<br />\n                                </td>\n                            </tr>\n                            <tr>\n                                <td width=\"180\" valign=\"top\">\n                                    <% for(var i=1;i<3&&i<products_basket.length;i++) { %>\n                                    <!-- BEGIN OPUSTENY KOSIK, MALY IMG -->\n                                    <table width=\"180\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" style=\"border-top: 1px solid #ff9525;\">                                        \n                                        <tr>\n                                            <td style=\"font-size: 16px; color: #ff9525; font-family: Arial;\" colspan=\"3\">\n                                                <span style=\"font-size: 10px; line-height: 10px;\">&nbsp;<br /></span>\n                                                <a href=\"<%= appendUrlParams(products_basket[i].URL, urlParams) %>\" target=\"_blank\" style=\"color: #ff9525; text-decoration: none;\">\n                                                    <span style=\"color: #ff9525;\">\n                                                        <%= products_basket[i].name %>\n                                                    </span>\n                                                </a><br />\n                                                <span style=\"font-size: 10px; line-height: 10px;\">&nbsp;</span>\n                                            </td>\n                                        </tr>\n                                        <tr>\n                                            <td align=\"center\" width=\"80\" valign=\"middle\">\n                                                <a href=\"<%= appendUrlParams(products_basket[i].URL, urlParams) %>\" target=\"_blank\">\n                                                    <img src=\"<%= products_basket[i].imageLink %>\" border=\"0\" style=\"max-width:50px; max-height:50px;\"/> <!-- max. sirka obrazku 80px -->\n                                                </a>\n                                            </td>\n                                            <td width=\"10\"></td>\n                                            <td align=\"right\" valign=\"middle\" style=\"font-size: 14px; color: #504d48; font-family: Arial;\">\n                                                <% if(products_basket[i].priceOrig){ %>\n                                                <strike><%= printPrice(products_basket[i].priceOrig) %>,-&nbsp;Kč</strike><br />\n                                                <% } %>\n                                                <span style=\"color: #00483a; font-size: 18px;\"><%= printPrice(products_basket[i].price) %>&nbsp;Kč</span>\n                                            </td>\n                                        </tr>\n                                        <tr>\n                                            <td>\n                                                <span style=\"font-size: 10px; line-height: 10px;\">&nbsp;<br /></span>\n                                            </td>\n                                        </tr>\n                                    </table>\n                                    <!-- END OPUSTENY KOSIK, MALY IMG -->\n                                    <% } %>\n                                    <% for(var i=3;i<4 && i<products_basket.length;i++) { %>\n                                    <!-- BEGIN OPUSTENY KOSIK, BEZ IMG -->\n                                    <table width=\"180\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" style=\"border-top: 1px solid #ff9525;\">\n                                        <tr>\n                                            <td style=\"font-size: 16px; color: #ff9525; font-family: Arial;\">\n                                                <span style=\"font-size: 10px; line-height: 10px;\">&nbsp;<br /></span>\n                                                <a href=\"<%= appendUrlParams(products_basket[i].URL, urlParams) %>\" target=\"_blank\" style=\"color: #ff9525; text-decoration: none;\">\n                                                    <span style=\"color: #ff9525;\">\n                                                        <%= products_basket[i].name %>\n                                                    </span>\n                                                </a><br /><span style=\"font-size: 10px; line-height: 10px;\">&nbsp;<br /></span>\n                                            </td>\n                                        </tr>\n                                        <tr>\n                                            <td style=\"font-size: 14px; color: #504d48; font-family: Arial;\">\n                                                <% if(products_basket[i].priceOrig){ %>\n                                                <strike><%= printPrice(products_basket[i].priceOrig) %>,-&nbsp;Kč</strike>  &nbsp;\n                                                <% } %>\n                                                <span style=\"color: #00483a; font-size: 18px;\"><%= printPrice(products_basket[i].price) %>&nbsp;Kč</span>\n                                                <br /><span style=\"font-size: 10px; line-height: 10px;\">&nbsp;<br /></span>\n                                            </td>\n                                        </tr>\n                                    </table>\n                                    <!-- BEGIN OPUSTENY KOSIK, BEZ IMG -->\n                                    <% } %>\n                                </td>\n                                <td width=\"360\" valign=\"top\" style=\"font-size: 14px; color: #43413c; font-family: Arial;\">\n                                    <table width=\"360\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\">\n                                        <tr>\n                                            <td colspan=\"3\" width=\"195\" height=\"37\" valign=\"middle\" style=\"font-family: Arial; color: #fffffe; background-color: #ff9525;\">\n                                                &nbsp;&nbsp;&nbsp;Poradím Vám\n                                            </td>\n                                            <td width=\"20\" rowspan=\"3\"></td>\n                                            <td width=\"145\" valign=\"top\" rowspan=\"3\">\n                                                <img src=\"http://s3-eu-west-1.amazonaws.com/cz.persoo.images/vqb36nehmep6dh1kbjpfpb4f/terka.jpg\" border=\"0\" />\n                                            </td>\n                                        </tr>\n                                        <tr>\n                                            <td align=\"left\" valign=\"middle\" height=\"40\" colspan=\"3\" style=\"font-size: 24px; font-family: Arial; color: #00483a;\">\n                                                Terka Valentová\n                                                <table width=\"195\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\">\n                                                    <tr>\n                                                        <td width=\"20\" height=\"35\"></td>\n                                                        <td width=\"30\" align=\"left\" valign=\"middle\" style=\"font-size: 0px;\"s>\n                                                            <img src=\"http://s3-eu-west-1.amazonaws.com/cz.persoo.images/vqb36nehmep6dh1kbjpfpb4f/call.jpg\" border=\"0\" />\n                                                        </td>\n                                                        <td align=\"left\" valign=\"middle\" style=\"font-size: 14px; font-family: Arial; color: #00483a;\">\n                                                            777 062 416\n                                                        </td>\n                                                    </tr>\n                                                    <tr>\n                                                        <td width=\"20\" height=\"35\"></td>\n                                                        <td width=\"30\" align=\"left\" valign=\"middle\" style=\"font-size: 0px;\">\n                                                            <img src=\"http://s3-eu-west-1.amazonaws.com/cz.persoo.images/vqb36nehmep6dh1kbjpfpb4f/time.jpg\" border=\"0\" />\n                                                        </td>\n                                                        <td align=\"left\" valign=\"middle\" style=\"font-size: 14px; font-family: Arial; color: #00483a;\">\n                                                            9:00 - 16:00\n                                                        </td>\n                                                    </tr>\n                                                    <tr>\n                                                        <td width=\"20\" height=\"35\"></td>\n                                                        <td width=\"30\" align=\"left\" valign=\"middle\" style=\"font-size: 0px;\">\n                                                            <img src=\"http://s3-eu-west-1.amazonaws.com/cz.persoo.images/vqb36nehmep6dh1kbjpfpb4f/mail.jpg\" border=\"0\" />\n                                                        </td>\n                                                        <td align=\"left\" valign=\"middle\" style=\"font-size: 14px; font-family: Arial; color: #00483a;\">\n                                                            <a href=\"mailto:terka@hanibal.cz\" style=\"color: #00483a; text-decoration: none;\">\n                                                                <span style=\"color: #00483a; text-decoration: none;\">\n                                                                    terka@hanibal.cz\n                                                                </span>\n                                                            </a>\n                                                        </td>\n                                                    </tr>\n                                                </table>\n                                            </td>\n                                        </tr>\n                                    </table>\n                                </td>\n                                <td width=\"15\"></td>\n                            </tr>\n                        </table>\n                        &nbsp;<br />\n                        <table width=\"600\" height=\"2\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" bgcolor=\"white\">\n                            <tr>\n                                <td height=\"2\" style=\"border-top: 1px solid #cdcdcd; border-bottom: 1px solid #cdcdcd;\"></td>\n                            </tr>\n                        </table>\n                        <table width=\"600\" height=\"2\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" bgcolor=\"white\">\n                            <tr>\n                                <td width=\"15\" rowspan=\"2\"></td>\n                                <td align=\"center\" valign=\"middle\" height=\"80\" colspan=\"5\" style=\"font-size: 24px; font-family: Arial; color: #00483a;\">\n                                    A přidávám ještě něco, co by se Vám mohlo hodit.\n                                </td>\n                                <td width=\"15\" rowspan=\"2\"></td>\n                            </tr>\n                            <tr>\n                                <% for(var i=0;i<3 && i < products_basket_recommended.length;i++) { %>\n                                <td width=\"180\" valign=\"bottom\">\n                                    <!-- PERSOO PRODUKT <%= i %> -->\n                                    <table width=\"180\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\">\n                                        <tr>\n                                            <td width=\"5\" style=\"background-color: #ff9525;\"></td>\n                                            <td height=\"40\" align=\"left\" valign=\"middle\" style=\"background-color: #ff9525; font-family: Arial; font-size: 14px; color: #fffffe; height:40px; line-height: 20px;\">\n                                                <div style=\"height:40px; overflow: hidden;\">\n                                                    <a href=\"<%= appendUrlParams(products_basket_recommended[i].link, urlParams) %>\" target=\"_blank\" name=\"persoo<%= i %>_title\" style=\"color: #fffffe; text-decoration: none;\">\n                                                        <span style=\"color: #fffffe;\">\n                                                            <%= products_basket_recommended[i].name %>\n                                                        </span>\n                                                    </a>\n                                                </div>\n                                            </td>\n                                            <td width=\"5\" style=\"background-color: #ff9525;\"></td>\n                                        </tr>\n                                        <tr>\n                                            <td colspan=\"3\" align=\"center\" valign=\"middle\" height=\"185\">\n                                                <a href=\"<%= appendUrlParams(products_basket_recommended[i].link, urlParams) %>\" target=\"_blank\" name=\"persoo<%= i %>_image\">\n                                                    <img src=\"<%= products_basket_recommended[i].imageLink %>\" border=\"0\" style=\"max-height: 170px; max-width: 175px;\" /> <!-- max. velikost obrazku 180px * 185px -->\n                                                </a>\n                                            </td>\n                                        </tr>\n                                        <tr>\n                                            <td colspan=\"3\">\n                                                <table width=\"180\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\">\n                                                    <tr>\n                                                        <td width=\"5\" style=\"background-color: #00483a;\"></td>\n                                                        <td align=\"center\" valign=\"middle\" width=\"67\" style=\"background-color: #00483a; font-family: Arial; font-size: 12px;\">\n                                                            <a href=\"<%= appendUrlParams(products_basket_recommended[i].link, urlParams) %>\" target=\"_blank\" name=\"persoo<%= i %>_zobrazit\" style=\"color: #fffffe; text-decoration: none;\">\n                                                                <span style=\"color: #fffffe;\">\n                                                                    ZOBRAZIT\n                                                                    PRODUKT\n                                                                </span>\n                                                            </a>\n                                                        </td>\n                                                        <td width=\"5\" style=\"background-color: #00483a;\"></td>\n                                                        <td width=\"25\" style=\"background-color: #2b6458;\">\n                                                            <a href=\"<%= products_basket_recommended[i].link + '?' + urlParams %>\" target=\"_blank\" name=\"persoo<%= i %>_arrow\">\n                                                                <img src=\"http://s3-eu-west-1.amazonaws.com/cz.persoo.images/vqb36nehmep6dh1kbjpfpb4f/b_3.jpg\" border=\"0\" />\n                                                            </a>\n                                                        </td>\n                                                        <td width=\"5\" style=\"background-color: #00483a;\"></td>\n                                                        <td width=\"68\" style=\"background-color: #00483a; font-family: Arial; font-size: 12px; font-weight: bold;\">\n                                                            <a href=\"<%= appendUrlParams(products_basket_recommended[i].link, urlParams) %>\" target=\"_blank\" name=\"persoo<%= i %>_price\" style=\"color: #fffffe; text-decoration: none;\">\n                                                                <span style=\"color: #fffffe;\">\n                                                                    <%= printPrice(products_basket_recommended[i].price) %>&nbsp;Kč\n                                                                </span>\n                                                            </a>\n                                                        </td>\n                                                        <td width=\"5\" style=\"background-color: #00483a;\"></td>\n                                                    </tr>\n                                                </table>\n                                            </td>\n                                        </tr>\n                                    </table>\n                                    <!-- END PERSOO PRODUKT <%= i %> -->\n                                </td>\n                                <% if (i<2) { %><td width=\"15\"></td><% } %>\n                                <% } %>\n                            </tr>\n                        </table>\n                        &nbsp;<br />\n                        <table width=\"600\" height=\"2\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" bgcolor=\"white\">\n                            <tr>\n                                <td colspan=\"3\" style=\"font-size: 0px;\">\n                                    <img src=\"http://s3-eu-west-1.amazonaws.com/cz.persoo.images/vqb36nehmep6dh1kbjpfpb4f/mount.jpg\" border=\"0\" />\n                                </td>\n                            </tr>\n                            <tr>\n                                <td width=\"15\" style=\"background-color: #dcd7cc;\"></td>\n                                <td style=\"background-color: #dcd7cc; font-family: Arial; font-size: 12px; color: #2d2d2d;\">\n                                    &nbsp;<br />\n                                     \n                                    <br />\n                                    &nbsp;<br />\n                                    © 2015 Hanibal.cz  All rights reserved.<br />\n                                    &nbsp;<br />\n                                    Tento email Vám byl zaslán na <%= email_email %> jako obchodní sdělení na základě Vašeho souhlasu. Děkujeme.<br />\n                                    &nbsp;<br />\n                                </td>\n                                <td width=\"15\" style=\"background-color: #dcd7cc;\"></td>\n                            </tr>\n                        </table>\n                    </td>\n                    <td style=\"background-color: #ece8dc; background-image: url('http://s3-eu-west-1.amazonaws.com/cz.persoo.images/vqb36nehmep6dh1kbjpfpb4f/bg.jpg');\"></td>\n                </tr>\n            </table>\n        </center>\n    </body>\n</html>",
                        "subject": "Nechybí Vám něco v batohu<%= db.mailchimp && db.mailchimp['5PAD'] ? ',' + db.mailchimp['5PAD'] : '' %>?",
                        "textBody": "<%\n// mapping products to be displayed here\nvar products_basket = products1 || [];\nvar products_basket_recommended = products2 || [];\n\nvar email_osloveni = db.mailchimp.OSLOVENI;\nvar email_5pad = db.mailchimp['5PAD'];\nvar email_email = db.bestIdentifications.email;\nvar basketTotal = 10;\n%>\n\n<%= email_osloveni ? email_osloveni : 'Ahoj' %>, <%= email_5pad ? email_5pad + ',' : '' %>\n\nVšimla jsem si, že v košíku máte něco, co by se Vám mohlo hodit.\n\nCo se stalo? Potřebujete s něčím poradit? Nebo se něco pokazilo v nákupním procesu? Zavolejte mi nebo napište email, ráda Vám pomůžu s čímkoliv bude potřeba!\n                      \nParádní outdoorový den\n\n       Terka"
                    },
                    "minTimeBeforeNextTrigger": 864000000,
                    "scenarios": {
                        "products1": "bcf7640656ab404aacaef9bcd5c9bc55",
                        "products2": "basketCrosssell"
                    },
                    "triggerFunction": "function trigger(io){\n    var send = false;\n    var lastBasketChange = io.db.lastAccesses.basketChange;\n    var lastPageview = io.db.lastAccesses.pageview;\n    \n    if(\n    \n    /* basket is non-empty */\n    io.db.products.inBasket &&\n    io.db.products.inBasket.length > 0 &&\n        \n    /* at least 2 hours after last visit */\n    atLeastNDaysAfter(lastPageview, 1/12) &&\n        \n    /* at most 3 days after basket status has Changed */\n    atMostNDaysAfter(lastBasketChange, 3) &&\n    \n    /* not already sent after last visit */\n    campaignNotAlreadySentAfter(lastPageview)\n        \n    ) {\n        return true;\n    } else {\n        return false;\n    }\n}"
                }
            ]
        }

## Campaign [/accounts/{accountID}/campaigns/{campaignID}]

+ Parameters

    + accountID (required, string, `4959bc0ab5f24ac2a9688908adaf9e24`)
    + campaignID (required, string, `de5c074d3f274aab943054dbbfac3803`)

### getCampaign [GET]
Retrieve a campaign.

+ Response 200 (application/json)

        {
            "id": "de5c074d3f274aab943054dbbfac3803",
            "name": "Basket reminder example",
            "class": "email",
            "isActive": false,
            "variants": [
                {
                    "id": "default",
                    "name": "default",
                    "condition": "true",
                    "content": {
                        "googleAnalyticsCampaign": "exampleCampaignName",
                        "htmlBody": "<p>Come back and buy X.</p>",
                        "subject": "Your product X is on SALE",
                        "textBody": "Come back and buy X."
                    },
                    "minTimeBeforeNextTrigger": 1,
                    "scenarios": {
                        "products1": "psGeneral"
                    },
                    "triggerFunction": ""
                }
            ]
        }

### updateCampaign [PUT]
Update a campaign.

+ Request (application/json)

        {
            "name": "Basket reminder",
            "class": "email",
            "isActive": true,
            "variants": [
                {
                    "id": "default",
                    "name": "default variant",
                    "condition": "db.products.inBasket && db.products.inBasket.length > 0",
                    "content": {
                        "googleAnalyticsCampaign": "basketReminderCampaign",
                        "htmlBody": "<p>Come back and buy ABC.</p>",
                        "subject": "Product ABC is on SALE",
                        "textBody": "Come back and buy ABC."
                    },
                    "minTimeBeforeNextTrigger": 10,
                    "scenarios": {
                        "products1": "psGeneral",
                        "products2": "basketCrosssell"
                    },
                    "triggerFunction": "function trigger(io){\n    var send = false;\n    var lastBasketChange = io.db.lastAccesses.basketChange;\n    var lastPageview = io.db.lastAccesses.pageview;\n    \n    if(\n    \n    /* basket is non-empty */\n    io.db.products.inBasket &&\n    io.db.products.inBasket.length > 0 &&\n        \n    /* at least 2 hours after last visit */\n    atLeastNDaysAfter(lastPageview, 1/12) &&\n        \n    /* at most 3 days after basket status has Changed */\n    atMostNDaysAfter(lastBasketChange, 3) &&\n    \n    /* not already sent after last visit */\n    campaignNotAlreadySentAfter(lastPageview)\n        \n    ) {\n        return true;\n    } else {\n        return false;\n    }\n}"
                }
            ]
        }

+ Response 200 (application/json)

        {
            "id": "de5c074d3f274aab943054dbbfac3803",
            "name": "Basket reminder",
            "class": "email",
            "isActive": true,
            "variants": [
                {
                    "id": "default",
                    "name": "default variant",
                    "condition": "db.products.inBasket && db.products.inBasket.length > 0",
                    "content": {
                        "googleAnalyticsCampaign": "basketReminderCampaign",
                        "htmlBody": "<p>Come back and buy ABC.</p>",
                        "subject": "Product ABC is on SALE",
                        "textBody": "Come back and buy ABC."
                    },
                    "minTimeBeforeNextTrigger": 10,
                    "scenarios": {
                        "products1": "psGeneral",
                        "products2": "basketCrosssell"
                    },
                    "triggerFunction": "function trigger(io){\n    var send = false;\n    var lastBasketChange = io.db.lastAccesses.basketChange;\n    var lastPageview = io.db.lastAccesses.pageview;\n    \n    if(\n    \n    /* basket is non-empty */\n    io.db.products.inBasket &&\n    io.db.products.inBasket.length > 0 &&\n        \n    /* at least 2 hours after last visit */\n    atLeastNDaysAfter(lastPageview, 1/12) &&\n        \n    /* at most 3 days after basket status has Changed */\n    atMostNDaysAfter(lastBasketChange, 3) &&\n    \n    /* not already sent after last visit */\n    campaignNotAlreadySentAfter(lastPageview)\n        \n    ) {\n        return true;\n    } else {\n        return false;\n    }\n}"
                }
            ]
        }

+ Response 404

        {
            "errors": [
                "message": "Campaign not found."
            ]
        }

### deleteCampaign [DELETE]
Delete a campaign.

+ Response 204

+ Response 404

        {
            "errors": [
                "message": "Campaign not found."
            ]
        }        
        
# Group Emails

## Emails [/accounts/{accountID}/offers/emails]

+ Parameters

    + accountID (required, string, `4959bc0ab5f24ac2a9688908adaf9e24`)
    
### listEmails [GET]

Lists emails.

+ Response 200 (application/json)

        [
            {
                "abTest": null,
                "class": "email",
                "id": "ea09e300ad524439b068b1acb6a78192",
                "isActive": false,
                "name": "Basket reminder example",
                "variants": [
                    {
                        "condition": {
                            "children": [
                                {
                                    "fields": [
                                        "true"
                                    ],
                                    "operator": "atom",
                                    "type": "customJavascript"
                                }
                            ],
                            "operator": "and"
                        },
                        "content": {
                            "googleAnalyticsCampaign": "exampleCampaignName",
                            "htmlBody": "<p>Come back and buy XX.</p>",
                            "subject": "Your product X is on SALEE",
                            "textBody": "Come back and buy XX"
                        },
                        "id": "0",
                        "scenarios": [
                            {
                                "id": "products1",
                                "scenarioID": "psGeneral"
                            }
                        ]
                    }
                ]
            },
            {
                "...": "..."
            }
        ]

### newEmail [POST]
Create a new email.

+ Request (application/json)

        {
            "abTest": null,
            "class": "email",
            "isActive": false,
            "name": "Basket reminder example",
            "variants": [
                {
                    "condition": {
                        "children": [
                            {
                                "fields": [
                                    "true"
                                ],
                                "operator": "atom",
                                "type": "customJavascript"
                            }
                        ],
                        "operator": "and"
                    },
                    "content": {
                        "googleAnalyticsCampaign": "exampleCampaignName",
                        "htmlBody": "<p>Come back and buy XX.</p>",
                        "subject": "Your product X is on SALEE",
                        "textBody": "Come back and buy XX"
                    },
                    "id": "0",
                    "scenarios": [
                        {
                            "id": "products1",
                            "scenarioID": "psGeneral"
                        }
                    ]
                }
            ]
        }
        
+ Response 200 (application/json)

        {
            "abTest": null,
            "class": "email",
            "id": "ea09e300ad524439b068b1acb6a78192",
            "isActive": false,
            "name": "Basket reminder example",
            "variants": [
                {
                    "condition": {
                        "children": [
                            {
                                "fields": [
                                    "true"
                                ],
                                "operator": "atom",
                                "type": "customJavascript"
                            }
                        ],
                        "operator": "and"
                    },
                    "content": {
                        "googleAnalyticsCampaign": "exampleCampaignName",
                        "htmlBody": "<p>Come back and buy XX.</p>",
                        "subject": "Your product X is on SALEE",
                        "textBody": "Come back and buy XX"
                    },
                    "id": "0",
                    "scenarios": [
                        {
                            "id": "products1",
                            "scenarioID": "psGeneral"
                        }
                    ]
                }
            ]
        }

## Email [/accounts/{accountID}/offers/emails/{emailID}]

+ Parameters

    + accountID (required, string, `4959bc0ab5f24ac2a9688908adaf9e24`)
    + emailID (required, string, `e739f150fa504c7a87634e124a6e6414`)

### updateEmail [PUT]
Updates email.

+ Request (application/json)

        {
            "abTest": null,
            "class": "email",
            "id": "ea09e300ad524439b068b1acb6a78192",
            "isActive": false,
            "name": "Basket reminder example",
            "variants": [
                {
                    "condition": {
                        "children": [
                            {
                                "fields": [
                                    "true"
                                ],
                                "operator": "atom",
                                "type": "customJavascript"
                            }
                        ],
                        "operator": "and"
                    },
                    "content": {
                        "googleAnalyticsCampaign": "exampleCampaignName",
                        "htmlBody": "<p>Come back and buy XX.</p>",
                        "subject": "Your product X is on SALEE",
                        "textBody": "Come back and buy XX"
                    },
                    "id": "0",
                    "scenarios": [
                        {
                            "id": "products1",
                            "scenarioID": "psGeneral"
                        }
                    ]
                }
            ]
        }

+ Response 200 (application/json)

        {
            "abTest": null,
            "class": "email",
            "id": "ea09e300ad524439b068b1acb6a78192",
            "isActive": false,
            "name": "Basket reminder example",
            "variants": [
                {
                    "condition": {
                        "children": [
                            {
                                "fields": [
                                    "true"
                                ],
                                "operator": "atom",
                                "type": "customJavascript"
                            }
                        ],
                        "operator": "and"
                    },
                    "content": {
                        "googleAnalyticsCampaign": "exampleCampaignName",
                        "htmlBody": "<p>Come back and buy XX.</p>",
                        "subject": "Your product X is on SALEE",
                        "textBody": "Come back and buy XX"
                    },
                    "id": "0",
                    "scenarios": [
                        {
                            "id": "products1",
                            "scenarioID": "psGeneral"
                        }
                    ]
                }
            ]
        }

### deleteEmail [DELETE]
Deletes an email.

+ Response 204

+ Response 404

        {
            "errors": [
                "message": "Email not found."
            ]
        }

# Group Export records

## Export records [/accounts/{accountID}/offers/exportRecords]

+ Parameters

    + accountID (required, string, `4959bc0ab5f24ac2a9688908adaf9e24`)
    
### listExportRecords [GET]

Lists export records.

+ Response 200 (application/json)

        [
            {
                "abTest": null,
                "class": "customMessage",
                "id": "c8ff8b42d43d4ca9b610fda97880e302",
                "isActive": true,
                "name": "my custom message",
                "variants": [
                    {
                        "condition": {
                            "children": [
                                {
                                    "fields": [
                                        "true"
                                    ],
                                    "operator": "atom",
                                    "type": "customJavascript"
                                }
                            ],
                            "operator": "and"
                        },
                        "content": {
                            "myField1": "some data",
                            "myField2": "<%= db.products.inBasket %>"
                        },
                        "id": "0",
                        "scenarios": [
                            {
                                "id": "products1",
                                "scenarioID": "psGeneral"
                            }
                        ]
                    }
                ]
            },
            {
                "...": "..."
            }
        ]

### newExportRecords [POST]
Create a new export records.

+ Request (application/json)

        {
            "abTest": null,
            "class": "customMessage",
            "isActive": true,
            "name": "my custom message",
            "variants": [
                {
                    "condition": {
                        "children": [
                            {
                                "fields": [
                                    "true"
                                ],
                                "operator": "atom",
                                "type": "customJavascript"
                            }
                        ],
                        "operator": "and"
                    },
                    "content": {
                        "myField1": "some data",
                        "myField2": "<%= db.products.inBasket %>"
                    },
                    "id": "0",
                    "scenarios": [
                        {
                            "id": "products1",
                            "scenarioID": "psGeneral"
                        }
                    ]
                }
            ]
        }
        
+ Response 200 (application/json)

        {
            "abTest": null,
            "class": "customMessage",
            "id": "c8ff8b42d43d4ca9b610fda97880e302",
            "isActive": true,
            "name": "my custom message",
            "variants": [
                {
                    "condition": {
                        "children": [
                            {
                                "fields": [
                                    "true"
                                ],
                                "operator": "atom",
                                "type": "customJavascript"
                            }
                        ],
                        "operator": "and"
                    },
                    "content": {
                        "myField1": "some data",
                        "myField2": "<%= db.products.inBasket %>"
                    },
                    "id": "0",
                    "scenarios": [
                        {
                            "id": "products1",
                            "scenarioID": "psGeneral"
                        }
                    ]
                }
            ]
        }

## Export record [/accounts/{accountID}/offers/exportRecords/{exportRecordID}]

+ Parameters

    + accountID (required, string, `4959bc0ab5f24ac2a9688908adaf9e24`)
    + exportRecordID (required, string, `e739f150fa504c7a87634e124a6e6414`)

### updateExportRecord [PUT]
Updates an export record.

+ Request (application/json)

        {
            "abTest": null,
            "class": "customMessage",
            "id": "c8ff8b42d43d4ca9b610fda97880e302",
            "isActive": true,
            "name": "my custom message",
            "variants": [
                {
                    "condition": {
                        "children": [
                            {
                                "fields": [
                                    "true"
                                ],
                                "operator": "atom",
                                "type": "customJavascript"
                            }
                        ],
                        "operator": "and"
                    },
                    "content": {
                        "myField1": "some data",
                        "myField2": "<%= db.products.inBasket %>"
                    },
                    "id": "0",
                    "scenarios": [
                        {
                            "id": "products1",
                            "scenarioID": "psGeneral"
                        }
                    ]
                }
            ]
        }

+ Response 200 (application/json)

        {
            "abTest": null,
            "class": "customMessage",
            "id": "c8ff8b42d43d4ca9b610fda97880e302",
            "isActive": true,
            "name": "my custom message",
            "variants": [
                {
                    "condition": {
                        "children": [
                            {
                                "fields": [
                                    "true"
                                ],
                                "operator": "atom",
                                "type": "customJavascript"
                            }
                        ],
                        "operator": "and"
                    },
                    "content": {
                        "myField1": "some data",
                        "myField2": "<%= db.products.inBasket %>"
                    },
                    "id": "0",
                    "scenarios": [
                        {
                            "id": "products1",
                            "scenarioID": "psGeneral"
                        }
                    ]
                }
            ]
        }

### deleteExportRecord [DELETE]
Deletes an export record.

+ Response 204

+ Response 404

        {
            "errors": [
                "message": "Export record not found."
            ]
        }

# Group Rest requests

## Rest requests [/accounts/{accountID}/offers/restRequests]

+ Parameters

    + accountID (required, string, `4959bc0ab5f24ac2a9688908adaf9e24`)
    
### listRestRequests [GET]

Lists rest requests.

+ Response 200 (application/json)

        [
            {
                "abTest": null,
                "class": "RESTRequest",
                "id": "e0bb9067cd1d42f0984e824ae9526b34",
                "isActive": false,
                "name": "my REST request",
                "variants": [
                    {
                        "condition": {
                            "children": [
                                {
                                    "fields": [
                                        "true"
                                    ],
                                    "operator": "atom",
                                    "type": "customJavascript"
                                }
                            ],
                            "operator": "and"
                        },
                        "content": {
                            "connectTimeout": 5000,
                            "data": "payload data",
                            "headers": [
                                {
                                    "name": "User-Agent",
                                    "value": "Mozilla/5.0"
                                },
                                {
                                    "name": "Referrer",
                                    "value": "http://example.com"
                                },
                                {
                                    "name": "Referrer",
                                    "value": "http://example2.com"
                                }
                            ],
                            "method": "POST",
                            "readTimeout": 5000,
                            "url": "http://example.com/api?param=<%= 123 %>"
                        },
                        "id": "0",
                        "scenarios": [
                            {
                                "id": "products1",
                                "scenarioID": "psGeneral"
                            }
                        ]
                    }
                ]
            },
            {
                "...": "..."
            }
        ]

### newRestRequest [POST]
Creates a new rest request.

+ Request (application/json)

        {
            "abTest": null,
            "class": "RESTRequest",
            "isActive": false,
            "name": "my REST request",
            "variants": [
                {
                    "condition": {
                        "children": [
                            {
                                "fields": [
                                    "true"
                                ],
                                "operator": "atom",
                                "type": "customJavascript"
                            }
                        ],
                        "operator": "and"
                    },
                    "content": {
                        "connectTimeout": 5000,
                        "data": "payload data",
                        "headers": [
                            {
                                "name": "User-Agent",
                                "value": "Mozilla/5.0"
                            },
                            {
                                "name": "Referrer",
                                "value": "http://example.com"
                            },
                            {
                                "name": "Referrer",
                                "value": "http://example2.com"
                            }
                        ],
                        "method": "POST",
                        "readTimeout": 5000,
                        "url": "http://example.com/api?param=<%= 123 %>"
                    },
                    "id": "0",
                    "scenarios": [
                        {
                            "id": "products1",
                            "scenarioID": "psGeneral"
                        }
                    ]
                }
            ]
        }
        
+ Response 200 (application/json)

        {
            "abTest": null,
            "class": "RESTRequest",
            "id": "e0bb9067cd1d42f0984e824ae9526b34",
            "isActive": false,
            "name": "my REST request",
            "variants": [
                {
                    "condition": {
                        "children": [
                            {
                                "fields": [
                                    "true"
                                ],
                                "operator": "atom",
                                "type": "customJavascript"
                            }
                        ],
                        "operator": "and"
                    },
                    "content": {
                        "connectTimeout": 5000,
                        "data": "payload data",
                        "headers": [
                            {
                                "name": "User-Agent",
                                "value": "Mozilla/5.0"
                            },
                            {
                                "name": "Referrer",
                                "value": "http://example.com"
                            },
                            {
                                "name": "Referrer",
                                "value": "http://example2.com"
                            }
                        ],
                        "method": "POST",
                        "readTimeout": 5000,
                        "url": "http://example.com/api?param=<%= 123 %>"
                    },
                    "id": "0",
                    "scenarios": [
                        {
                            "id": "products1",
                            "scenarioID": "psGeneral"
                        }
                    ]
                }
            ]
        }

## Rest request [/accounts/{accountID}/offers/restRequests/{restRequestID}]

+ Parameters

    + accountID (required, string, `4959bc0ab5f24ac2a9688908adaf9e24`)
    + restRequestID (required, string, `e739f150fa504c7a87634e124a6e6414`)

### updateRestRequest [PUT]
Updates a rest request.

+ Request (application/json)

        {
            "abTest": null,
            "class": "RESTRequest",
            "id": "e0bb9067cd1d42f0984e824ae9526b34",
            "isActive": false,
            "name": "my REST request",
            "variants": [
                {
                    "condition": {
                        "children": [
                            {
                                "fields": [
                                    "true"
                                ],
                                "operator": "atom",
                                "type": "customJavascript"
                            }
                        ],
                        "operator": "and"
                    },
                    "content": {
                        "connectTimeout": 5000,
                        "data": "payload data",
                        "headers": [
                            {
                                "name": "User-Agent",
                                "value": "Mozilla/5.0"
                            },
                            {
                                "name": "Referrer",
                                "value": "http://example.com"
                            },
                            {
                                "name": "Referrer",
                                "value": "http://example2.com"
                            }
                        ],
                        "method": "POST",
                        "readTimeout": 5000,
                        "url": "http://example.com/api?param=<%= 123 %>"
                    },
                    "id": "0",
                    "scenarios": [
                        {
                            "id": "products1",
                            "scenarioID": "psGeneral"
                        }
                    ]
                }
            ]
        }

+ Response 200 (application/json)

        {
            "abTest": null,
            "class": "RESTRequest",
            "id": "e0bb9067cd1d42f0984e824ae9526b34",
            "isActive": false,
            "name": "my REST request",
            "variants": [
                {
                    "condition": {
                        "children": [
                            {
                                "fields": [
                                    "true"
                                ],
                                "operator": "atom",
                                "type": "customJavascript"
                            }
                        ],
                        "operator": "and"
                    },
                    "content": {
                        "connectTimeout": 5000,
                        "data": "payload data",
                        "headers": [
                            {
                                "name": "User-Agent",
                                "value": "Mozilla/5.0"
                            },
                            {
                                "name": "Referrer",
                                "value": "http://example.com"
                            },
                            {
                                "name": "Referrer",
                                "value": "http://example2.com"
                            }
                        ],
                        "method": "POST",
                        "readTimeout": 5000,
                        "url": "http://example.com/api?param=<%= 123 %>"
                    },
                    "id": "0",
                    "scenarios": [
                        {
                            "id": "products1",
                            "scenarioID": "psGeneral"
                        }
                    ]
                }
            ]
        }

### deleteRestRequest [DELETE]
Deletes a rest request.

+ Response 204

+ Response 404

        {
            "errors": [
                "message": "Rest request not found."
            ]
        }

# Group Web widgets

## Web widgets [/accounts/{accountID}/offers/webWidgets]

+ Parameters

    + accountID (required, string, `4959bc0ab5f24ac2a9688908adaf9e24`)
    
### listWebWidgets [GET]

Lists web widgets.

+ Response 200 (application/json)

        [
            {
                "abTest": "persooOnOff",
                "class": "webWidget",
                "id": "d5a8a2f4d711446fb1c1c32bd1518cce",
                "isActive": false,
                "location": "fa985d13af694454817b291f9fef8675",
                "name": "Html offer example",
                "tags": {
                },
                "variants": [
                    {
                        "condition": {
                            "fields": [
                                "persooOnOff",
                                "Persoo ON"
                            ],
                            "operator": "atom",
                            "type": "abTests"
                        },
                        "content": {
                            "template": "<html templaate>"
                        },
                        "id": "on",
                        "scenarios": [
                            {
                                "id": "products1",
                                "scenarioID": "psGeneral"
                            }
                        ],
                        "templateID": null
                    },
                    {
                        "condition": {
                            "fields": [
                                "persooOnOff",
                                "Persoo ON"
                            ],
                            "operator": "atom",
                            "type": "abTests"
                        },
                        "content": {
                            "template": "<html template>"
                        },
                        "id": "off",
                        "scenarios": [
                            {
                                "id": "products1",
                                "scenarioID": "psGeneral"
                            }
                        ],
                        "templateID": null
                    }
                ]
            },
            {
                "...": "..."
            }
        ]

### newWebWidget [POST]
Creates a new web widget.

+ Request (application/json)

        {
            "abTest": "persooOnOff",
            "class": "webWidget",
            "isActive": false,
            "location": "fa985d13af694454817b291f9fef8675",
            "name": "Html offer example",
            "tags": {
            },
            "variants": [
                {
                    "condition": {
                        "fields": [
                            "persooOnOff",
                            "Persoo ON"
                        ],
                        "operator": "atom",
                        "type": "abTests"
                    },
                    "content": {
                        "template": "<html templaate>"
                    },
                    "id": "on",
                    "scenarios": [
                        {
                            "id": "products1",
                            "scenarioID": "psGeneral"
                        }
                    ],
                    "templateID": null
                },
                {
                    "condition": {
                        "fields": [
                            "persooOnOff",
                            "Persoo ON"
                        ],
                        "operator": "atom",
                        "type": "abTests"
                    },
                    "content": {
                        "template": "<html template>"
                    },
                    "id": "off",
                    "scenarios": [
                        {
                            "id": "products1",
                            "scenarioID": "psGeneral"
                        }
                    ],
                    "templateID": null
                }
            ]
        }
        
+ Response 200 (application/json)

        {
            "abTest": "persooOnOff",
            "class": "webWidget",
            "id": "d5a8a2f4d711446fb1c1c32bd1518cce",
            "isActive": false,
            "location": "fa985d13af694454817b291f9fef8675",
            "name": "Html offer example",
            "tags": {
            },
            "variants": [
                {
                    "condition": {
                        "fields": [
                            "persooOnOff",
                            "Persoo ON"
                        ],
                        "operator": "atom",
                        "type": "abTests"
                    },
                    "content": {
                        "template": "<html templaate>"
                    },
                    "id": "on",
                    "scenarios": [
                        {
                            "id": "products1",
                            "scenarioID": "psGeneral"
                        }
                    ],
                    "templateID": null
                },
                {
                    "condition": {
                        "fields": [
                            "persooOnOff",
                            "Persoo ON"
                        ],
                        "operator": "atom",
                        "type": "abTests"
                    },
                    "content": {
                        "template": "<html template>"
                    },
                    "id": "off",
                    "scenarios": [
                        {
                            "id": "products1",
                            "scenarioID": "psGeneral"
                        }
                    ],
                    "templateID": null
                }
            ]
        }

## Web widget [/accounts/{accountID}/offers/restRequests/{webWidgetID}]

+ Parameters

    + accountID (required, string, `4959bc0ab5f24ac2a9688908adaf9e24`)
    + webWidgetID (required, string, `e739f150fa504c7a87634e124a6e6414`)

### updateWebWidget [PUT]
Updates a web widget.

+ Request (application/json)

        {
            "abTest": "persooOnOff",
            "class": "webWidget",
            "id": "d5a8a2f4d711446fb1c1c32bd1518cce",
            "isActive": false,
            "location": "fa985d13af694454817b291f9fef8675",
            "name": "Html offer example",
            "tags": {
            },
            "variants": [
                {
                    "condition": {
                        "fields": [
                            "persooOnOff",
                            "Persoo ON"
                        ],
                        "operator": "atom",
                        "type": "abTests"
                    },
                    "content": {
                        "template": "<html templaate>"
                    },
                    "id": "on",
                    "scenarios": [
                        {
                            "id": "products1",
                            "scenarioID": "psGeneral"
                        }
                    ],
                    "templateID": null
                },
                {
                    "condition": {
                        "fields": [
                            "persooOnOff",
                            "Persoo ON"
                        ],
                        "operator": "atom",
                        "type": "abTests"
                    },
                    "content": {
                        "template": "<html template>"
                    },
                    "id": "off",
                    "scenarios": [
                        {
                            "id": "products1",
                            "scenarioID": "psGeneral"
                        }
                    ],
                    "templateID": null
                }
            ]
        }

+ Response 200 (application/json)

        {
            "abTest": "persooOnOff",
            "class": "webWidget",
            "id": "d5a8a2f4d711446fb1c1c32bd1518cce",
            "isActive": false,
            "location": "fa985d13af694454817b291f9fef8675",
            "name": "Html offer example",
            "tags": {
            },
            "variants": [
                {
                    "condition": {
                        "fields": [
                            "persooOnOff",
                            "Persoo ON"
                        ],
                        "operator": "atom",
                        "type": "abTests"
                    },
                    "content": {
                        "template": "<html templaate>"
                    },
                    "id": "on",
                    "scenarios": [
                        {
                            "id": "products1",
                            "scenarioID": "psGeneral"
                        }
                    ],
                    "templateID": null
                },
                {
                    "condition": {
                        "fields": [
                            "persooOnOff",
                            "Persoo ON"
                        ],
                        "operator": "atom",
                        "type": "abTests"
                    },
                    "content": {
                        "template": "<html template>"
                    },
                    "id": "off",
                    "scenarios": [
                        {
                            "id": "products1",
                            "scenarioID": "psGeneral"
                        }
                    ],
                    "templateID": null
                }
            ]
        }

### deleteWebWidget [DELETE]
Deletes a web widget.

+ Response 204

+ Response 404

        {
            "errors": [
                "message": "Web widget not found."
            ]
        }

# Group Locations

## Locations [/accounts/{accountID}/locations]

+ Parameters

    + accountID (required, string, `4959bc0ab5f24ac2a9688908adaf9e24`)

### listLocations [GET]
List all locations.

+ Response 200 (application/json)

        [
            {
                "id": "e739f150fa504c7a87634e124a6e6414",
                "name": "basketReminder1st",
                "class": "email",
                "isActive": true,
                "variants": [
                    {
                        "id": "default",
                        "name": "default",
                        "condition": "db.products.inBasket && db.products.inBasket.length > 0",
                        "content": {
                            "googleAnalyticsLocation": "basketReminder1st",
                            "htmlBody": "<%\nfunction printPrice(p){\n\treturn String(Math.round(p)).replace(/(.*)([0-9]{3})/,'$1 $2');\n}\nfunction appendUrlParams(url, params){\n   var parts =  url.split('#');\n   parts[0] += ( parts[0].indexOf('?')<0  ? '?' : '&') + params;\n   return parts.join('#');\n}\n\nvar basketReminderStep = 'first';\n\n// mapping products to be displayed here\nvar products_basket = products1 || [];\nvar products_basket_recommended = products2 || [];\nvar percent = String.fromCharCode(37);\nvar urlParams = 'persooLocation=basketReminder1';\n\nvar email_osloveni = db.mailchimp.OSLOVENI;\nvar email_5pad = db.mailchimp['5PAD'];\nvar email_email = db.bestIdentifications.email;\nvar basketTotal = 10;\n\n%>\n<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\">\n<html lang=\"en\" xml:lang=\"en\" xmlns=\"http://www.w3.org/1999/xhtml\">\t   \n    <head>\t\t     \n        <title>    \n        </title>\t\t     \n        <meta content=\"text/html; charset=UTF-8\" http-equiv=\"content-type\" />\t\t     \n        <meta content=\"application/xhtml+xml; charset=UTF-8\" http-equiv=\"content-type\" />\t\t     \n        <meta content=\"width=device-width, initial scale=1\" name=\"viewport\" />\t   \n    </head>\t   \n    <body style=\"margin:0; padding: 0; background-color: #ece8dc; background-image: url('bg.jpg');\">\n        <center>\n            <span style=\"font-size: 1px; color: #ece8dc;\">\n                <% if (basketReminderStep == 'first') { %>\n                Co třeba <%= products_basket[0].name %>?\n                <% } %>\n                <% if (basketReminderStep == 'second') { %>\n                <%= products_basket[0].name %> už na Vás čeká. \n                <% } %>\n            </span>\n            <table style=\"width:100%;\" cellspacing=\"0\" cellpadding=\"0\">\n                <tr>\n                    <td style=\"background-color: #ece8dc; background-image: url('http://s3-eu-west-1.amazonaws.com/cz.persoo.images/vqb36nehmep6dh1kbjpfpb4f/bg.jpg');\"></td>\n                    <td width=\"600\" align=\"left\" bgcolor=\"white\" style=\"background-color: white;\">\n                        <table width=\"600\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" bgcolor=\"white\">\n                            <tr>\n                                <td>\n                                    <img src=\"http://s3-eu-west-1.amazonaws.com/cz.persoo.images/vqb36nehmep6dh1kbjpfpb4f/header.jpg\" alt=\"\" usemap=\"#map\" />\n                                    <map name=\"map\">\n                                        <area shape=\"rect\" coords=\"0, 63, 599, 159\" href=\"http://www.hanibal.cz/<%= '?' + urlParams %>\" target=\"_blank\" />\n                                        <area shape=\"rect\" coords=\"529, 10, 599, 61\" href=\"http://www.hanibal.cz/blog/<%= '?' + urlParams %>\" target=\"_blank\" />\n                                        <area shape=\"rect\" coords=\"412, 10, 527, 61\" href=\"http://www.hanibal.cz/pujcovna/<%= '?' + urlParams %>\" target=\"_blank\" />\n                                        <area shape=\"rect\" coords=\"297, 10, 411, 61\" href=\"http://www.hanibal.cz/academy/<%= '?' + urlParams %>\" target=\"_blank\" />\n                                        <area shape=\"rect\" coords=\"206, 10, 296, 61\" href=\"http://www.hanibal.cz/<%= '?' + urlParams %>\" target=\"_blank\" />\n                                        <area shape=\"rect\" coords=\"1, 10, 206, 61\" href=\"http://www.hanibal.cz/<%= '?' + urlParams %>\" target=\"_blank\" />\n                                    </map>\n                                </td>\n                            </tr>\n                        </table>\n                        &nbsp;<br />\n                        <table width=\"600\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" bgcolor=\"white\">\n                            <tr>\n                                <td width=\"15\" rowspan=\"2\"></td>\n                                <td width=\"180\" valign=\"top\">\n                                    <!-- BEGIN OPUSTENY KOSIK, VELKY IMG -->\n                                    <table width=\"180\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\">\n                                        <tr>\n                                            <td style=\"font-size: 16px; color: #ff9525; font-family: Arial;\">\n                                                <a href=\"<%= appendUrlParams(products_basket[0].URL, urlParams) %>\" target=\"_blank\" style=\"color: #ff9525; text-decoration: none;\">\n                                                    <span style=\"color: #ff9525;\">\n                                                        <%= products_basket[0].name %>\n                                                    </span>\n                                                </a><br /><span style=\"font-size: 10px; line-height: 10px;\">&nbsp;</span>\n                                            </td>\n                                        </tr>\n                                        <tr>\n                                            <td style=\"font-size: 16px; color: #504d48; font-family: Arial;\">\n                                                <% if(products_basket[0].priceOrig){ %>\n                                                <strike><%= printPrice(products_basket[0].priceOrig) %>,-&nbsp;Kč</strike>  &nbsp;\n                                                <% } %>\n                                                <span style=\"color: #00483a; font-size: 20px;\"><%= printPrice(products_basket[0].price) %>&nbsp;Kč</span>\n                                                <br /><span style=\"font-size: 10px; line-height: 10px;\">&nbsp;</span>\n                                            </td>\n                                        </tr>\n                                        <tr>\n                                            <td align=\"center\">\n                                                <a href=\"<%= appendUrlParams(products_basket[0].URL, urlParams) %>\" target=\"_blank\">\n                                                    <img src=\"<%= products_basket[0].imageLink %>\" border=\"0\" /><!-- max. sirka obrazku 180px -->\n                                                </a>\n                                                <br /><span style=\"font-size: 10px; line-height: 10px;\">&nbsp;</span>\n                                            </td>\n                                        </tr>\n                                    </table>\n                                    <!-- END OPUSTENY KOSIK, VELKY IMG -->\n                                </td>\n                                <td width=\"30\" rowspan=\"2\"></td>\n                                <td width=\"360\" valign=\"top\" style=\"font-size: 14px; color: #43413c; font-family: Arial;\">\n                                    <%= email_osloveni ? email_osloveni : 'Ahoj' %>, <%= email_5pad ? email_5pad + ',' : '' %><br />\n                                    &nbsp;<br />\n\n                                    <% if (basketReminderStep == 'first') { %>\n                                    Všimla jsem si, že v košíku máte něco, co by se Vám mohlo hodit.<br />\n                                    &nbsp;<br />\n                                    Co se stalo? Potřebujete s něčím poradit? Nebo se něco pokazilo v nákupním procesu? Zavolejte mi nebo \n\nnapište email, ráda Vám pomůžu s čímkoliv bude potřeba!<br />\n\t\t\t\t\t\t\t\t\t<% } %>\n                                    \n                                    <% if (basketReminderStep == 'second') { %>\n                                    v košíku na Vás stále něco čeká. Stačí už jen málo a můžete mít skvělé vybavení doma! \n                                    Zavolejte mi nebo napište email, ráda Vám pomůžu s čímkoliv bude potřeba!<br />&nbsp;\n                                    <br />\n\t\t\t\t\t\t\t\t\tA navíc, <b>když dokončíte nákup,</b> přibalíme Vám do objednávky něco na zub – sušené maso Indiana Jerky! Stačí, abyste v košíku zadali kód: <b>\"Jerky\"</b> <br />&nbsp;\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t<br />\n\t\t\t\t\t\t\t\t\t<% if (basketTotal >= 2000) { %>\n\t\t\t\t\t\t\t\t\t   Mimoto <b>máte dopravu zdarma.</b><br />\n\t\t\t\t\t\t\t\t\t<% } else if (basketTotal > 1500) { %>\n\t\t\t\t\t\t\t\t\t   Mimoto Vám <b>zbývá už jen <%= 2000 - basketTotal %> Kč, abychom Vám nezaúčtovali poštovné.</b>  Nechcete si ještě něco vybrat?<br />\n                                    <% } %>\n                                    \n                                    \n                                    <% } %>\n                                    &nbsp;<br />\n                                    Parádní outdoorový den<br />\n                                    &nbsp;<br />\n                                    Terka<br />\n                                    &nbsp;<br />\n                                    <table width=\"360\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\">\n                                        <tr>\n                                            <td width=\"41\"></td>\n                                            <td width=\"50\" style=\"background-color: #2b6458;\">\n                                                <a href=\"<%= appendUrlParams('http://www.hanibal.cz/kosik/',urlParams) %>\" target=\"_blank\">\n                                                    <img src=\"http://s3-eu-west-1.amazonaws.com/cz.persoo.images/vqb36nehmep6dh1kbjpfpb4f/b_1.jpg\" border=\"0\" />\n                                                </a>\n                                            </td>\n                                            <td width=\"10\" style=\"background-color: #125345;\"></td>\n                                            <td width=\"180\" align=\"left\" valign=\"middle\" style=\"background-color: #125345; color: white; font-family: Arial; font-size: 14px;\">\n                                                <a href=\"<%= appendUrlParams('http://www.hanibal.cz/kosik/',urlParams) %>\" target=\"_blank\" style=\"color: #fffffe; text-decoration: none;\">\n                                                    <span style=\"color: #fffffe; font-weight: bold;\">\n                                                        Dokončit nákup\n                                                    </span>\n                                                </a>\n                                            </td>\n                                            <td width=\"10\" style=\"background-color: #125345;\"></td>\n                                            <td width=\"28\" style=\"background-color: #2b6458;\">\n                                                <a href=\"<%= appendUrlParams('http://www.hanibal.cz/kosik/',urlParams) %>\" target=\"_blank\">\n                                                    <img src=\"http://s3-eu-west-1.amazonaws.com/cz.persoo.images/vqb36nehmep6dh1kbjpfpb4f/b_2.jpg\" border=\"0\" />\n                                                </a>\n                                            </td>\n                                            <td width=\"41\"></td>\n                                        </tr>\n\n                                    </table>\n                                    <br />&nbsp;<br />&nbsp;<br />\n                                </td>\n                            </tr>\n                            <tr>\n                                <td width=\"180\" valign=\"top\">\n                                    <% for(var i=1;i<3&&i<products_basket.length;i++) { %>\n                                    <!-- BEGIN OPUSTENY KOSIK, MALY IMG -->\n                                    <table width=\"180\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" style=\"border-top: 1px solid #ff9525;\">                                        \n                                        <tr>\n                                            <td style=\"font-size: 16px; color: #ff9525; font-family: Arial;\" colspan=\"3\">\n                                                <span style=\"font-size: 10px; line-height: 10px;\">&nbsp;<br /></span>\n                                                <a href=\"<%= appendUrlParams(products_basket[i].URL, urlParams) %>\" target=\"_blank\" style=\"color: #ff9525; text-decoration: none;\">\n                                                    <span style=\"color: #ff9525;\">\n                                                        <%= products_basket[i].name %>\n                                                    </span>\n                                                </a><br />\n                                                <span style=\"font-size: 10px; line-height: 10px;\">&nbsp;</span>\n                                            </td>\n                                        </tr>\n                                        <tr>\n                                            <td align=\"center\" width=\"80\" valign=\"middle\">\n                                                <a href=\"<%= appendUrlParams(products_basket[i].URL, urlParams) %>\" target=\"_blank\">\n                                                    <img src=\"<%= products_basket[i].imageLink %>\" border=\"0\" style=\"max-width:50px; max-height:50px;\"/> <!-- max. sirka obrazku 80px -->\n                                                </a>\n                                            </td>\n                                            <td width=\"10\"></td>\n                                            <td align=\"right\" valign=\"middle\" style=\"font-size: 14px; color: #504d48; font-family: Arial;\">\n                                                <% if(products_basket[i].priceOrig){ %>\n                                                <strike><%= printPrice(products_basket[i].priceOrig) %>,-&nbsp;Kč</strike><br />\n                                                <% } %>\n                                                <span style=\"color: #00483a; font-size: 18px;\"><%= printPrice(products_basket[i].price) %>&nbsp;Kč</span>\n                                            </td>\n                                        </tr>\n                                        <tr>\n                                            <td>\n                                                <span style=\"font-size: 10px; line-height: 10px;\">&nbsp;<br /></span>\n                                            </td>\n                                        </tr>\n                                    </table>\n                                    <!-- END OPUSTENY KOSIK, MALY IMG -->\n                                    <% } %>\n                                    <% for(var i=3;i<4 && i<products_basket.length;i++) { %>\n                                    <!-- BEGIN OPUSTENY KOSIK, BEZ IMG -->\n                                    <table width=\"180\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" style=\"border-top: 1px solid #ff9525;\">\n                                        <tr>\n                                            <td style=\"font-size: 16px; color: #ff9525; font-family: Arial;\">\n                                                <span style=\"font-size: 10px; line-height: 10px;\">&nbsp;<br /></span>\n                                                <a href=\"<%= appendUrlParams(products_basket[i].URL, urlParams) %>\" target=\"_blank\" style=\"color: #ff9525; text-decoration: none;\">\n                                                    <span style=\"color: #ff9525;\">\n                                                        <%= products_basket[i].name %>\n                                                    </span>\n                                                </a><br /><span style=\"font-size: 10px; line-height: 10px;\">&nbsp;<br /></span>\n                                            </td>\n                                        </tr>\n                                        <tr>\n                                            <td style=\"font-size: 14px; color: #504d48; font-family: Arial;\">\n                                                <% if(products_basket[i].priceOrig){ %>\n                                                <strike><%= printPrice(products_basket[i].priceOrig) %>,-&nbsp;Kč</strike>  &nbsp;\n                                                <% } %>\n                                                <span style=\"color: #00483a; font-size: 18px;\"><%= printPrice(products_basket[i].price) %>&nbsp;Kč</span>\n                                                <br /><span style=\"font-size: 10px; line-height: 10px;\">&nbsp;<br /></span>\n                                            </td>\n                                        </tr>\n                                    </table>\n                                    <!-- BEGIN OPUSTENY KOSIK, BEZ IMG -->\n                                    <% } %>\n                                </td>\n                                <td width=\"360\" valign=\"top\" style=\"font-size: 14px; color: #43413c; font-family: Arial;\">\n                                    <table width=\"360\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\">\n                                        <tr>\n                                            <td colspan=\"3\" width=\"195\" height=\"37\" valign=\"middle\" style=\"font-family: Arial; color: #fffffe; background-color: #ff9525;\">\n                                                &nbsp;&nbsp;&nbsp;Poradím Vám\n                                            </td>\n                                            <td width=\"20\" rowspan=\"3\"></td>\n                                            <td width=\"145\" valign=\"top\" rowspan=\"3\">\n                                                <img src=\"http://s3-eu-west-1.amazonaws.com/cz.persoo.images/vqb36nehmep6dh1kbjpfpb4f/terka.jpg\" border=\"0\" />\n                                            </td>\n                                        </tr>\n                                        <tr>\n                                            <td align=\"left\" valign=\"middle\" height=\"40\" colspan=\"3\" style=\"font-size: 24px; font-family: Arial; color: #00483a;\">\n                                                Terka Valentová\n                                                <table width=\"195\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\">\n                                                    <tr>\n                                                        <td width=\"20\" height=\"35\"></td>\n                                                        <td width=\"30\" align=\"left\" valign=\"middle\" style=\"font-size: 0px;\"s>\n                                                            <img src=\"http://s3-eu-west-1.amazonaws.com/cz.persoo.images/vqb36nehmep6dh1kbjpfpb4f/call.jpg\" border=\"0\" />\n                                                        </td>\n                                                        <td align=\"left\" valign=\"middle\" style=\"font-size: 14px; font-family: Arial; color: #00483a;\">\n                                                            777 062 416\n                                                        </td>\n                                                    </tr>\n                                                    <tr>\n                                                        <td width=\"20\" height=\"35\"></td>\n                                                        <td width=\"30\" align=\"left\" valign=\"middle\" style=\"font-size: 0px;\">\n                                                            <img src=\"http://s3-eu-west-1.amazonaws.com/cz.persoo.images/vqb36nehmep6dh1kbjpfpb4f/time.jpg\" border=\"0\" />\n                                                        </td>\n                                                        <td align=\"left\" valign=\"middle\" style=\"font-size: 14px; font-family: Arial; color: #00483a;\">\n                                                            9:00 - 16:00\n                                                        </td>\n                                                    </tr>\n                                                    <tr>\n                                                        <td width=\"20\" height=\"35\"></td>\n                                                        <td width=\"30\" align=\"left\" valign=\"middle\" style=\"font-size: 0px;\">\n                                                            <img src=\"http://s3-eu-west-1.amazonaws.com/cz.persoo.images/vqb36nehmep6dh1kbjpfpb4f/mail.jpg\" border=\"0\" />\n                                                        </td>\n                                                        <td align=\"left\" valign=\"middle\" style=\"font-size: 14px; font-family: Arial; color: #00483a;\">\n                                                            <a href=\"mailto:terka@hanibal.cz\" style=\"color: #00483a; text-decoration: none;\">\n                                                                <span style=\"color: #00483a; text-decoration: none;\">\n                                                                    terka@hanibal.cz\n                                                                </span>\n                                                            </a>\n                                                        </td>\n                                                    </tr>\n                                                </table>\n                                            </td>\n                                        </tr>\n                                    </table>\n                                </td>\n                                <td width=\"15\"></td>\n                            </tr>\n                        </table>\n                        &nbsp;<br />\n                        <table width=\"600\" height=\"2\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" bgcolor=\"white\">\n                            <tr>\n                                <td height=\"2\" style=\"border-top: 1px solid #cdcdcd; border-bottom: 1px solid #cdcdcd;\"></td>\n                            </tr>\n                        </table>\n                        <table width=\"600\" height=\"2\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" bgcolor=\"white\">\n                            <tr>\n                                <td width=\"15\" rowspan=\"2\"></td>\n                                <td align=\"center\" valign=\"middle\" height=\"80\" colspan=\"5\" style=\"font-size: 24px; font-family: Arial; color: #00483a;\">\n                                    A přidávám ještě něco, co by se Vám mohlo hodit.\n                                </td>\n                                <td width=\"15\" rowspan=\"2\"></td>\n                            </tr>\n                            <tr>\n                                <% for(var i=0;i<3 && i < products_basket_recommended.length;i++) { %>\n                                <td width=\"180\" valign=\"bottom\">\n                                    <!-- PERSOO PRODUKT <%= i %> -->\n                                    <table width=\"180\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\">\n                                        <tr>\n                                            <td width=\"5\" style=\"background-color: #ff9525;\"></td>\n                                            <td height=\"40\" align=\"left\" valign=\"middle\" style=\"background-color: #ff9525; font-family: Arial; font-size: 14px; color: #fffffe; height:40px; line-height: 20px;\">\n                                                <div style=\"height:40px; overflow: hidden;\">\n                                                    <a href=\"<%= appendUrlParams(products_basket_recommended[i].link, urlParams) %>\" target=\"_blank\" name=\"persoo<%= i %>_title\" style=\"color: #fffffe; text-decoration: none;\">\n                                                        <span style=\"color: #fffffe;\">\n                                                            <%= products_basket_recommended[i].name %>\n                                                        </span>\n                                                    </a>\n                                                </div>\n                                            </td>\n                                            <td width=\"5\" style=\"background-color: #ff9525;\"></td>\n                                        </tr>\n                                        <tr>\n                                            <td colspan=\"3\" align=\"center\" valign=\"middle\" height=\"185\">\n                                                <a href=\"<%= appendUrlParams(products_basket_recommended[i].link, urlParams) %>\" target=\"_blank\" name=\"persoo<%= i %>_image\">\n                                                    <img src=\"<%= products_basket_recommended[i].imageLink %>\" border=\"0\" style=\"max-height: 170px; max-width: 175px;\" /> <!-- max. velikost obrazku 180px * 185px -->\n                                                </a>\n                                            </td>\n                                        </tr>\n                                        <tr>\n                                            <td colspan=\"3\">\n                                                <table width=\"180\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\">\n                                                    <tr>\n                                                        <td width=\"5\" style=\"background-color: #00483a;\"></td>\n                                                        <td align=\"center\" valign=\"middle\" width=\"67\" style=\"background-color: #00483a; font-family: Arial; font-size: 12px;\">\n                                                            <a href=\"<%= appendUrlParams(products_basket_recommended[i].link, urlParams) %>\" target=\"_blank\" name=\"persoo<%= i %>_zobrazit\" style=\"color: #fffffe; text-decoration: none;\">\n                                                                <span style=\"color: #fffffe;\">\n                                                                    ZOBRAZIT\n                                                                    PRODUKT\n                                                                </span>\n                                                            </a>\n                                                        </td>\n                                                        <td width=\"5\" style=\"background-color: #00483a;\"></td>\n                                                        <td width=\"25\" style=\"background-color: #2b6458;\">\n                                                            <a href=\"<%= products_basket_recommended[i].link + '?' + urlParams %>\" target=\"_blank\" name=\"persoo<%= i %>_arrow\">\n                                                                <img src=\"http://s3-eu-west-1.amazonaws.com/cz.persoo.images/vqb36nehmep6dh1kbjpfpb4f/b_3.jpg\" border=\"0\" />\n                                                            </a>\n                                                        </td>\n                                                        <td width=\"5\" style=\"background-color: #00483a;\"></td>\n                                                        <td width=\"68\" style=\"background-color: #00483a; font-family: Arial; font-size: 12px; font-weight: bold;\">\n                                                            <a href=\"<%= appendUrlParams(products_basket_recommended[i].link, urlParams) %>\" target=\"_blank\" name=\"persoo<%= i %>_price\" style=\"color: #fffffe; text-decoration: none;\">\n                                                                <span style=\"color: #fffffe;\">\n                                                                    <%= printPrice(products_basket_recommended[i].price) %>&nbsp;Kč\n                                                                </span>\n                                                            </a>\n                                                        </td>\n                                                        <td width=\"5\" style=\"background-color: #00483a;\"></td>\n                                                    </tr>\n                                                </table>\n                                            </td>\n                                        </tr>\n                                    </table>\n                                    <!-- END PERSOO PRODUKT <%= i %> -->\n                                </td>\n                                <% if (i<2) { %><td width=\"15\"></td><% } %>\n                                <% } %>\n                            </tr>\n                        </table>\n                        &nbsp;<br />\n                        <table width=\"600\" height=\"2\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" bgcolor=\"white\">\n                            <tr>\n                                <td colspan=\"3\" style=\"font-size: 0px;\">\n                                    <img src=\"http://s3-eu-west-1.amazonaws.com/cz.persoo.images/vqb36nehmep6dh1kbjpfpb4f/mount.jpg\" border=\"0\" />\n                                </td>\n                            </tr>\n                            <tr>\n                                <td width=\"15\" style=\"background-color: #dcd7cc;\"></td>\n                                <td style=\"background-color: #dcd7cc; font-family: Arial; font-size: 12px; color: #2d2d2d;\">\n                                    &nbsp;<br />\n                                     \n                                    <br />\n                                    &nbsp;<br />\n                                    © 2015 Hanibal.cz  All rights reserved.<br />\n                                    &nbsp;<br />\n                                    Tento email Vám byl zaslán na <%= email_email %> jako obchodní sdělení na základě Vašeho souhlasu. Děkujeme.<br />\n                                    &nbsp;<br />\n                                </td>\n                                <td width=\"15\" style=\"background-color: #dcd7cc;\"></td>\n                            </tr>\n                        </table>\n                    </td>\n                    <td style=\"background-color: #ece8dc; background-image: url('http://s3-eu-west-1.amazonaws.com/cz.persoo.images/vqb36nehmep6dh1kbjpfpb4f/bg.jpg');\"></td>\n                </tr>\n            </table>\n        </center>\n    </body>\n</html>",
                            "subject": "Nechybí Vám něco v batohu<%= db.mailchimp && db.mailchimp['5PAD'] ? ',' + db.mailchimp['5PAD'] : '' %>?",
                            "textBody": "<%\n// mapping products to be displayed here\nvar products_basket = products1 || [];\nvar products_basket_recommended = products2 || [];\n\nvar email_osloveni = db.mailchimp.OSLOVENI;\nvar email_5pad = db.mailchimp['5PAD'];\nvar email_email = db.bestIdentifications.email;\nvar basketTotal = 10;\n%>\n\n<%= email_osloveni ? email_osloveni : 'Ahoj' %>, <%= email_5pad ? email_5pad + ',' : '' %>\n\nVšimla jsem si, že v košíku máte něco, co by se Vám mohlo hodit.\n\nCo se stalo? Potřebujete s něčím poradit? Nebo se něco pokazilo v nákupním procesu? Zavolejte mi nebo napište email, ráda Vám pomůžu s čímkoliv bude potřeba!\n                      \nParádní outdoorový den\n\n       Terka"
                        },
                        "minTimeBeforeNextTrigger": 864000000,
                        "scenarios": {
                            "products1": "bcf7640656ab404aacaef9bcd5c9bc55",
                            "products2": "basketCrosssell"
                        },
                        "triggerFunction": "function trigger(io){\n    var send = false;\n    var lastBasketChange = io.db.lastAccesses.basketChange;\n    var lastPageview = io.db.lastAccesses.pageview;\n    \n    if(\n    \n    /* basket is non-empty */\n    io.db.products.inBasket &&\n    io.db.products.inBasket.length > 0 &&\n        \n    /* at least 2 hours after last visit */\n    atLeastNDaysAfter(lastPageview, 1/12) &&\n        \n    /* at most 3 days after basket status has Changed */\n    atMostNDaysAfter(lastBasketChange, 3) &&\n    \n    /* not already sent after last visit */\n    locationNotAlreadySentAfter(lastPageview)\n        \n    ) {\n        return true;\n    } else {\n        return false;\n    }\n}"
                    }
                ]
            },
            {
                "id": "de5c074d3f274aab943054dbbfac3803",
                "name": "Basket reminder example",
                "class": "email",
                "isActive": false,
                "variants": [
                    {
                        "id": "default",
                        "name": "default",
                        "condition": "true",
                        "content": {
                            "googleAnalyticsLocation": "exampleLocationName",
                            "htmlBody": "<p>Come back and buy X.</p>",
                            "subject": "Your product X is on SALE",
                            "textBody": "Come back and buy X."
                        },
                        "minTimeBeforeNextTrigger": 1,
                        "scenarios": {
                            "products1": "psGeneral"
                        },
                        "triggerFunction": ""
                    }
                ]
            }
        ]

### newLocation [POST]
Create a new location.

+ Request (application/json)

        {
            "name": "basketReminder1st",
            "class": "email",
            "isActive": true,
            "variants": [
                {
                    "id": "default",
                    "name": "default",
                    "condition": "db.products.inBasket && db.products.inBasket.length > 0",
                    "content": {
                        "googleAnalyticsLocation": "basketReminder1st",
                        "htmlBody": "<%\nfunction printPrice(p){\n\treturn String(Math.round(p)).replace(/(.*)([0-9]{3})/,'$1 $2');\n}\nfunction appendUrlParams(url, params){\n   var parts =  url.split('#');\n   parts[0] += ( parts[0].indexOf('?')<0  ? '?' : '&') + params;\n   return parts.join('#');\n}\n\nvar basketReminderStep = 'first';\n\n// mapping products to be displayed here\nvar products_basket = products1 || [];\nvar products_basket_recommended = products2 || [];\nvar percent = String.fromCharCode(37);\nvar urlParams = 'persooLocation=basketReminder1';\n\nvar email_osloveni = db.mailchimp.OSLOVENI;\nvar email_5pad = db.mailchimp['5PAD'];\nvar email_email = db.bestIdentifications.email;\nvar basketTotal = 10;\n\n%>\n<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\">\n<html lang=\"en\" xml:lang=\"en\" xmlns=\"http://www.w3.org/1999/xhtml\">\t   \n    <head>\t\t     \n        <title>    \n        </title>\t\t     \n        <meta content=\"text/html; charset=UTF-8\" http-equiv=\"content-type\" />\t\t     \n        <meta content=\"application/xhtml+xml; charset=UTF-8\" http-equiv=\"content-type\" />\t\t     \n        <meta content=\"width=device-width, initial scale=1\" name=\"viewport\" />\t   \n    </head>\t   \n    <body style=\"margin:0; padding: 0; background-color: #ece8dc; background-image: url('bg.jpg');\">\n        <center>\n            <span style=\"font-size: 1px; color: #ece8dc;\">\n                <% if (basketReminderStep == 'first') { %>\n                Co třeba <%= products_basket[0].name %>?\n                <% } %>\n                <% if (basketReminderStep == 'second') { %>\n                <%= products_basket[0].name %> už na Vás čeká. \n                <% } %>\n            </span>\n            <table style=\"width:100%;\" cellspacing=\"0\" cellpadding=\"0\">\n                <tr>\n                    <td style=\"background-color: #ece8dc; background-image: url('http://s3-eu-west-1.amazonaws.com/cz.persoo.images/vqb36nehmep6dh1kbjpfpb4f/bg.jpg');\"></td>\n                    <td width=\"600\" align=\"left\" bgcolor=\"white\" style=\"background-color: white;\">\n                        <table width=\"600\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" bgcolor=\"white\">\n                            <tr>\n                                <td>\n                                    <img src=\"http://s3-eu-west-1.amazonaws.com/cz.persoo.images/vqb36nehmep6dh1kbjpfpb4f/header.jpg\" alt=\"\" usemap=\"#map\" />\n                                    <map name=\"map\">\n                                        <area shape=\"rect\" coords=\"0, 63, 599, 159\" href=\"http://www.hanibal.cz/<%= '?' + urlParams %>\" target=\"_blank\" />\n                                        <area shape=\"rect\" coords=\"529, 10, 599, 61\" href=\"http://www.hanibal.cz/blog/<%= '?' + urlParams %>\" target=\"_blank\" />\n                                        <area shape=\"rect\" coords=\"412, 10, 527, 61\" href=\"http://www.hanibal.cz/pujcovna/<%= '?' + urlParams %>\" target=\"_blank\" />\n                                        <area shape=\"rect\" coords=\"297, 10, 411, 61\" href=\"http://www.hanibal.cz/academy/<%= '?' + urlParams %>\" target=\"_blank\" />\n                                        <area shape=\"rect\" coords=\"206, 10, 296, 61\" href=\"http://www.hanibal.cz/<%= '?' + urlParams %>\" target=\"_blank\" />\n                                        <area shape=\"rect\" coords=\"1, 10, 206, 61\" href=\"http://www.hanibal.cz/<%= '?' + urlParams %>\" target=\"_blank\" />\n                                    </map>\n                                </td>\n                            </tr>\n                        </table>\n                        &nbsp;<br />\n                        <table width=\"600\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" bgcolor=\"white\">\n                            <tr>\n                                <td width=\"15\" rowspan=\"2\"></td>\n                                <td width=\"180\" valign=\"top\">\n                                    <!-- BEGIN OPUSTENY KOSIK, VELKY IMG -->\n                                    <table width=\"180\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\">\n                                        <tr>\n                                            <td style=\"font-size: 16px; color: #ff9525; font-family: Arial;\">\n                                                <a href=\"<%= appendUrlParams(products_basket[0].URL, urlParams) %>\" target=\"_blank\" style=\"color: #ff9525; text-decoration: none;\">\n                                                    <span style=\"color: #ff9525;\">\n                                                        <%= products_basket[0].name %>\n                                                    </span>\n                                                </a><br /><span style=\"font-size: 10px; line-height: 10px;\">&nbsp;</span>\n                                            </td>\n                                        </tr>\n                                        <tr>\n                                            <td style=\"font-size: 16px; color: #504d48; font-family: Arial;\">\n                                                <% if(products_basket[0].priceOrig){ %>\n                                                <strike><%= printPrice(products_basket[0].priceOrig) %>,-&nbsp;Kč</strike>  &nbsp;\n                                                <% } %>\n                                                <span style=\"color: #00483a; font-size: 20px;\"><%= printPrice(products_basket[0].price) %>&nbsp;Kč</span>\n                                                <br /><span style=\"font-size: 10px; line-height: 10px;\">&nbsp;</span>\n                                            </td>\n                                        </tr>\n                                        <tr>\n                                            <td align=\"center\">\n                                                <a href=\"<%= appendUrlParams(products_basket[0].URL, urlParams) %>\" target=\"_blank\">\n                                                    <img src=\"<%= products_basket[0].imageLink %>\" border=\"0\" /><!-- max. sirka obrazku 180px -->\n                                                </a>\n                                                <br /><span style=\"font-size: 10px; line-height: 10px;\">&nbsp;</span>\n                                            </td>\n                                        </tr>\n                                    </table>\n                                    <!-- END OPUSTENY KOSIK, VELKY IMG -->\n                                </td>\n                                <td width=\"30\" rowspan=\"2\"></td>\n                                <td width=\"360\" valign=\"top\" style=\"font-size: 14px; color: #43413c; font-family: Arial;\">\n                                    <%= email_osloveni ? email_osloveni : 'Ahoj' %>, <%= email_5pad ? email_5pad + ',' : '' %><br />\n                                    &nbsp;<br />\n\n                                    <% if (basketReminderStep == 'first') { %>\n                                    Všimla jsem si, že v košíku máte něco, co by se Vám mohlo hodit.<br />\n                                    &nbsp;<br />\n                                    Co se stalo? Potřebujete s něčím poradit? Nebo se něco pokazilo v nákupním procesu? Zavolejte mi nebo \n\nnapište email, ráda Vám pomůžu s čímkoliv bude potřeba!<br />\n\t\t\t\t\t\t\t\t\t<% } %>\n                                    \n                                    <% if (basketReminderStep == 'second') { %>\n                                    v košíku na Vás stále něco čeká. Stačí už jen málo a můžete mít skvělé vybavení doma! \n                                    Zavolejte mi nebo napište email, ráda Vám pomůžu s čímkoliv bude potřeba!<br />&nbsp;\n                                    <br />\n\t\t\t\t\t\t\t\t\tA navíc, <b>když dokončíte nákup,</b> přibalíme Vám do objednávky něco na zub – sušené maso Indiana Jerky! Stačí, abyste v košíku zadali kód: <b>\"Jerky\"</b> <br />&nbsp;\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t<br />\n\t\t\t\t\t\t\t\t\t<% if (basketTotal >= 2000) { %>\n\t\t\t\t\t\t\t\t\t   Mimoto <b>máte dopravu zdarma.</b><br />\n\t\t\t\t\t\t\t\t\t<% } else if (basketTotal > 1500) { %>\n\t\t\t\t\t\t\t\t\t   Mimoto Vám <b>zbývá už jen <%= 2000 - basketTotal %> Kč, abychom Vám nezaúčtovali poštovné.</b>  Nechcete si ještě něco vybrat?<br />\n                                    <% } %>\n                                    \n                                    \n                                    <% } %>\n                                    &nbsp;<br />\n                                    Parádní outdoorový den<br />\n                                    &nbsp;<br />\n                                    Terka<br />\n                                    &nbsp;<br />\n                                    <table width=\"360\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\">\n                                        <tr>\n                                            <td width=\"41\"></td>\n                                            <td width=\"50\" style=\"background-color: #2b6458;\">\n                                                <a href=\"<%= appendUrlParams('http://www.hanibal.cz/kosik/',urlParams) %>\" target=\"_blank\">\n                                                    <img src=\"http://s3-eu-west-1.amazonaws.com/cz.persoo.images/vqb36nehmep6dh1kbjpfpb4f/b_1.jpg\" border=\"0\" />\n                                                </a>\n                                            </td>\n                                            <td width=\"10\" style=\"background-color: #125345;\"></td>\n                                            <td width=\"180\" align=\"left\" valign=\"middle\" style=\"background-color: #125345; color: white; font-family: Arial; font-size: 14px;\">\n                                                <a href=\"<%= appendUrlParams('http://www.hanibal.cz/kosik/',urlParams) %>\" target=\"_blank\" style=\"color: #fffffe; text-decoration: none;\">\n                                                    <span style=\"color: #fffffe; font-weight: bold;\">\n                                                        Dokončit nákup\n                                                    </span>\n                                                </a>\n                                            </td>\n                                            <td width=\"10\" style=\"background-color: #125345;\"></td>\n                                            <td width=\"28\" style=\"background-color: #2b6458;\">\n                                                <a href=\"<%= appendUrlParams('http://www.hanibal.cz/kosik/',urlParams) %>\" target=\"_blank\">\n                                                    <img src=\"http://s3-eu-west-1.amazonaws.com/cz.persoo.images/vqb36nehmep6dh1kbjpfpb4f/b_2.jpg\" border=\"0\" />\n                                                </a>\n                                            </td>\n                                            <td width=\"41\"></td>\n                                        </tr>\n\n                                    </table>\n                                    <br />&nbsp;<br />&nbsp;<br />\n                                </td>\n                            </tr>\n                            <tr>\n                                <td width=\"180\" valign=\"top\">\n                                    <% for(var i=1;i<3&&i<products_basket.length;i++) { %>\n                                    <!-- BEGIN OPUSTENY KOSIK, MALY IMG -->\n                                    <table width=\"180\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" style=\"border-top: 1px solid #ff9525;\">                                        \n                                        <tr>\n                                            <td style=\"font-size: 16px; color: #ff9525; font-family: Arial;\" colspan=\"3\">\n                                                <span style=\"font-size: 10px; line-height: 10px;\">&nbsp;<br /></span>\n                                                <a href=\"<%= appendUrlParams(products_basket[i].URL, urlParams) %>\" target=\"_blank\" style=\"color: #ff9525; text-decoration: none;\">\n                                                    <span style=\"color: #ff9525;\">\n                                                        <%= products_basket[i].name %>\n                                                    </span>\n                                                </a><br />\n                                                <span style=\"font-size: 10px; line-height: 10px;\">&nbsp;</span>\n                                            </td>\n                                        </tr>\n                                        <tr>\n                                            <td align=\"center\" width=\"80\" valign=\"middle\">\n                                                <a href=\"<%= appendUrlParams(products_basket[i].URL, urlParams) %>\" target=\"_blank\">\n                                                    <img src=\"<%= products_basket[i].imageLink %>\" border=\"0\" style=\"max-width:50px; max-height:50px;\"/> <!-- max. sirka obrazku 80px -->\n                                                </a>\n                                            </td>\n                                            <td width=\"10\"></td>\n                                            <td align=\"right\" valign=\"middle\" style=\"font-size: 14px; color: #504d48; font-family: Arial;\">\n                                                <% if(products_basket[i].priceOrig){ %>\n                                                <strike><%= printPrice(products_basket[i].priceOrig) %>,-&nbsp;Kč</strike><br />\n                                                <% } %>\n                                                <span style=\"color: #00483a; font-size: 18px;\"><%= printPrice(products_basket[i].price) %>&nbsp;Kč</span>\n                                            </td>\n                                        </tr>\n                                        <tr>\n                                            <td>\n                                                <span style=\"font-size: 10px; line-height: 10px;\">&nbsp;<br /></span>\n                                            </td>\n                                        </tr>\n                                    </table>\n                                    <!-- END OPUSTENY KOSIK, MALY IMG -->\n                                    <% } %>\n                                    <% for(var i=3;i<4 && i<products_basket.length;i++) { %>\n                                    <!-- BEGIN OPUSTENY KOSIK, BEZ IMG -->\n                                    <table width=\"180\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" style=\"border-top: 1px solid #ff9525;\">\n                                        <tr>\n                                            <td style=\"font-size: 16px; color: #ff9525; font-family: Arial;\">\n                                                <span style=\"font-size: 10px; line-height: 10px;\">&nbsp;<br /></span>\n                                                <a href=\"<%= appendUrlParams(products_basket[i].URL, urlParams) %>\" target=\"_blank\" style=\"color: #ff9525; text-decoration: none;\">\n                                                    <span style=\"color: #ff9525;\">\n                                                        <%= products_basket[i].name %>\n                                                    </span>\n                                                </a><br /><span style=\"font-size: 10px; line-height: 10px;\">&nbsp;<br /></span>\n                                            </td>\n                                        </tr>\n                                        <tr>\n                                            <td style=\"font-size: 14px; color: #504d48; font-family: Arial;\">\n                                                <% if(products_basket[i].priceOrig){ %>\n                                                <strike><%= printPrice(products_basket[i].priceOrig) %>,-&nbsp;Kč</strike>  &nbsp;\n                                                <% } %>\n                                                <span style=\"color: #00483a; font-size: 18px;\"><%= printPrice(products_basket[i].price) %>&nbsp;Kč</span>\n                                                <br /><span style=\"font-size: 10px; line-height: 10px;\">&nbsp;<br /></span>\n                                            </td>\n                                        </tr>\n                                    </table>\n                                    <!-- BEGIN OPUSTENY KOSIK, BEZ IMG -->\n                                    <% } %>\n                                </td>\n                                <td width=\"360\" valign=\"top\" style=\"font-size: 14px; color: #43413c; font-family: Arial;\">\n                                    <table width=\"360\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\">\n                                        <tr>\n                                            <td colspan=\"3\" width=\"195\" height=\"37\" valign=\"middle\" style=\"font-family: Arial; color: #fffffe; background-color: #ff9525;\">\n                                                &nbsp;&nbsp;&nbsp;Poradím Vám\n                                            </td>\n                                            <td width=\"20\" rowspan=\"3\"></td>\n                                            <td width=\"145\" valign=\"top\" rowspan=\"3\">\n                                                <img src=\"http://s3-eu-west-1.amazonaws.com/cz.persoo.images/vqb36nehmep6dh1kbjpfpb4f/terka.jpg\" border=\"0\" />\n                                            </td>\n                                        </tr>\n                                        <tr>\n                                            <td align=\"left\" valign=\"middle\" height=\"40\" colspan=\"3\" style=\"font-size: 24px; font-family: Arial; color: #00483a;\">\n                                                Terka Valentová\n                                                <table width=\"195\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\">\n                                                    <tr>\n                                                        <td width=\"20\" height=\"35\"></td>\n                                                        <td width=\"30\" align=\"left\" valign=\"middle\" style=\"font-size: 0px;\"s>\n                                                            <img src=\"http://s3-eu-west-1.amazonaws.com/cz.persoo.images/vqb36nehmep6dh1kbjpfpb4f/call.jpg\" border=\"0\" />\n                                                        </td>\n                                                        <td align=\"left\" valign=\"middle\" style=\"font-size: 14px; font-family: Arial; color: #00483a;\">\n                                                            777 062 416\n                                                        </td>\n                                                    </tr>\n                                                    <tr>\n                                                        <td width=\"20\" height=\"35\"></td>\n                                                        <td width=\"30\" align=\"left\" valign=\"middle\" style=\"font-size: 0px;\">\n                                                            <img src=\"http://s3-eu-west-1.amazonaws.com/cz.persoo.images/vqb36nehmep6dh1kbjpfpb4f/time.jpg\" border=\"0\" />\n                                                        </td>\n                                                        <td align=\"left\" valign=\"middle\" style=\"font-size: 14px; font-family: Arial; color: #00483a;\">\n                                                            9:00 - 16:00\n                                                        </td>\n                                                    </tr>\n                                                    <tr>\n                                                        <td width=\"20\" height=\"35\"></td>\n                                                        <td width=\"30\" align=\"left\" valign=\"middle\" style=\"font-size: 0px;\">\n                                                            <img src=\"http://s3-eu-west-1.amazonaws.com/cz.persoo.images/vqb36nehmep6dh1kbjpfpb4f/mail.jpg\" border=\"0\" />\n                                                        </td>\n                                                        <td align=\"left\" valign=\"middle\" style=\"font-size: 14px; font-family: Arial; color: #00483a;\">\n                                                            <a href=\"mailto:terka@hanibal.cz\" style=\"color: #00483a; text-decoration: none;\">\n                                                                <span style=\"color: #00483a; text-decoration: none;\">\n                                                                    terka@hanibal.cz\n                                                                </span>\n                                                            </a>\n                                                        </td>\n                                                    </tr>\n                                                </table>\n                                            </td>\n                                        </tr>\n                                    </table>\n                                </td>\n                                <td width=\"15\"></td>\n                            </tr>\n                        </table>\n                        &nbsp;<br />\n                        <table width=\"600\" height=\"2\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" bgcolor=\"white\">\n                            <tr>\n                                <td height=\"2\" style=\"border-top: 1px solid #cdcdcd; border-bottom: 1px solid #cdcdcd;\"></td>\n                            </tr>\n                        </table>\n                        <table width=\"600\" height=\"2\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" bgcolor=\"white\">\n                            <tr>\n                                <td width=\"15\" rowspan=\"2\"></td>\n                                <td align=\"center\" valign=\"middle\" height=\"80\" colspan=\"5\" style=\"font-size: 24px; font-family: Arial; color: #00483a;\">\n                                    A přidávám ještě něco, co by se Vám mohlo hodit.\n                                </td>\n                                <td width=\"15\" rowspan=\"2\"></td>\n                            </tr>\n                            <tr>\n                                <% for(var i=0;i<3 && i < products_basket_recommended.length;i++) { %>\n                                <td width=\"180\" valign=\"bottom\">\n                                    <!-- PERSOO PRODUKT <%= i %> -->\n                                    <table width=\"180\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\">\n                                        <tr>\n                                            <td width=\"5\" style=\"background-color: #ff9525;\"></td>\n                                            <td height=\"40\" align=\"left\" valign=\"middle\" style=\"background-color: #ff9525; font-family: Arial; font-size: 14px; color: #fffffe; height:40px; line-height: 20px;\">\n                                                <div style=\"height:40px; overflow: hidden;\">\n                                                    <a href=\"<%= appendUrlParams(products_basket_recommended[i].link, urlParams) %>\" target=\"_blank\" name=\"persoo<%= i %>_title\" style=\"color: #fffffe; text-decoration: none;\">\n                                                        <span style=\"color: #fffffe;\">\n                                                            <%= products_basket_recommended[i].name %>\n                                                        </span>\n                                                    </a>\n                                                </div>\n                                            </td>\n                                            <td width=\"5\" style=\"background-color: #ff9525;\"></td>\n                                        </tr>\n                                        <tr>\n                                            <td colspan=\"3\" align=\"center\" valign=\"middle\" height=\"185\">\n                                                <a href=\"<%= appendUrlParams(products_basket_recommended[i].link, urlParams) %>\" target=\"_blank\" name=\"persoo<%= i %>_image\">\n                                                    <img src=\"<%= products_basket_recommended[i].imageLink %>\" border=\"0\" style=\"max-height: 170px; max-width: 175px;\" /> <!-- max. velikost obrazku 180px * 185px -->\n                                                </a>\n                                            </td>\n                                        </tr>\n                                        <tr>\n                                            <td colspan=\"3\">\n                                                <table width=\"180\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\">\n                                                    <tr>\n                                                        <td width=\"5\" style=\"background-color: #00483a;\"></td>\n                                                        <td align=\"center\" valign=\"middle\" width=\"67\" style=\"background-color: #00483a; font-family: Arial; font-size: 12px;\">\n                                                            <a href=\"<%= appendUrlParams(products_basket_recommended[i].link, urlParams) %>\" target=\"_blank\" name=\"persoo<%= i %>_zobrazit\" style=\"color: #fffffe; text-decoration: none;\">\n                                                                <span style=\"color: #fffffe;\">\n                                                                    ZOBRAZIT\n                                                                    PRODUKT\n                                                                </span>\n                                                            </a>\n                                                        </td>\n                                                        <td width=\"5\" style=\"background-color: #00483a;\"></td>\n                                                        <td width=\"25\" style=\"background-color: #2b6458;\">\n                                                            <a href=\"<%= products_basket_recommended[i].link + '?' + urlParams %>\" target=\"_blank\" name=\"persoo<%= i %>_arrow\">\n                                                                <img src=\"http://s3-eu-west-1.amazonaws.com/cz.persoo.images/vqb36nehmep6dh1kbjpfpb4f/b_3.jpg\" border=\"0\" />\n                                                            </a>\n                                                        </td>\n                                                        <td width=\"5\" style=\"background-color: #00483a;\"></td>\n                                                        <td width=\"68\" style=\"background-color: #00483a; font-family: Arial; font-size: 12px; font-weight: bold;\">\n                                                            <a href=\"<%= appendUrlParams(products_basket_recommended[i].link, urlParams) %>\" target=\"_blank\" name=\"persoo<%= i %>_price\" style=\"color: #fffffe; text-decoration: none;\">\n                                                                <span style=\"color: #fffffe;\">\n                                                                    <%= printPrice(products_basket_recommended[i].price) %>&nbsp;Kč\n                                                                </span>\n                                                            </a>\n                                                        </td>\n                                                        <td width=\"5\" style=\"background-color: #00483a;\"></td>\n                                                    </tr>\n                                                </table>\n                                            </td>\n                                        </tr>\n                                    </table>\n                                    <!-- END PERSOO PRODUKT <%= i %> -->\n                                </td>\n                                <% if (i<2) { %><td width=\"15\"></td><% } %>\n                                <% } %>\n                            </tr>\n                        </table>\n                        &nbsp;<br />\n                        <table width=\"600\" height=\"2\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" bgcolor=\"white\">\n                            <tr>\n                                <td colspan=\"3\" style=\"font-size: 0px;\">\n                                    <img src=\"http://s3-eu-west-1.amazonaws.com/cz.persoo.images/vqb36nehmep6dh1kbjpfpb4f/mount.jpg\" border=\"0\" />\n                                </td>\n                            </tr>\n                            <tr>\n                                <td width=\"15\" style=\"background-color: #dcd7cc;\"></td>\n                                <td style=\"background-color: #dcd7cc; font-family: Arial; font-size: 12px; color: #2d2d2d;\">\n                                    &nbsp;<br />\n                                     \n                                    <br />\n                                    &nbsp;<br />\n                                    © 2015 Hanibal.cz  All rights reserved.<br />\n                                    &nbsp;<br />\n                                    Tento email Vám byl zaslán na <%= email_email %> jako obchodní sdělení na základě Vašeho souhlasu. Děkujeme.<br />\n                                    &nbsp;<br />\n                                </td>\n                                <td width=\"15\" style=\"background-color: #dcd7cc;\"></td>\n                            </tr>\n                        </table>\n                    </td>\n                    <td style=\"background-color: #ece8dc; background-image: url('http://s3-eu-west-1.amazonaws.com/cz.persoo.images/vqb36nehmep6dh1kbjpfpb4f/bg.jpg');\"></td>\n                </tr>\n            </table>\n        </center>\n    </body>\n</html>",
                        "subject": "Nechybí Vám něco v batohu<%= db.mailchimp && db.mailchimp['5PAD'] ? ',' + db.mailchimp['5PAD'] : '' %>?",
                        "textBody": "<%\n// mapping products to be displayed here\nvar products_basket = products1 || [];\nvar products_basket_recommended = products2 || [];\n\nvar email_osloveni = db.mailchimp.OSLOVENI;\nvar email_5pad = db.mailchimp['5PAD'];\nvar email_email = db.bestIdentifications.email;\nvar basketTotal = 10;\n%>\n\n<%= email_osloveni ? email_osloveni : 'Ahoj' %>, <%= email_5pad ? email_5pad + ',' : '' %>\n\nVšimla jsem si, že v košíku máte něco, co by se Vám mohlo hodit.\n\nCo se stalo? Potřebujete s něčím poradit? Nebo se něco pokazilo v nákupním procesu? Zavolejte mi nebo napište email, ráda Vám pomůžu s čímkoliv bude potřeba!\n                      \nParádní outdoorový den\n\n       Terka"
                    },
                    "minTimeBeforeNextTrigger": 864000000,
                    "scenarios": {
                        "products1": "bcf7640656ab404aacaef9bcd5c9bc55",
                        "products2": "basketCrosssell"
                    },
                    "triggerFunction": "function trigger(io){\n    var send = false;\n    var lastBasketChange = io.db.lastAccesses.basketChange;\n    var lastPageview = io.db.lastAccesses.pageview;\n    \n    if(\n    \n    /* basket is non-empty */\n    io.db.products.inBasket &&\n    io.db.products.inBasket.length > 0 &&\n        \n    /* at least 2 hours after last visit */\n    atLeastNDaysAfter(lastPageview, 1/12) &&\n        \n    /* at most 3 days after basket status has Changed */\n    atMostNDaysAfter(lastBasketChange, 3) &&\n    \n    /* not already sent after last visit */\n    locationNotAlreadySentAfter(lastPageview)\n        \n    ) {\n        return true;\n    } else {\n        return false;\n    }\n}"
                }
            ]
        }

+ Response 201 (application/json)

        {
            "id": "e739f150fa504c7a87634e124a6e6414",
            "name": "basketReminder1st",
            "class": "email",
            "isActive": true,
            "variants": [
                {
                    "id": "default",
                    "name": "default",
                    "condition": "db.products.inBasket && db.products.inBasket.length > 0",
                    "content": {
                        "googleAnalyticsLocation": "basketReminder1st",
                        "htmlBody": "<%\nfunction printPrice(p){\n\treturn String(Math.round(p)).replace(/(.*)([0-9]{3})/,'$1 $2');\n}\nfunction appendUrlParams(url, params){\n   var parts =  url.split('#');\n   parts[0] += ( parts[0].indexOf('?')<0  ? '?' : '&') + params;\n   return parts.join('#');\n}\n\nvar basketReminderStep = 'first';\n\n// mapping products to be displayed here\nvar products_basket = products1 || [];\nvar products_basket_recommended = products2 || [];\nvar percent = String.fromCharCode(37);\nvar urlParams = 'persooLocation=basketReminder1';\n\nvar email_osloveni = db.mailchimp.OSLOVENI;\nvar email_5pad = db.mailchimp['5PAD'];\nvar email_email = db.bestIdentifications.email;\nvar basketTotal = 10;\n\n%>\n<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\">\n<html lang=\"en\" xml:lang=\"en\" xmlns=\"http://www.w3.org/1999/xhtml\">\t   \n    <head>\t\t     \n        <title>    \n        </title>\t\t     \n        <meta content=\"text/html; charset=UTF-8\" http-equiv=\"content-type\" />\t\t     \n        <meta content=\"application/xhtml+xml; charset=UTF-8\" http-equiv=\"content-type\" />\t\t     \n        <meta content=\"width=device-width, initial scale=1\" name=\"viewport\" />\t   \n    </head>\t   \n    <body style=\"margin:0; padding: 0; background-color: #ece8dc; background-image: url('bg.jpg');\">\n        <center>\n            <span style=\"font-size: 1px; color: #ece8dc;\">\n                <% if (basketReminderStep == 'first') { %>\n                Co třeba <%= products_basket[0].name %>?\n                <% } %>\n                <% if (basketReminderStep == 'second') { %>\n                <%= products_basket[0].name %> už na Vás čeká. \n                <% } %>\n            </span>\n            <table style=\"width:100%;\" cellspacing=\"0\" cellpadding=\"0\">\n                <tr>\n                    <td style=\"background-color: #ece8dc; background-image: url('http://s3-eu-west-1.amazonaws.com/cz.persoo.images/vqb36nehmep6dh1kbjpfpb4f/bg.jpg');\"></td>\n                    <td width=\"600\" align=\"left\" bgcolor=\"white\" style=\"background-color: white;\">\n                        <table width=\"600\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" bgcolor=\"white\">\n                            <tr>\n                                <td>\n                                    <img src=\"http://s3-eu-west-1.amazonaws.com/cz.persoo.images/vqb36nehmep6dh1kbjpfpb4f/header.jpg\" alt=\"\" usemap=\"#map\" />\n                                    <map name=\"map\">\n                                        <area shape=\"rect\" coords=\"0, 63, 599, 159\" href=\"http://www.hanibal.cz/<%= '?' + urlParams %>\" target=\"_blank\" />\n                                        <area shape=\"rect\" coords=\"529, 10, 599, 61\" href=\"http://www.hanibal.cz/blog/<%= '?' + urlParams %>\" target=\"_blank\" />\n                                        <area shape=\"rect\" coords=\"412, 10, 527, 61\" href=\"http://www.hanibal.cz/pujcovna/<%= '?' + urlParams %>\" target=\"_blank\" />\n                                        <area shape=\"rect\" coords=\"297, 10, 411, 61\" href=\"http://www.hanibal.cz/academy/<%= '?' + urlParams %>\" target=\"_blank\" />\n                                        <area shape=\"rect\" coords=\"206, 10, 296, 61\" href=\"http://www.hanibal.cz/<%= '?' + urlParams %>\" target=\"_blank\" />\n                                        <area shape=\"rect\" coords=\"1, 10, 206, 61\" href=\"http://www.hanibal.cz/<%= '?' + urlParams %>\" target=\"_blank\" />\n                                    </map>\n                                </td>\n                            </tr>\n                        </table>\n                        &nbsp;<br />\n                        <table width=\"600\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" bgcolor=\"white\">\n                            <tr>\n                                <td width=\"15\" rowspan=\"2\"></td>\n                                <td width=\"180\" valign=\"top\">\n                                    <!-- BEGIN OPUSTENY KOSIK, VELKY IMG -->\n                                    <table width=\"180\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\">\n                                        <tr>\n                                            <td style=\"font-size: 16px; color: #ff9525; font-family: Arial;\">\n                                                <a href=\"<%= appendUrlParams(products_basket[0].URL, urlParams) %>\" target=\"_blank\" style=\"color: #ff9525; text-decoration: none;\">\n                                                    <span style=\"color: #ff9525;\">\n                                                        <%= products_basket[0].name %>\n                                                    </span>\n                                                </a><br /><span style=\"font-size: 10px; line-height: 10px;\">&nbsp;</span>\n                                            </td>\n                                        </tr>\n                                        <tr>\n                                            <td style=\"font-size: 16px; color: #504d48; font-family: Arial;\">\n                                                <% if(products_basket[0].priceOrig){ %>\n                                                <strike><%= printPrice(products_basket[0].priceOrig) %>,-&nbsp;Kč</strike>  &nbsp;\n                                                <% } %>\n                                                <span style=\"color: #00483a; font-size: 20px;\"><%= printPrice(products_basket[0].price) %>&nbsp;Kč</span>\n                                                <br /><span style=\"font-size: 10px; line-height: 10px;\">&nbsp;</span>\n                                            </td>\n                                        </tr>\n                                        <tr>\n                                            <td align=\"center\">\n                                                <a href=\"<%= appendUrlParams(products_basket[0].URL, urlParams) %>\" target=\"_blank\">\n                                                    <img src=\"<%= products_basket[0].imageLink %>\" border=\"0\" /><!-- max. sirka obrazku 180px -->\n                                                </a>\n                                                <br /><span style=\"font-size: 10px; line-height: 10px;\">&nbsp;</span>\n                                            </td>\n                                        </tr>\n                                    </table>\n                                    <!-- END OPUSTENY KOSIK, VELKY IMG -->\n                                </td>\n                                <td width=\"30\" rowspan=\"2\"></td>\n                                <td width=\"360\" valign=\"top\" style=\"font-size: 14px; color: #43413c; font-family: Arial;\">\n                                    <%= email_osloveni ? email_osloveni : 'Ahoj' %>, <%= email_5pad ? email_5pad + ',' : '' %><br />\n                                    &nbsp;<br />\n\n                                    <% if (basketReminderStep == 'first') { %>\n                                    Všimla jsem si, že v košíku máte něco, co by se Vám mohlo hodit.<br />\n                                    &nbsp;<br />\n                                    Co se stalo? Potřebujete s něčím poradit? Nebo se něco pokazilo v nákupním procesu? Zavolejte mi nebo \n\nnapište email, ráda Vám pomůžu s čímkoliv bude potřeba!<br />\n\t\t\t\t\t\t\t\t\t<% } %>\n                                    \n                                    <% if (basketReminderStep == 'second') { %>\n                                    v košíku na Vás stále něco čeká. Stačí už jen málo a můžete mít skvělé vybavení doma! \n                                    Zavolejte mi nebo napište email, ráda Vám pomůžu s čímkoliv bude potřeba!<br />&nbsp;\n                                    <br />\n\t\t\t\t\t\t\t\t\tA navíc, <b>když dokončíte nákup,</b> přibalíme Vám do objednávky něco na zub – sušené maso Indiana Jerky! Stačí, abyste v košíku zadali kód: <b>\"Jerky\"</b> <br />&nbsp;\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t<br />\n\t\t\t\t\t\t\t\t\t<% if (basketTotal >= 2000) { %>\n\t\t\t\t\t\t\t\t\t   Mimoto <b>máte dopravu zdarma.</b><br />\n\t\t\t\t\t\t\t\t\t<% } else if (basketTotal > 1500) { %>\n\t\t\t\t\t\t\t\t\t   Mimoto Vám <b>zbývá už jen <%= 2000 - basketTotal %> Kč, abychom Vám nezaúčtovali poštovné.</b>  Nechcete si ještě něco vybrat?<br />\n                                    <% } %>\n                                    \n                                    \n                                    <% } %>\n                                    &nbsp;<br />\n                                    Parádní outdoorový den<br />\n                                    &nbsp;<br />\n                                    Terka<br />\n                                    &nbsp;<br />\n                                    <table width=\"360\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\">\n                                        <tr>\n                                            <td width=\"41\"></td>\n                                            <td width=\"50\" style=\"background-color: #2b6458;\">\n                                                <a href=\"<%= appendUrlParams('http://www.hanibal.cz/kosik/',urlParams) %>\" target=\"_blank\">\n                                                    <img src=\"http://s3-eu-west-1.amazonaws.com/cz.persoo.images/vqb36nehmep6dh1kbjpfpb4f/b_1.jpg\" border=\"0\" />\n                                                </a>\n                                            </td>\n                                            <td width=\"10\" style=\"background-color: #125345;\"></td>\n                                            <td width=\"180\" align=\"left\" valign=\"middle\" style=\"background-color: #125345; color: white; font-family: Arial; font-size: 14px;\">\n                                                <a href=\"<%= appendUrlParams('http://www.hanibal.cz/kosik/',urlParams) %>\" target=\"_blank\" style=\"color: #fffffe; text-decoration: none;\">\n                                                    <span style=\"color: #fffffe; font-weight: bold;\">\n                                                        Dokončit nákup\n                                                    </span>\n                                                </a>\n                                            </td>\n                                            <td width=\"10\" style=\"background-color: #125345;\"></td>\n                                            <td width=\"28\" style=\"background-color: #2b6458;\">\n                                                <a href=\"<%= appendUrlParams('http://www.hanibal.cz/kosik/',urlParams) %>\" target=\"_blank\">\n                                                    <img src=\"http://s3-eu-west-1.amazonaws.com/cz.persoo.images/vqb36nehmep6dh1kbjpfpb4f/b_2.jpg\" border=\"0\" />\n                                                </a>\n                                            </td>\n                                            <td width=\"41\"></td>\n                                        </tr>\n\n                                    </table>\n                                    <br />&nbsp;<br />&nbsp;<br />\n                                </td>\n                            </tr>\n                            <tr>\n                                <td width=\"180\" valign=\"top\">\n                                    <% for(var i=1;i<3&&i<products_basket.length;i++) { %>\n                                    <!-- BEGIN OPUSTENY KOSIK, MALY IMG -->\n                                    <table width=\"180\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" style=\"border-top: 1px solid #ff9525;\">                                        \n                                        <tr>\n                                            <td style=\"font-size: 16px; color: #ff9525; font-family: Arial;\" colspan=\"3\">\n                                                <span style=\"font-size: 10px; line-height: 10px;\">&nbsp;<br /></span>\n                                                <a href=\"<%= appendUrlParams(products_basket[i].URL, urlParams) %>\" target=\"_blank\" style=\"color: #ff9525; text-decoration: none;\">\n                                                    <span style=\"color: #ff9525;\">\n                                                        <%= products_basket[i].name %>\n                                                    </span>\n                                                </a><br />\n                                                <span style=\"font-size: 10px; line-height: 10px;\">&nbsp;</span>\n                                            </td>\n                                        </tr>\n                                        <tr>\n                                            <td align=\"center\" width=\"80\" valign=\"middle\">\n                                                <a href=\"<%= appendUrlParams(products_basket[i].URL, urlParams) %>\" target=\"_blank\">\n                                                    <img src=\"<%= products_basket[i].imageLink %>\" border=\"0\" style=\"max-width:50px; max-height:50px;\"/> <!-- max. sirka obrazku 80px -->\n                                                </a>\n                                            </td>\n                                            <td width=\"10\"></td>\n                                            <td align=\"right\" valign=\"middle\" style=\"font-size: 14px; color: #504d48; font-family: Arial;\">\n                                                <% if(products_basket[i].priceOrig){ %>\n                                                <strike><%= printPrice(products_basket[i].priceOrig) %>,-&nbsp;Kč</strike><br />\n                                                <% } %>\n                                                <span style=\"color: #00483a; font-size: 18px;\"><%= printPrice(products_basket[i].price) %>&nbsp;Kč</span>\n                                            </td>\n                                        </tr>\n                                        <tr>\n                                            <td>\n                                                <span style=\"font-size: 10px; line-height: 10px;\">&nbsp;<br /></span>\n                                            </td>\n                                        </tr>\n                                    </table>\n                                    <!-- END OPUSTENY KOSIK, MALY IMG -->\n                                    <% } %>\n                                    <% for(var i=3;i<4 && i<products_basket.length;i++) { %>\n                                    <!-- BEGIN OPUSTENY KOSIK, BEZ IMG -->\n                                    <table width=\"180\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" style=\"border-top: 1px solid #ff9525;\">\n                                        <tr>\n                                            <td style=\"font-size: 16px; color: #ff9525; font-family: Arial;\">\n                                                <span style=\"font-size: 10px; line-height: 10px;\">&nbsp;<br /></span>\n                                                <a href=\"<%= appendUrlParams(products_basket[i].URL, urlParams) %>\" target=\"_blank\" style=\"color: #ff9525; text-decoration: none;\">\n                                                    <span style=\"color: #ff9525;\">\n                                                        <%= products_basket[i].name %>\n                                                    </span>\n                                                </a><br /><span style=\"font-size: 10px; line-height: 10px;\">&nbsp;<br /></span>\n                                            </td>\n                                        </tr>\n                                        <tr>\n                                            <td style=\"font-size: 14px; color: #504d48; font-family: Arial;\">\n                                                <% if(products_basket[i].priceOrig){ %>\n                                                <strike><%= printPrice(products_basket[i].priceOrig) %>,-&nbsp;Kč</strike>  &nbsp;\n                                                <% } %>\n                                                <span style=\"color: #00483a; font-size: 18px;\"><%= printPrice(products_basket[i].price) %>&nbsp;Kč</span>\n                                                <br /><span style=\"font-size: 10px; line-height: 10px;\">&nbsp;<br /></span>\n                                            </td>\n                                        </tr>\n                                    </table>\n                                    <!-- BEGIN OPUSTENY KOSIK, BEZ IMG -->\n                                    <% } %>\n                                </td>\n                                <td width=\"360\" valign=\"top\" style=\"font-size: 14px; color: #43413c; font-family: Arial;\">\n                                    <table width=\"360\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\">\n                                        <tr>\n                                            <td colspan=\"3\" width=\"195\" height=\"37\" valign=\"middle\" style=\"font-family: Arial; color: #fffffe; background-color: #ff9525;\">\n                                                &nbsp;&nbsp;&nbsp;Poradím Vám\n                                            </td>\n                                            <td width=\"20\" rowspan=\"3\"></td>\n                                            <td width=\"145\" valign=\"top\" rowspan=\"3\">\n                                                <img src=\"http://s3-eu-west-1.amazonaws.com/cz.persoo.images/vqb36nehmep6dh1kbjpfpb4f/terka.jpg\" border=\"0\" />\n                                            </td>\n                                        </tr>\n                                        <tr>\n                                            <td align=\"left\" valign=\"middle\" height=\"40\" colspan=\"3\" style=\"font-size: 24px; font-family: Arial; color: #00483a;\">\n                                                Terka Valentová\n                                                <table width=\"195\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\">\n                                                    <tr>\n                                                        <td width=\"20\" height=\"35\"></td>\n                                                        <td width=\"30\" align=\"left\" valign=\"middle\" style=\"font-size: 0px;\"s>\n                                                            <img src=\"http://s3-eu-west-1.amazonaws.com/cz.persoo.images/vqb36nehmep6dh1kbjpfpb4f/call.jpg\" border=\"0\" />\n                                                        </td>\n                                                        <td align=\"left\" valign=\"middle\" style=\"font-size: 14px; font-family: Arial; color: #00483a;\">\n                                                            777 062 416\n                                                        </td>\n                                                    </tr>\n                                                    <tr>\n                                                        <td width=\"20\" height=\"35\"></td>\n                                                        <td width=\"30\" align=\"left\" valign=\"middle\" style=\"font-size: 0px;\">\n                                                            <img src=\"http://s3-eu-west-1.amazonaws.com/cz.persoo.images/vqb36nehmep6dh1kbjpfpb4f/time.jpg\" border=\"0\" />\n                                                        </td>\n                                                        <td align=\"left\" valign=\"middle\" style=\"font-size: 14px; font-family: Arial; color: #00483a;\">\n                                                            9:00 - 16:00\n                                                        </td>\n                                                    </tr>\n                                                    <tr>\n                                                        <td width=\"20\" height=\"35\"></td>\n                                                        <td width=\"30\" align=\"left\" valign=\"middle\" style=\"font-size: 0px;\">\n                                                            <img src=\"http://s3-eu-west-1.amazonaws.com/cz.persoo.images/vqb36nehmep6dh1kbjpfpb4f/mail.jpg\" border=\"0\" />\n                                                        </td>\n                                                        <td align=\"left\" valign=\"middle\" style=\"font-size: 14px; font-family: Arial; color: #00483a;\">\n                                                            <a href=\"mailto:terka@hanibal.cz\" style=\"color: #00483a; text-decoration: none;\">\n                                                                <span style=\"color: #00483a; text-decoration: none;\">\n                                                                    terka@hanibal.cz\n                                                                </span>\n                                                            </a>\n                                                        </td>\n                                                    </tr>\n                                                </table>\n                                            </td>\n                                        </tr>\n                                    </table>\n                                </td>\n                                <td width=\"15\"></td>\n                            </tr>\n                        </table>\n                        &nbsp;<br />\n                        <table width=\"600\" height=\"2\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" bgcolor=\"white\">\n                            <tr>\n                                <td height=\"2\" style=\"border-top: 1px solid #cdcdcd; border-bottom: 1px solid #cdcdcd;\"></td>\n                            </tr>\n                        </table>\n                        <table width=\"600\" height=\"2\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" bgcolor=\"white\">\n                            <tr>\n                                <td width=\"15\" rowspan=\"2\"></td>\n                                <td align=\"center\" valign=\"middle\" height=\"80\" colspan=\"5\" style=\"font-size: 24px; font-family: Arial; color: #00483a;\">\n                                    A přidávám ještě něco, co by se Vám mohlo hodit.\n                                </td>\n                                <td width=\"15\" rowspan=\"2\"></td>\n                            </tr>\n                            <tr>\n                                <% for(var i=0;i<3 && i < products_basket_recommended.length;i++) { %>\n                                <td width=\"180\" valign=\"bottom\">\n                                    <!-- PERSOO PRODUKT <%= i %> -->\n                                    <table width=\"180\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\">\n                                        <tr>\n                                            <td width=\"5\" style=\"background-color: #ff9525;\"></td>\n                                            <td height=\"40\" align=\"left\" valign=\"middle\" style=\"background-color: #ff9525; font-family: Arial; font-size: 14px; color: #fffffe; height:40px; line-height: 20px;\">\n                                                <div style=\"height:40px; overflow: hidden;\">\n                                                    <a href=\"<%= appendUrlParams(products_basket_recommended[i].link, urlParams) %>\" target=\"_blank\" name=\"persoo<%= i %>_title\" style=\"color: #fffffe; text-decoration: none;\">\n                                                        <span style=\"color: #fffffe;\">\n                                                            <%= products_basket_recommended[i].name %>\n                                                        </span>\n                                                    </a>\n                                                </div>\n                                            </td>\n                                            <td width=\"5\" style=\"background-color: #ff9525;\"></td>\n                                        </tr>\n                                        <tr>\n                                            <td colspan=\"3\" align=\"center\" valign=\"middle\" height=\"185\">\n                                                <a href=\"<%= appendUrlParams(products_basket_recommended[i].link, urlParams) %>\" target=\"_blank\" name=\"persoo<%= i %>_image\">\n                                                    <img src=\"<%= products_basket_recommended[i].imageLink %>\" border=\"0\" style=\"max-height: 170px; max-width: 175px;\" /> <!-- max. velikost obrazku 180px * 185px -->\n                                                </a>\n                                            </td>\n                                        </tr>\n                                        <tr>\n                                            <td colspan=\"3\">\n                                                <table width=\"180\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\">\n                                                    <tr>\n                                                        <td width=\"5\" style=\"background-color: #00483a;\"></td>\n                                                        <td align=\"center\" valign=\"middle\" width=\"67\" style=\"background-color: #00483a; font-family: Arial; font-size: 12px;\">\n                                                            <a href=\"<%= appendUrlParams(products_basket_recommended[i].link, urlParams) %>\" target=\"_blank\" name=\"persoo<%= i %>_zobrazit\" style=\"color: #fffffe; text-decoration: none;\">\n                                                                <span style=\"color: #fffffe;\">\n                                                                    ZOBRAZIT\n                                                                    PRODUKT\n                                                                </span>\n                                                            </a>\n                                                        </td>\n                                                        <td width=\"5\" style=\"background-color: #00483a;\"></td>\n                                                        <td width=\"25\" style=\"background-color: #2b6458;\">\n                                                            <a href=\"<%= products_basket_recommended[i].link + '?' + urlParams %>\" target=\"_blank\" name=\"persoo<%= i %>_arrow\">\n                                                                <img src=\"http://s3-eu-west-1.amazonaws.com/cz.persoo.images/vqb36nehmep6dh1kbjpfpb4f/b_3.jpg\" border=\"0\" />\n                                                            </a>\n                                                        </td>\n                                                        <td width=\"5\" style=\"background-color: #00483a;\"></td>\n                                                        <td width=\"68\" style=\"background-color: #00483a; font-family: Arial; font-size: 12px; font-weight: bold;\">\n                                                            <a href=\"<%= appendUrlParams(products_basket_recommended[i].link, urlParams) %>\" target=\"_blank\" name=\"persoo<%= i %>_price\" style=\"color: #fffffe; text-decoration: none;\">\n                                                                <span style=\"color: #fffffe;\">\n                                                                    <%= printPrice(products_basket_recommended[i].price) %>&nbsp;Kč\n                                                                </span>\n                                                            </a>\n                                                        </td>\n                                                        <td width=\"5\" style=\"background-color: #00483a;\"></td>\n                                                    </tr>\n                                                </table>\n                                            </td>\n                                        </tr>\n                                    </table>\n                                    <!-- END PERSOO PRODUKT <%= i %> -->\n                                </td>\n                                <% if (i<2) { %><td width=\"15\"></td><% } %>\n                                <% } %>\n                            </tr>\n                        </table>\n                        &nbsp;<br />\n                        <table width=\"600\" height=\"2\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" bgcolor=\"white\">\n                            <tr>\n                                <td colspan=\"3\" style=\"font-size: 0px;\">\n                                    <img src=\"http://s3-eu-west-1.amazonaws.com/cz.persoo.images/vqb36nehmep6dh1kbjpfpb4f/mount.jpg\" border=\"0\" />\n                                </td>\n                            </tr>\n                            <tr>\n                                <td width=\"15\" style=\"background-color: #dcd7cc;\"></td>\n                                <td style=\"background-color: #dcd7cc; font-family: Arial; font-size: 12px; color: #2d2d2d;\">\n                                    &nbsp;<br />\n                                     \n                                    <br />\n                                    &nbsp;<br />\n                                    © 2015 Hanibal.cz  All rights reserved.<br />\n                                    &nbsp;<br />\n                                    Tento email Vám byl zaslán na <%= email_email %> jako obchodní sdělení na základě Vašeho souhlasu. Děkujeme.<br />\n                                    &nbsp;<br />\n                                </td>\n                                <td width=\"15\" style=\"background-color: #dcd7cc;\"></td>\n                            </tr>\n                        </table>\n                    </td>\n                    <td style=\"background-color: #ece8dc; background-image: url('http://s3-eu-west-1.amazonaws.com/cz.persoo.images/vqb36nehmep6dh1kbjpfpb4f/bg.jpg');\"></td>\n                </tr>\n            </table>\n        </center>\n    </body>\n</html>",
                        "subject": "Nechybí Vám něco v batohu<%= db.mailchimp && db.mailchimp['5PAD'] ? ',' + db.mailchimp['5PAD'] : '' %>?",
                        "textBody": "<%\n// mapping products to be displayed here\nvar products_basket = products1 || [];\nvar products_basket_recommended = products2 || [];\n\nvar email_osloveni = db.mailchimp.OSLOVENI;\nvar email_5pad = db.mailchimp['5PAD'];\nvar email_email = db.bestIdentifications.email;\nvar basketTotal = 10;\n%>\n\n<%= email_osloveni ? email_osloveni : 'Ahoj' %>, <%= email_5pad ? email_5pad + ',' : '' %>\n\nVšimla jsem si, že v košíku máte něco, co by se Vám mohlo hodit.\n\nCo se stalo? Potřebujete s něčím poradit? Nebo se něco pokazilo v nákupním procesu? Zavolejte mi nebo napište email, ráda Vám pomůžu s čímkoliv bude potřeba!\n                      \nParádní outdoorový den\n\n       Terka"
                    },
                    "minTimeBeforeNextTrigger": 864000000,
                    "scenarios": {
                        "products1": "bcf7640656ab404aacaef9bcd5c9bc55",
                        "products2": "basketCrosssell"
                    },
                    "triggerFunction": "function trigger(io){\n    var send = false;\n    var lastBasketChange = io.db.lastAccesses.basketChange;\n    var lastPageview = io.db.lastAccesses.pageview;\n    \n    if(\n    \n    /* basket is non-empty */\n    io.db.products.inBasket &&\n    io.db.products.inBasket.length > 0 &&\n        \n    /* at least 2 hours after last visit */\n    atLeastNDaysAfter(lastPageview, 1/12) &&\n        \n    /* at most 3 days after basket status has Changed */\n    atMostNDaysAfter(lastBasketChange, 3) &&\n    \n    /* not already sent after last visit */\n    locationNotAlreadySentAfter(lastPageview)\n        \n    ) {\n        return true;\n    } else {\n        return false;\n    }\n}"
                }
            ]
        }

## Location [/accounts/{accountID}/locations/{locationID}]

+ Parameters

    + accountID (required, string, `4959bc0ab5f24ac2a9688908adaf9e24`)
    + locationID (required, string, `de5c074d3f274aab943054dbbfac3803`)

### getLocation [GET]
Retrieve a location.

+ Response 200 (application/json)

        {
            "id": "de5c074d3f274aab943054dbbfac3803",
            "name": "Basket reminder example",
            "class": "email",
            "isActive": false,
            "variants": [
                {
                    "id": "default",
                    "name": "default",
                    "condition": "true",
                    "content": {
                        "googleAnalyticsLocation": "exampleLocationName",
                        "htmlBody": "<p>Come back and buy X.</p>",
                        "subject": "Your product X is on SALE",
                        "textBody": "Come back and buy X."
                    },
                    "minTimeBeforeNextTrigger": 1,
                    "scenarios": {
                        "products1": "psGeneral"
                    },
                    "triggerFunction": ""
                }
            ]
        }

### updateLocation [PUT]
Update a location.

+ Request (application/json)

        {
            "name": "Basket reminder",
            "class": "email",
            "isActive": true,
            "variants": [
                {
                    "id": "default",
                    "name": "default variant",
                    "condition": "db.products.inBasket && db.products.inBasket.length > 0",
                    "content": {
                        "googleAnalyticsLocation": "basketReminderLocation",
                        "htmlBody": "<p>Come back and buy ABC.</p>",
                        "subject": "Product ABC is on SALE",
                        "textBody": "Come back and buy ABC."
                    },
                    "minTimeBeforeNextTrigger": 10,
                    "scenarios": {
                        "products1": "psGeneral",
                        "products2": "basketCrosssell"
                    },
                    "triggerFunction": "function trigger(io){\n    var send = false;\n    var lastBasketChange = io.db.lastAccesses.basketChange;\n    var lastPageview = io.db.lastAccesses.pageview;\n    \n    if(\n    \n    /* basket is non-empty */\n    io.db.products.inBasket &&\n    io.db.products.inBasket.length > 0 &&\n        \n    /* at least 2 hours after last visit */\n    atLeastNDaysAfter(lastPageview, 1/12) &&\n        \n    /* at most 3 days after basket status has Changed */\n    atMostNDaysAfter(lastBasketChange, 3) &&\n    \n    /* not already sent after last visit */\n    locationNotAlreadySentAfter(lastPageview)\n        \n    ) {\n        return true;\n    } else {\n        return false;\n    }\n}"
                }
            ]
        }

+ Response 200 (application/json)

        {
            "id": "de5c074d3f274aab943054dbbfac3803",
            "name": "Basket reminder",
            "class": "email",
            "isActive": true,
            "variants": [
                {
                    "id": "default",
                    "name": "default variant",
                    "condition": "db.products.inBasket && db.products.inBasket.length > 0",
                    "content": {
                        "googleAnalyticsLocation": "basketReminderLocation",
                        "htmlBody": "<p>Come back and buy ABC.</p>",
                        "subject": "Product ABC is on SALE",
                        "textBody": "Come back and buy ABC."
                    },
                    "minTimeBeforeNextTrigger": 10,
                    "scenarios": {
                        "products1": "psGeneral",
                        "products2": "basketCrosssell"
                    },
                    "triggerFunction": "function trigger(io){\n    var send = false;\n    var lastBasketChange = io.db.lastAccesses.basketChange;\n    var lastPageview = io.db.lastAccesses.pageview;\n    \n    if(\n    \n    /* basket is non-empty */\n    io.db.products.inBasket &&\n    io.db.products.inBasket.length > 0 &&\n        \n    /* at least 2 hours after last visit */\n    atLeastNDaysAfter(lastPageview, 1/12) &&\n        \n    /* at most 3 days after basket status has Changed */\n    atMostNDaysAfter(lastBasketChange, 3) &&\n    \n    /* not already sent after last visit */\n    locationNotAlreadySentAfter(lastPageview)\n        \n    ) {\n        return true;\n    } else {\n        return false;\n    }\n}"
                }
            ]
        }

+ Response 404

        {
            "errors": [
                "message": "Location not found."
            ]
        }

### deleteLocation [DELETE]
Delete a location.

+ Response 204

+ Response 404

        {
            "errors": [
                "message": "Location not found."
            ]
        }

# Group Templates

## Templates [/accounts/{accountID}/templates]
+ Parameters

    + accountID (required, string, `4959bc0ab5f24ac2a9688908adaf9e24`)

### createTemplate [POST]
Creates a new template.

+ Request (application/json)

        {
            "someKey": "someValue"
        }

+ Response 200 (application/json)

        {
            "id": "b9b99d2b86314e3a8722d41ffd74f27d"
            "someKey": "someValue"
        }

### listTemplates [GET]
Lists all existing templates.

+ Response 200 (application/json)

        [
            {
                "someKey": "someValue",
                "id": "b9b99d2b86314e3a8722d41ffd74f25e"
            }
        ]

## Template [/accounts/{accountID}/templates/{templateID}]
+ Parameters

    + accountID (required, string, `4959bc0ab5f24ac2a9688908adaf9e24`)
    + templateID (required, string, `b9b99d2b86314e3a8722d41ffd74f27d`)

### getTemplate [GET]
Retrieves the template.

+ Response 200 (application/json)

        {
            "id": "b9b99d2b86314e3a8722d41ffd74f27d"
            "someKey": "someValue"
        }
        
### updateTemplate [PUT]
Updates the template.

+ Request (application/json)

        {
            "someKey": "someOtherValue",
        }
        
+ Response 200 (application/json)

        {
            "id": "b9b99d2b86314e3a8722d41ffd74f27d"
            "someKey": "someOtherValue"
        }

### deleteTemplate [DELETE]
Deletes the template.

+ Response 204

# Group Account Accesses

## Account accesses [/accounts/{accountID}/accesses]

+ Parameters

    + accountID (required, string, `4959bc0ab5f24ac2a9688908adaf9e24`) ... ID of the account to perform the action on

### listAccountAccesses [GET]
List all accesses to this account.

+ Response 200 (application/json)

        [
            {
                "id": "e8fb4ab5e6f44912a911fead7f286363"
                "email": "test@email.com"
                "name": "Jakub"
            },
            {
                "id": "daf38a59e94948bfbdacbd4a34eccb47"
                "email": "test3@email.com"
                "name": "Alice"
            }
        ]
        
+ Response 404

### newAccountAccess [POST]
Adds a user an access to the account.
    
+ Request (application/json)
        
        {
            "id": "daf38a59e94948bfbdacbd4a34eccb47"
        }
            
+ Response 201

        {
            "id": "daf38a59e94948bfbdacbd4a34eccb47"
            "email": "test3@email.com"
            "name": "Alice"
        }
        
+ Response 404
+ Response 409

## Account access [/accounts/{accountID}/accesses/{userID}]

+ Parameters

    + accountID (required, string, `4959bc0ab5f24ac2a9688908adaf9e24`) ... ID of an account
    + userID (required, string, `daf38a59e94948bfbdacbd4a34eccb47`) ... ID of a user
    
### getAccountAccess [GET]
Retrieve an account access.

+ Response 200 (application/json)

        {
            "id": "daf38a59e94948bfbdacbd4a34eccb47",
            "email": "test3@email.com",
            "name": "Alice"
        }
        
+ Response 404 (application/json)

        {
            "errors": [
                "message": "Account not found."
            ]
        }

+ Response 404 (application/json)

        {
            "errors": [
                "message": "Account access not found."
            ]
        }
        
### deleteAccountAccess [DELETE]
Deletes an account access.

+ Response 204

+ Response 403

+ Response 404 (application/json)

        {
            "errors": [
                "message": "Account not found."
            ]
        }

+ Response 404 (application/json)

        {
            "errors": [
                "message": "Account access not found."
            ]
        }

## Invite user [/accounts/{accountID}/accesses/inviteUser]

### inviteUser [POST]
Invite a user to get access to the account.
If the user exists, he receives access to the account. 
If the user doesn't exist, an error that you must register user first is returned.
(In the future, method will send invitation emails for nonexisting users.)

+ Request (application/json)

+ Response 200 (application/json)

        {
            "id": "daf38a59e94948bfbdacbd4a34eccb47",
            "email": "test3@email.com",
            "name": "Alice"
        }

+ Response 404 (application/json)

        {
            "errors": [
                {
                    "message": "User not found."
                }
            ]
        }


# Group Visitors

All visitors of a website have visitor profile in Persoo. 
Profile is either anonymous (just identified with 1 anonymous browser ID) or
identified by several identifications. Each identification is specified by pair idType, idValue.
For example email:my@persoo.cz or login:12345.

## Visitor [/accounts/{accountID}/visitors/{idType}/{idValue}]

+ Parameters

    + accountID (required, string, `4959bc0ab5f24ac2a9688908adaf9e24`) ... ID of an account
    + idType (required, string, `email`) ... type of identification ('email', '_vid' etc.)
    + idValue (required, string, `test@example.com`) ... value of identification
    
### getVisitorDetail [GET]
Retrieve complete visitor profile for given identification. Internaly, 1 visitor footprint is stored in different storages in Persoo. 
This method provides unified access to complete visitor profile.

Visitor detail constains sections:
* `profile` - most important metrics from visitor profile
* `sessions` - list of all sessions in descending order by time
* `transactions` - list of all transactions

Note: two different identifications of the same visitor profile will retrieve the same profile.

+ Response 200 (application/json)

        {
            "profile": {
                "visits": 20,
                "spent": 1679,
                "identification": {
                    "email": {
                        "john.doe@example.com": 1
                    },
                    "_vid": {
                        "AAABUtajinIv+U6KdZdZvG1a": 1
                    }
                },
                "lastAccesses": {
                    "updateProfile": 1455494417173,
                    "pageview": 1455299988997,
                    "basketChange": 1455299976879
                },
                "...": "...other data ..."
            },
            "sessions": [
                {
                    "browserID": "AAABUcPLB/kZcRzdIXcWPcIF",
                    "timestampFrom": 1450688842422,
                    "timestampTo": 1450688844087,
                    "events": [
                        {
                            "itemID": "10084",
                            "pageType": "detail",
                            "timestamp": 1450688843481,
                            "url": "http://my-eshop.cz/productDetail/10084"
                        },
                        {
                            "basketItems": {
                                "10007": {
                                    "quantity": 1
                                }
                            },
                            "basketTotal": 123,
                            "pageType": "basket",
                            "timestamp": 1450688843834,
                            "url": "http://my-eshop.cz/basket/step1"
                        }
                    ]
                }
            ],
            "transactions": [
                {
                    "transactionId": "1444121440001",
                    "timestamp": 1444121443030,
                    "items": {
                        "10084": {
                            "categoryID": "Boty",
                            "price": 1679,
                            "quantity": 1
                        }
                    },
                    "total": 1679
                }
            ]
        }
        
+ Response 404 (application/json)

        {
            "errors": [
                "message": "Account not found."
            ]
        }

+ Response 404 (application/json)

        {
            "errors": [
                {
                    "message": "Visitor with identification email=test@example.com not found."
                }
            ]
        }

## byLastTransactions [/accounts/{accountID}/visitors/byLastTransactions]

+ Parameters

    + accountID (required, string, `4959bc0ab5f24ac2a9688908adaf9e24`) ... ID of an account

### getVisitorsByLastTransactions [GET]

Returns up to 20 unique identifications from the latest transactions. Less than 20 identifications would be
returned if and only if there were no more unique identifications to which some transaction have been recorded.

Please note that this method is rather temporary and will be replaced with a more complex alternative soon.

+ Response 200 (application/json)

        [
            {
                "idType": "_vid",
                "idValue": "ABABUsiT060bErl62gLvF6t/"
            },
            {
                "idType": "_vid",
                "idValue": "ABABUsGb0wXf2a4oRySEgR4k"
            },
            {
                "idType": "_vid",
                "idValue": "ABABUsGbxF3eUw7y7537xpc7"
            }
        ]
        
# Group Reports

Using this API, you can access collected statistics.

## Reports [/accounts/{accountID}/reports?table={table}&from={from}&to={to}&filter={filter}&dimensions={dimensions}&metrics={metrics}&sort={sort}&limit={limit}]

+ Parameters

    + accountID (required, string, `4959bc0ab5f24ac2a9688908adaf9e24`) ... ID of an account
    + table (required, string, `offers`) ... table to search in
    + from (required, string, `2016-03-19`) ... start date (yyyy-MM-dd)
    + to (required, string, `2016-05-26`) ... end date (yyyy-MM-dd)
    + filter (optional, string, `abTestID==123,offerID!=456`) ... filter records with these dimensions only (supported operators are `==` and `!=`)
    + dimensions (required, string, `offerID,abTestID`) ... aggregate over these dimensions
    + metrics (required, string, `visits,interactions`) ... calculate sum of these metrics for each aggregated result
    + sort (optional, string, `+days,-visits`) ... sort by dimension `day` ascendingly (+), if the same, sort by metric `visits` descendingly (-)
    + limit (required, int, `100`) ... return at the most this number of records
    
### getReports [GET]
This API allows you to examine and analyze collected statistics. For example, lets say you want to know how well did various A/B tests perform in terms of sells count. Ideally, you'd want to see comparison for each category.

Please note that the following is just an example and actual naming of dimensions and metrics may differ.

This can be easily done by setting `dimension==categoryID,abTestID` and `metrics=buy,addToBasket`. You'll get something like:

        [
            {
                "categoryID": "1",
                "abTestID": "1",
                "metrics": {
                    "buy": 513.0,
                    "addToBasket", 1024.0
                }
            },
            {
                "categoryID": "1",
                "abTestID": "2",
                "metrics": {
                    "buy": 418.0,
                    "addToBasket", 1213.0
                }
            },
            {
                "categoryID": "2",
                "abTestID": "1",
                "metrics": {
                    "buy": 3.0,
                    "addToBasket", 8.0
                }
            },
            {
                "categoryID": "2",
                "abTestID": "2",
                "metrics": {
                    "buy": 4.0,
                    "addToBasket", 7.0
                }
            },
            // ...
        ]

You immediately see that A/B test 2 performed worse for category 1. You don't, however, care about category 2 as it have very low sells count for both A/B test variants. So you simply add `sort=-buy` and get something like the following:

        [
            {
                "categoryID": "3",
                "abTestID": "1",
                "metrics": {
                    "buy": 3831.0,
                    "addToBasket", 5912.0
                }
            },
            {
                "categoryID": "3",
                "abTestID": "2",
                "metrics": {
                    "buy": 3635.0,
                    "addToBasket", 4215.0
                }
            },
            {
                "categoryID": "4",
                "abTestID": "1",
                "metrics": {
                    "buy": 2125.0,
                    "addToBasket", 3213.0
                }
            },
            {
                "categoryID": "4",
                "abTestID": "2",
                "metrics": {
                    "buy": 3238.0,
                    "addToBasket", 4123.0
                }
            },
            // ...
        ]
        
Now you see what's the most relevant. A/B test 2 performed slightly worse for category 1, but significantly better for category 2. You can leverage this information for fine tunings and optimizations - starting with the things
which make the greatest impact.

Available tables, metrics and dimensions:

        {
            table: "offers",
            dimensions: [
                "day",          // i.e "2016-07-08",
                "locationID",   // i.e. "testLocationID",
                "offerID",      // i.e. "testOfferID",
                "variantID",    // i.e. "default" (deprecated - it's only for abtest variants
                "abTestVariant",    // i.e. "myABtestID:myVariantID",
                "abTestBucket"      // i.e. "c"
            ],
            metrics: [
                "impression",           // absolute events count
                "impression_sessions",  // number of session with the event
                "click",
                "click_sessions",
                "<customEvent>",        // for all your custom events
                "<customEvent>_sessions",
                
                "transactions",
                "transactionRevenue",
                "transactionShipping",
                "transactionTax",
                "itemsQuantity",    // sum of item quantities
                "uniquePurchases"   // sum of unique items in transactions
            ]
        }


+ Response 200 (application/json)

        [
            {
                "day": "2016-05-26T00:00:00.000Z",
                "metrics": {
                    "visits": 1.0
                }
            },
            {
                "day": "2016-05-30T00:00:00.000Z",
                "metrics": {
                    "visits": 194.0
                }
            },
            {
                "day": "2016-06-02T00:00:00.000Z",
                "metrics": {
                    "visits": 37.0
                }
            },
            {
                "day": "2016-06-03T00:00:00.000Z",
                "metrics": {
                    "visits": 30.0
                }
            },
            {
                "day": "2016-06-08T00:00:00.000Z",
                "metrics": {
                    "visits": 108.0
                }
            },
            {
                "day": "2016-06-09T00:00:00.000Z",
                "metrics": {
                    "visits": 14.0
                }
            }
        ]